var __webpack_modules__={640:(O,t,e)=>{e.d(t,{AnnotationLayer:()=>z,FreeTextAnnotationElement:()=>C,InkAnnotationElement:()=>D,StampAnnotationElement:()=>L});var _=e(266),p=e(473),h=e(780);function i(t){return Math.floor(255*Math.max(0,Math.min(1,t))).toString(16).padStart(2,"0")}function a(t){return Math.max(0,Math.min(255,255*t))}class r{static CMYK_G([t,e,i,s]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return[t=a(t),t,t]}static G_HTML([t]){t=i(t);return"#"+t+t+t}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map(a)}static RGB_HTML(t){return"#"+t.map(i).join("")}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,i+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,i,s]){return[a(1-Math.min(1,t+s)),a(1-Math.min(1,i+s)),a(1-Math.min(1,e+s))]}static CMYK_HTML(t){t=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([t,e,i]){t=1-t,e=1-e,i=1-i;return["CMYK",t,e,i,Math.min(t,e,i)]}}var c=e(160);const u=1e3,A=new WeakSet;function g(t){return{width:t[2]-t[0],height:t[3]-t[1]}}class d{static create(t){switch(t.data.annotationType){case _.AnnotationType.LINK:return new n(t);case _.AnnotationType.TEXT:return new o(t);case _.AnnotationType.WIDGET:switch(t.data.fieldType){case"Tx":return new l(t);case"Btn":return t.data.radioButton?new b(t):new(t.data.checkBox?v:y)(t);case"Ch":return new w(t);case"Sig":return new f(t)}return new m(t);case _.AnnotationType.POPUP:return new x(t);case _.AnnotationType.FREETEXT:return new C(t);case _.AnnotationType.LINE:return new S(t);case _.AnnotationType.SQUARE:return new T(t);case _.AnnotationType.CIRCLE:return new k(t);case _.AnnotationType.POLYLINE:return new M(t);case _.AnnotationType.CARET:return new R(t);case _.AnnotationType.INK:return new D(t);case _.AnnotationType.POLYGON:return new P(t);case _.AnnotationType.HIGHLIGHT:return new I(t);case _.AnnotationType.UNDERLINE:return new F(t);case _.AnnotationType.SQUIGGLY:return new N(t);case _.AnnotationType.STRIKEOUT:return new B(t);case _.AnnotationType.STAMP:return new L(t);case _.AnnotationType.FILEATTACHMENT:return new U(t);default:return new s(t)}}}class s{#hasBorder=!1;constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:i}){return!!(t?.str||e?.str||i?.str)}get hasPopupData(){return s._hasPopupData(this.data)}_createContainer(t){var{data:e,parent:{page:i,viewport:s}}=this,a=document.createElement("section"),{pageWidth:s,pageHeight:r,pageX:n,pageY:o}=(a.setAttribute("data-annotation-id",e.id),this instanceof m||(a.tabIndex=u),a.style.zIndex=this.parent.zIndex++,this.data.popupRef&&a.setAttribute("aria-haspopup","dialog"),e.noRotate&&a.classList.add("norotate"),s.rawDims);if(!e.rect||this instanceof x){const c=e["rotation"];e.hasOwnCanvas||0===c||this.setRotation(c,a)}else{var{width:l,height:h}=g(e.rect),i=_.Util.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]);if(!t&&0<e.borderStyle.width){a.style.borderWidth=e.borderStyle.width+"px";var t=e.borderStyle.horizontalCornerRadius,d=e.borderStyle.verticalCornerRadius;switch(0<t||0<d?a.style.borderRadius=`calc(${t}px * var(--scale-factor)) / calc(${d}px * var(--scale-factor))`:this instanceof b&&(a.style.borderRadius=`calc(${l}px * var(--scale-factor)) / calc(${h}px * var(--scale-factor))`),e.borderStyle.style){case _.AnnotationBorderStyleType.SOLID:a.style.borderStyle="solid";break;case _.AnnotationBorderStyleType.DASHED:a.style.borderStyle="dashed";break;case _.AnnotationBorderStyleType.BEVELED:(0,_.warn)("Unimplemented border style: beveled");break;case _.AnnotationBorderStyleType.INSET:(0,_.warn)("Unimplemented border style: inset");break;case _.AnnotationBorderStyleType.UNDERLINE:a.style.borderBottomStyle="solid"}t=e.borderColor||null;t?(this.#hasBorder=!0,a.style.borderColor=_.Util.makeHexColor(0|t[0],0|t[1],0|t[2])):a.style.borderWidth=0}a.style.left=100*(i[0]-n)/s+"%",a.style.top=100*(i[1]-o)/r+"%";const c=e["rotation"];e.hasOwnCanvas||0===c?(a.style.width=100*l/s+"%",a.style.height=100*h/r+"%"):this.setRotation(c,a)}return a}setRotation(i,s=this.container){if(this.data.rect){var{pageWidth:a,pageHeight:r}=this.parent.viewport.rawDims,{width:n,height:o}=g(this.data.rect);let t,e;e=i%180==0?(t=100*n/a,100*o/r):(t=100*o/a,100*n/r),s.style.width=t+"%",s.style.height=e+"%",s.setAttribute("data-main-rotation",(360-i)%360)}}get _commonActions(){const e=(t,e,i)=>{var t=i.detail[t],s=t[0],t=t.slice(1);i.target.style[e]=r[s+"_HTML"](t),this.annotationStorage.setValue(this.data.id,{[e]:r[s+"_rgb"](t)})};return(0,_.shadow)(this,"_commonActions",{display:t=>{var t=t.detail["display"],e=t%2==1;this.container.style.visibility=e?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:e,noPrint:1===t||2===t})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{t=t.detail.hidden;this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:t,noView:t})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{t=t.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(t,e){var i=this._commonActions;for(const s of Object.keys(e.detail))(t[s]||i[s])?.(e)}_setDefaultPropertiesFromJS(t){if(this.enableScripting){var e=this.annotationStorage.getRawValue(this.data.id);if(e){var i,s,a=this._commonActions;for([i,s]of Object.entries(e)){var r=a[i];r&&(r({detail:{[i]:s},target:t}),delete e[i])}}}}_createQuadrilaterals(){if(this.container){var e=this.data["quadPoints"];if(e){var[i,s,a,r]=this.data.rect;if(1===e.length){var[,{x:n,y:o},{x:l,y:h}]=e[0];if(a===n&&r===o&&i===l&&s===h)return}n=this.container["style"];let t;this.#hasBorder&&({borderColor:o,borderWidth:l}=n,n.borderWidth=0,t=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${o}" stroke-width="${l}">`],this.container.classList.add("hasBorder"));var d,c,u,p,g=a-i,m=r-s,f=this["svgFactory"],h=f.createElement("svg"),o=(h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0),f.createElement("defs")),v=(h.append(o),f.createElement("clipPath")),l="clippath_"+this.data.id;v.setAttribute("id",l),v.setAttribute("clipPathUnits","objectBoundingBox"),o.append(v);for([,{x:d,y:c},{x:u,y:p}]of e){var b=f.createElement("rect"),_=(u-i)/g,A=(r-c)/m,y=(d-u)/g,w=(c-p)/m;b.setAttribute("x",_),b.setAttribute("y",A),b.setAttribute("width",y),b.setAttribute("height",w),v.append(b),t?.push(`<rect vector-effect="non-scaling-stroke" x="${_}" y="${A}" width="${y}" height="${w}"/>`)}this.#hasBorder&&(t.push("</g></svg>')"),n.backgroundImage=t.join("")),this.container.append(h),this.container.style.clipPath=`url(#${l})`}}}_createPopup(){var{container:t,data:e}=this,t=(t.setAttribute("aria-haspopup","dialog"),new x({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:"popup_"+e.id,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){(0,_.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){var i=[];if(this._fieldObjects){var s=this._fieldObjects[t];if(s)for(var{page:a,id:r,exportValues:n}of s)-1!==a&&r!==e&&(a="string"==typeof n?n:null,(n=document.querySelector(`[data-element-id="${r}"]`))&&!A.has(n)?(0,_.warn)("_getElementsByName - element not allowed: "+r):i.push({id:r,exportValue:a,domElement:n}))}else for(const h of document.getElementsByName(t)){var o=h["exportValue"],l=h.getAttribute("data-element-id");l!==e&&A.has(h)&&i.push({id:l,exportValue:o,domElement:h})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){var t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(this._isEditable){const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}}}class n extends s{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){var{data:t,linkService:e}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let s=!1;return t.url?(e.addLinkAttributes(i,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(i,t.action),s=!0):t.attachment?(this.#bindAttachment(i,t.attachment,t.attachmentDest),s=!0):t.setOCGState?(this.#bindSetOCGState(i,t.setOCGState),s=!0):t.dest?(this._bindLink(i,t.dest),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),s=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(i),this.container}#setInternalLink(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),!e&&""!==e||this.#setInternalLink()}_bindNamedAction(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),this.#setInternalLink()}#bindAttachment(t,e,i=null){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#setInternalLink()}#bindSetOCGState(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),this.#setInternalLink()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");var i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const a of Object.keys(e.actions)){var s=i.get(a);s&&(t[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:a}}),!1))}t.onclick||(t.onclick=()=>!1),this.#setInternalLink()}_bindResetFormAction(t,v){const b=t.onclick;b||(t.href=this.linkService.getAnchorUrl("")),this.#setInternalLink(),this._fieldObjects?t.onclick=()=>{b?.();var{fields:t,refs:e,include:i}=v,s=[];if(0!==t.length||0!==e.length){var a,r=new Set(e);for(const u of t)for({id:a}of this._fieldObjects[u]||[])r.add(a);for(const p of Object.values(this._fieldObjects))for(const g of p)r.has(g.id)===i&&s.push(g)}else for(const m of Object.values(this._fieldObjects))s.push(...m);var n=this.annotationStorage,o=[];for(const f of s){var l=f["id"];switch(o.push(l),f.type){case"text":var h=f.defaultValue||"";n.setValue(l,{value:h});break;case"checkbox":case"radiobutton":h=f.defaultValue===f.exportValues;n.setValue(l,{value:h});break;case"combobox":case"listbox":var d=f.defaultValue||"";n.setValue(l,{value:d});break;default:continue}var c=document.querySelector(`[data-element-id="${l}"]`);c&&(A.has(c)?c.dispatchEvent(new Event("resetform")):(0,_.warn)("_bindResetFormAction - element not allowed: "+l))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:o,name:"ResetForm"}}),!1}:((0,_.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),b||(t.onclick=()=>!1))}}class o extends s{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");var t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class m extends s{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&("CANVAS"===t.previousSibling?.nodeName&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return _.FeatureTest.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,s,a){i.includes("mouse")?t.addEventListener(i,t=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:a(t),shift:t.shiftKey,modifier:this._getKeyModifier(t)}})}):t.addEventListener(i,t=>{if("blur"===i){if(!e.focused||!t.relatedTarget)return;e.focused=!1}else if("focus"===i){if(e.focused)return;e.focused=!0}a&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:a(t)}})})}_setEventListeners(t,e,i,s){for(var[a,r]of i)"Action"!==r&&!this.data.actions?.[r]||("Focus"!==r&&"Blur"!==r||(e||={focused:!1}),this._setEventListener(t,e,a,r,s),"Focus"!==r||this.data.actions?.Blur?"Blur"!==r||this.data.actions?.Focus||this._setEventListener(t,e,"focus","Focus",null):this._setEventListener(t,e,"blur","Blur",null))}_setBackgroundColor(t){var e=this.data.backgroundColor||null;t.style.backgroundColor=null===e?"transparent":_.Util.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){var e=this.data.defaultAppearanceData["fontColor"],i=this.data.defaultAppearanceData.fontSize||9,t=t.style;let s;var a,r,n=t=>Math.round(10*t)/10;s=this.data.multiLine?(r=Math.abs(this.data.rect[3]-this.data.rect[1]-2),a=Math.round(r/(_.LINE_FACTOR*i))||1,Math.min(i,n(r/a/_.LINE_FACTOR))):(r=Math.abs(this.data.rect[3]-this.data.rect[1]-2),Math.min(i,n(r/_.LINE_FACTOR))),t.fontSize=`calc(${s}px * var(--scale-factor))`,t.color=_.Util.makeHexColor(e[0],e[1],e[2]),null!==this.data.textAlignment&&(t.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class l extends m{constructor(t){super(t,{isRenderable:t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue})}setPropertyOnSiblings(t,e,i,s){var a=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=i),a.setValue(r.id,{[s]:i})}render(){const s=this.annotationStorage,h=this.data.id;this.container.classList.add("textWidgetAnnotation");let a=null;if(this.renderForms){var r=s.getValue(h,{value:this.data.fieldValue});let t=r.value||"";var n=s.getValue(h,{charLimit:this.data.maxLen}).charLimit;n&&t.length>n&&(t=t.slice(0,n));let e=r.formattedValue||this.data.textContent?.join("\n")||null;e&&this.data.comb&&(e=e.replaceAll(/\s+/g,""));const d={userValue:t,formattedValue:e,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?((a=document.createElement("textarea")).textContent=e??t,this.data.doNotScroll&&(a.style.overflowY="hidden")):((a=document.createElement("input")).type="text",a.setAttribute("value",e??t),this.data.doNotScroll&&(a.style.overflowX="hidden")),this.data.hasOwnCanvas&&(a.hidden=!0),A.add(a),a.setAttribute("data-element-id",h),a.disabled=this.data.readOnly,a.name=this.data.fieldName,a.tabIndex=u,this._setRequired(a,this.data.required),n&&(a.maxLength=n),a.addEventListener("input",t=>{s.setValue(h,{value:t.target.value}),this.setPropertyOnSiblings(a,"value",t.target.value,"value"),d.formattedValue=null}),a.addEventListener("resetform",t=>{var e=this.data.defaultFieldValue??"";a.value=d.userValue=e,d.formattedValue=null});let i=t=>{var e=d["formattedValue"];null!=e&&(t.target.value=e),t.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){a.addEventListener("focus",t=>{d.focused||(t=t["target"],d.userValue&&(t.value=d.userValue),d.lastCommittedValue=t.value,d.commitKey=1,this.data.actions?.Focus)||(d.focused=!0)}),a.addEventListener("updatefromsandbox",t=>{this.showElementAndHideCanvas(t.target),this._dispatchEventFromSandbox({value(t){d.userValue=t.detail.value??"",s.setValue(h,{value:d.userValue.toString()}),t.target.value=d.userValue},formattedValue(t){var e=t.detail["formattedValue"];null!=(d.formattedValue=e)&&t.target!==document.activeElement&&(t.target.value=e),s.setValue(h,{formattedValue:e})},selRange(t){t.target.setSelectionRange(...t.detail.selRange)},charLimit:e=>{var i=e.detail["charLimit"],e=e["target"];if(0===i)e.removeAttribute("maxLength");else{e.setAttribute("maxLength",i);let t=d.userValue;!t||t.length<=i||(t=t.slice(0,i),e.value=d.userValue=t,s.setValue(h,{value:t}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:t,willCommit:!0,commitKey:1,selStart:e.selectionStart,selEnd:e.selectionEnd}}))}}},t)}),a.addEventListener("keydown",t=>{let e=-(d.commitKey=1);var i;"Escape"===t.key?e=0:"Enter"!==t.key||this.data.multiLine?"Tab"===t.key&&(d.commitKey=3):e=2,-1!==e&&(i=t.target.value,d.lastCommittedValue!==i)&&(d.lastCommittedValue=i,d.userValue=i,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:i,willCommit:!0,commitKey:e,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}}))});const o=i;i=null,a.addEventListener("blur",t=>{var e;d.focused&&t.relatedTarget&&(this.data.actions?.Blur||(d.focused=!1),e=t.target["value"],d.userValue=e,d.lastCommittedValue!==e&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:e,willCommit:!0,commitKey:d.commitKey,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}}),o(t))}),this.data.actions?.Keystroke&&a.addEventListener("beforeinput",t=>{d.lastCommittedValue=null;var{data:e,target:i}=t,{value:s,selectionStart:a,selectionEnd:r}=i;let n=a,o=r;switch(t.inputType){case"deleteWordBackward":var l=s.substring(0,a).match(/\w*[^\w]*$/);l&&(n-=l[0].length);break;case"deleteWordForward":l=s.substring(a).match(/^[^\w]*\w*/);l&&(o+=l[0].length);break;case"deleteContentBackward":a===r&&--n;break;case"deleteContentForward":a===r&&(o+=1)}t.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:s,change:e||"",willCommit:!1,selStart:n,selEnd:o}})}),this._setEventListeners(a,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.value)}i&&a.addEventListener("blur",i),this.data.comb&&(r=(this.data.rect[2]-this.data.rect[0])/n,a.classList.add("comb"),a.style.letterSpacing=`calc(${r}px * var(--scale-factor) - 1ch)`)}else(a=document.createElement("div")).textContent=this.data.fieldValue,a.style.verticalAlign="middle",a.style.display="table-cell",this.data.hasOwnCanvas&&(a.hidden=!0);return this._setTextStyle(a),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class f extends m{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class v extends m{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const a=this.annotationStorage,r=this.data,n=r.id;let t=a.getValue(n,{value:r.exportValue===r.fieldValue}).value;"string"==typeof t&&(t="Off"!==t,a.setValue(n,{value:t})),this.container.classList.add("buttonWidgetAnnotation","checkBox");var e=document.createElement("input");return A.add(e),e.setAttribute("data-element-id",n),e.disabled=r.readOnly,this._setRequired(e,this.data.required),e.type="checkbox",e.name=r.fieldName,t&&e.setAttribute("checked",!0),e.setAttribute("exportValue",r.exportValue),e.tabIndex=u,e.addEventListener("change",t=>{var{name:t,checked:e}=t.target;for(const s of this._getElementsByName(t,n)){var i=e&&s.exportValue===r.exportValue;s.domElement&&(s.domElement.checked=i),a.setValue(s.id,{value:i})}a.setValue(n,{value:e})}),e.addEventListener("resetform",t=>{var e=r.defaultFieldValue||"Off";t.target.checked=e===r.exportValue}),this.enableScripting&&this.hasJSActions&&(e.addEventListener("updatefromsandbox",t=>{this._dispatchEventFromSandbox({value(t){t.target.checked="Off"!==t.detail.value,a.setValue(n,{value:t.target.checked})}},t)}),this._setEventListeners(e,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.checked)),this._setBackgroundColor(e),this._setDefaultPropertiesFromJS(e),this.container.append(e),this.container}}class b extends m{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const a=this.annotationStorage,i=this.data,r=i.id;let t=a.getValue(r,{value:i.fieldValue===i.buttonValue}).value;if("string"==typeof t&&(t=t!==i.buttonValue,a.setValue(r,{value:t})),t)for(const s of this._getElementsByName(i.fieldName,r))a.setValue(s.id,{value:!1});var e=document.createElement("input");if(A.add(e),e.setAttribute("data-element-id",r),e.disabled=i.readOnly,this._setRequired(e,this.data.required),e.type="radio",e.name=i.fieldName,t&&e.setAttribute("checked",!0),e.tabIndex=u,e.addEventListener("change",t=>{var{name:t,checked:e}=t.target;for(const i of this._getElementsByName(t,r))a.setValue(i.id,{value:!1});a.setValue(r,{value:e})}),e.addEventListener("resetform",t=>{var e=i.defaultFieldValue;t.target.checked=null!=e&&e===i.buttonValue}),this.enableScripting&&this.hasJSActions){const n=i.buttonValue;e.addEventListener("updatefromsandbox",t=>{this._dispatchEventFromSandbox({value:t=>{var e=n===t.detail.value;for(const s of this._getElementsByName(t.target.name)){var i=e&&s.id===r;s.domElement&&(s.domElement.checked=i),a.setValue(s.id,{value:i})}}},t)}),this._setEventListeners(e,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],t=>t.target.checked)}return this._setBackgroundColor(e),this._setDefaultPropertiesFromJS(e),this.container.append(e),this.container}}class y extends n{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){var t=super.render(),e=(t.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(t.title=this.data.alternativeText),t.lastChild);return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",t=>{this._dispatchEventFromSandbox({},t)})),t}}class w extends m{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const n=this.annotationStorage,o=this.data.id;var t=n.getValue(o,{value:this.data.fieldValue});const l=document.createElement("select");A.add(l),l.setAttribute("data-element-id",o),l.disabled=this.data.readOnly,this._setRequired(l,this.data.required),l.name=this.data.fieldName,l.tabIndex=u;let e=this.data.combo&&0<this.data.options.length;this.data.combo||(l.size=this.data.options.length,this.data.multiSelect&&(l.multiple=!0)),l.addEventListener("resetform",t=>{var e=this.data.defaultFieldValue;for(const i of l.options)i.selected=i.value===e});for(const a of this.data.options){var i=document.createElement("option");i.textContent=a.displayValue,i.value=a.exportValue,t.value.includes(a.exportValue)&&(i.setAttribute("selected",!0),e=!1),l.append(i)}let s=null;if(e){const r=document.createElement("option");r.value=" ",r.setAttribute("hidden",!0),r.setAttribute("selected",!0),l.prepend(r),s=()=>{r.remove(),l.removeEventListener("input",s),s=null},l.addEventListener("input",s)}const h=t=>{const e=t?"value":"textContent";var{options:t,multiple:i}=l;return i?Array.prototype.filter.call(t,t=>t.selected).map(t=>t[e]):-1===t.selectedIndex?null:t[t.selectedIndex][e]};let d=h(!1);const c=t=>{t=t.target.options;return Array.prototype.map.call(t,t=>({displayValue:t.textContent,exportValue:t.value}))};return this.enableScripting&&this.hasJSActions?(l.addEventListener("updatefromsandbox",t=>{this._dispatchEventFromSandbox({value(t){s?.();var t=t.detail.value,e=new Set(Array.isArray(t)?t:[t]);for(const i of l.options)i.selected=e.has(i.value);n.setValue(o,{value:h(!0)}),d=h(!1)},multipleSelection(t){l.multiple=!0},remove(t){var e=l.options,i=t.detail.remove;e[i].selected=!1,l.remove(i),0<e.length&&-1===Array.prototype.findIndex.call(e,t=>t.selected)&&(e[0].selected=!0),n.setValue(o,{value:h(!0),items:c(t)}),d=h(!1)},clear(t){for(;0!==l.length;)l.remove(0);n.setValue(o,{value:null,items:[]}),d=h(!1)},insert(t){var{index:e,displayValue:i,exportValue:s}=t.detail.insert,e=l.children[e],a=document.createElement("option");a.textContent=i,a.value=s,e?e.before(a):l.append(a),n.setValue(o,{value:h(!0),items:c(t)}),d=h(!1)},items(t){for(var e=t.detail["items"];0!==l.length;)l.remove(0);for(const r of e){var{displayValue:i,exportValue:s}=r,a=document.createElement("option");a.textContent=i,a.value=s,l.append(a)}0<l.options.length&&(l.options[0].selected=!0),n.setValue(o,{value:h(!0),items:c(t)}),d=h(!1)},indices(t){var e=new Set(t.detail.indices);for(const i of t.target.options)i.selected=e.has(i.index);n.setValue(o,{value:h(!0)}),d=h(!1)},editable(t){t.target.disabled=!t.detail.editable}},t)}),l.addEventListener("input",t=>{var e=h(!0);n.setValue(o,{value:e}),t.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:o,name:"Keystroke",value:d,changeEx:e,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(l,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],t=>t.target.value)):l.addEventListener("input",function(t){n.setValue(o,{value:h(!0)})}),this.data.combo&&this._setTextStyle(l),this._setBackgroundColor(l),this._setDefaultPropertiesFromJS(l),this.container.append(l),this.container}}class x extends s{constructor(t){var{data:e,elements:i}=t;super(t,{isRenderable:s._hasPopupData(e)}),this.elements=i}render(){this.container.classList.add("popupAnnotation");var t=new E({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const i of this.elements)i.popup=t,e.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(t=>""+_.AnnotationPrefix+t).join(",")),this.container}}class E{#boundKeyDown=this.#keyDown.bind(this);#boundHide=this.#hide.bind(this);#boundShow=this.#show.bind(this);#boundToggle=this.#toggle.bind(this);#color=null;#container=null;#contentsObj=null;#dateObj=null;#elements=null;#parent=null;#parentRect=null;#pinned=!1;#popup=null;#rect=null;#richText=null;#titleObj=null;#wasVisible=!1;constructor({container:t,color:e,elements:i,titleObj:s,modificationDate:a,contentsObj:r,richText:n,parent:o,rect:l,parentRect:h,open:d}){this.#container=t,this.#titleObj=s,this.#contentsObj=r,this.#richText=n,this.#parent=o,this.#color=e,this.#rect=l,this.#parentRect=h,this.#elements=i,this.#dateObj=p.PDFDateString.toDateObject(a),this.trigger=i.flatMap(t=>t.getElementsToTriggerPopup());for(const c of this.trigger)c.addEventListener("click",this.#boundToggle),c.addEventListener("mouseenter",this.#boundShow),c.addEventListener("mouseleave",this.#boundHide),c.classList.add("popupTriggerArea");for(const u of i)u.container?.addEventListener("keydown",this.#boundKeyDown);this.#container.hidden=!0,d&&this.#toggle()}render(){if(!this.#popup){var{page:{view:i},viewport:{rawDims:{pageWidth:s,pageHeight:a,pageX:r,pageY:n}}}=this.#parent,o=this.#popup=document.createElement("div");if(o.className="popup",this.#color){var l=o.style.outlineColor=_.Util.makeHexColor(...this.#color);if(CSS.supports("background-color","color-mix(in srgb, red 30%, white)"))o.style.backgroundColor=`color-mix(in srgb, ${l} 30%, white)`;else o.style.backgroundColor=_.Util.makeHexColor(...this.#color.map(t=>Math.floor(.7*(255-t)+t)))}var l=document.createElement("span"),h=(l.className="header",document.createElement("h1")),l=(l.append(h),{dir:h.dir,str:h.textContent}=this.#titleObj,o.append(l),this.#dateObj&&((h=document.createElement("span")).classList.add("popupDate"),h.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),h.setAttribute("data-l10n-args",JSON.stringify({date:this.#dateObj.toLocaleDateString(),time:this.#dateObj.toLocaleTimeString()})),l.append(h)),this.#contentsObj),h=this.#richText;!h?.str||l?.str&&l.str!==h.str?(l=this._formatContents(l),o.append(l)):(c.XfaLayer.render({xfaHtml:h.html,intent:"richText",div:o}),o.lastChild.classList.add("richText","popupContent"));let t=!!this.#parentRect,e=t?this.#parentRect:this.#rect;for(const d of this.#elements)if(!e||null!==_.Util.intersect(d.data.rect,e)){e=d.data.rect,t=!0;break}l=_.Util.normalizeRect([e[0],i[3]-e[1]+i[1],e[2],i[3]-e[3]+i[1]]),h=t?e[2]-e[0]+5:0,i=l[0]+h,h=l[1],l=this.#container["style"];l.left=100*(i-r)/s+"%",l.top=100*(h-n)/a+"%",this.#container.append(o)}}_formatContents({str:t,dir:e}){var i=document.createElement("p"),s=(i.classList.add("popupContent"),i.dir=e,t.split(/(?:\r\n?|\n)/));for(let t=0,e=s.length;t<e;++t){var a=s[t];i.append(document.createTextNode(a)),t<e-1&&i.append(document.createElement("br"))}return i}#keyDown(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||("Enter"===t.key||"Escape"===t.key&&this.#pinned)&&this.#toggle()}#toggle(){this.#pinned=!this.#pinned,this.#pinned?(this.#show(),this.#container.addEventListener("click",this.#boundToggle),this.#container.addEventListener("keydown",this.#boundKeyDown)):(this.#hide(),this.#container.removeEventListener("click",this.#boundToggle),this.#container.removeEventListener("keydown",this.#boundKeyDown))}#show(){this.#popup||this.render(),this.isVisible?this.#pinned&&this.#container.classList.add("focused"):(this.#container.hidden=!1,this.#container.style.zIndex=parseInt(this.#container.style.zIndex)+1e3)}#hide(){this.#container.classList.remove("focused"),!this.#pinned&&this.isVisible&&(this.#container.hidden=!0,this.#container.style.zIndex=parseInt(this.#container.style.zIndex)-1e3)}forceHide(){this.#wasVisible=this.isVisible,this.#wasVisible&&(this.#container.hidden=!0)}maybeShow(){this.#wasVisible&&(this.#wasVisible=!1,this.#container.hidden=!1)}get isVisible(){return!1===this.#container.hidden}}class C extends s{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=_.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){var t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const i of this.textContent){var e=document.createElement("span");e.textContent=i,t.append(e)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}class S extends s{#line=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");var t=this.data,{width:e,height:i}=g(t.rect),e=this.svgFactory.create(e,i,!0),i=this.#line=this.svgFactory.createElement("svg:line");return i.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),i.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),i.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),i.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),i.setAttribute("stroke-width",t.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),e.append(i),this.container.append(e),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#line}addHighlightArea(){this.container.classList.add("highlightArea")}}class T extends s{#square=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");var t=this.data,{width:e,height:i}=g(t.rect),s=this.svgFactory.create(e,i,!0),a=t.borderStyle.width,r=this.#square=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",a/2),r.setAttribute("y",a/2),r.setAttribute("width",e-a),r.setAttribute("height",i-a),r.setAttribute("stroke-width",a||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#square}addHighlightArea(){this.container.classList.add("highlightArea")}}class k extends s{#circle=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");var t=this.data,{width:e,height:i}=g(t.rect),s=this.svgFactory.create(e,i,!0),a=t.borderStyle.width,r=this.#circle=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",i/2),r.setAttribute("rx",e/2-a/2),r.setAttribute("ry",i/2-a/2),r.setAttribute("stroke-width",a||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#circle}addHighlightArea(){this.container.classList.add("highlightArea")}}class M extends s{#polyline=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);var t=this.data,{width:e,height:i}=g(t.rect),e=this.svgFactory.create(e,i,!0);let s=[];for(const n of t.vertices){var a=n.x-t.rect[0],r=t.rect[3]-n.y;s.push(a+","+r)}s=s.join(" ");i=this.#polyline=this.svgFactory.createElement(this.svgElementName);return i.setAttribute("points",s),i.setAttribute("stroke-width",t.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),e.append(i),this.container.append(e),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#polyline}addHighlightArea(){this.container.classList.add("highlightArea")}}class P extends M{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class R extends s{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class D extends s{#polylines=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=_.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);var e=this.data,{width:t,height:i}=g(e.rect),s=this.svgFactory.create(t,i,!0);for(const o of e.inkLists){let t=[];for(const l of o){var a=l.x-e.rect[0],r=e.rect[3]-l.y;t.push(a+","+r)}t=t.join(" ");var n=this.svgFactory.createElement(this.svgElementName);this.#polylines.push(n),n.setAttribute("points",t),n.setAttribute("stroke-width",e.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),!e.popupRef&&this.hasPopupData&&this._createPopup(),s.append(n)}return this.container.append(s),this.container}getElementsToTriggerPopup(){return this.#polylines}addHighlightArea(){this.container.classList.add("highlightArea")}}class I extends s{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class F extends s{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class N extends s{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class B extends s{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class L extends s{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class U extends s{#trigger=null;constructor(t){super(t,{isRenderable:!0});var{filename:t,content:e}=this.data.file;this.filename=(0,p.getFilenameFromUrl)(t,!0),this.content=e,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:t,content:e})}render(){this.container.classList.add("fileAttachmentAnnotation");var{container:t,data:e}=this;let i;e.hasAppearance||0===e.fillAlpha?i=document.createElement("div"):((i=document.createElement("img")).src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(100*e.fillAlpha)}%);`)),i.addEventListener("dblclick",this.#download.bind(this)),this.#trigger=i;const s=_.FeatureTest.platform["isMac"];return t.addEventListener("keydown",t=>{"Enter"===t.key&&(s?t.metaKey:t.ctrlKey)&&this.#download()}),!e.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return this.#trigger}addHighlightArea(){this.container.classList.add("highlightArea")}#download(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class z{#accessibilityManager=null;#annotationCanvasMap=null;#editableAnnotations=new Map;constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,page:s,viewport:a}){this.div=t,this.#accessibilityManager=e,this.#annotationCanvasMap=i,this.page=s,this.viewport=a,this.zIndex=0}#appendElement(t,e){var i=t.firstChild||t;i.id=""+_.AnnotationPrefix+e,this.div.append(t),this.#accessibilityManager?.moveElementInDOM(this.div,t,i,!1)}async render(t){var e=t["annotations"],i=this.div,s=((0,p.setLayerDimensions)(i,this.viewport),new Map),a={data:null,layer:i,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:!1!==t.renderForms,svgFactory:new p.DOMSVGFactory,annotationStorage:t.annotationStorage||new h.AnnotationStorage,enableScripting:!0===t.enableScripting,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const l of e)if(!l.noHTML){var r=l.annotationType===_.AnnotationType.POPUP;if(r){var n=s.get(l.id);if(!n)continue;a.elements=n}else{var{width:n,height:o}=g(l.rect);if(n<=0||o<=0)continue}a.data=l;o=d.create(a);o.isRenderable&&(!r&&l.popupRef&&((r=s.get(l.popupRef))?r.push(o):s.set(l.popupRef,[o])),0<o.annotationEditorType&&this.#editableAnnotations.set(o.data.id,o),r=o.render(),l.hidden&&(r.style.visibility="hidden"),this.#appendElement(r,l.id))}this.#setAnnotationCanvasMap()}update({viewport:t}){var e=this.div;this.viewport=t,(0,p.setLayerDimensions)(e,{rotation:t.rotation}),this.#setAnnotationCanvasMap(),e.hidden=!1}#setAnnotationCanvasMap(){if(this.#annotationCanvasMap){var t,e,i=this.div;for([t,e]of this.#annotationCanvasMap){var s,a=i.querySelector(`[data-annotation-id="${t}"]`);a&&(s=a["firstChild"],s?"CANVAS"===s.nodeName?s.replaceWith(e):s.before(e):a.append(e))}this.#annotationCanvasMap.clear()}}getEditableAnnotations(){return Array.from(this.#editableAnnotations.values())}getEditableAnnotation(t){return this.#editableAnnotations.get(t)}}},780:(t,e,i)=>{i.d(e,{AnnotationStorage:()=>a,PrintAnnotationStorage:()=>r,SerializableEmpty:()=>c});var s=i(266),h=i(115),d=i(825);const c=Object.freeze({map:null,hash:"",transfer:void 0});class a{#modified=!1;#storage=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){t=this.#storage.get(t);return void 0===t?e:Object.assign(e,t)}getRawValue(t){return this.#storage.get(t)}remove(t){if(this.#storage.delete(t),0===this.#storage.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){for(const e of this.#storage.values())if(e instanceof h.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(t,e){var i=this.#storage.get(t);let s=!1;if(void 0!==i)for(var[a,r]of Object.entries(e))i[a]!==r&&(s=!0,i[a]=r);else s=!0,this.#storage.set(t,e);s&&this.#setModified(),e instanceof h.AnnotationEditor&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#storage.has(t)}getAll(){return 0<this.#storage.size?(0,s.objectFromMap)(this.#storage):null}setAll(t){for(var[e,i]of Object.entries(t))this.setValue(e,i)}get size(){return this.#storage.size}#setModified(){this.#modified||(this.#modified=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#modified&&(this.#modified=!1,"function"==typeof this.onResetModified)&&this.onResetModified()}get print(){return new r(this)}get serializable(){if(0===this.#storage.size)return c;var t,e,i=new Map,s=new d.MurmurHash3_64,a=[],r=Object.create(null);let n=!1;for([t,e]of this.#storage){var o=e instanceof h.AnnotationEditor?e.serialize(!1,r):e;o&&(i.set(t,o),s.update(t+":"+JSON.stringify(o)),n||=!!o.bitmap)}if(n)for(const l of i.values())l.bitmap&&a.push(l.bitmap);return 0<i.size?{map:i,hash:s.hexdigest(),transfer:a}:c}}class r extends a{#serializable;constructor(t){super();var{map:t,hash:e,transfer:i}=t.serializable,t=structuredClone(t,i?{transfer:i}:null);this.#serializable={map:t,hash:e,transfer:i}}get print(){(0,s.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#serializable}}},406:(t,_,A)=>{A.a(t,async(t,e)=>{try{A.d(_,{PDFDataRangeTransport:()=>Z,PDFWorker:()=>tt,build:()=>b,getDocument:()=>function(t){"string"==typeof t||t instanceof URL?t={url:t}:(0,U.isArrayBuffer)(t)&&(t={data:t});if("object"!=typeof t)throw new Error("Invalid parameter in getDocument, need parameter object.");if(!t.url&&!t.data&&!t.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const i=new Q,s=i["docId"],a=t.url?function(t){if(t instanceof URL)return t.href;try{return new URL(t,window.location).href}catch{if(U.isNodeJS&&"string"==typeof t)return t}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(t.url):null,r=t.data?function(t){if(U.isNodeJS&&"undefined"!=typeof Buffer&&t instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength)return t;if("string"==typeof t)return(0,U.stringToBytes)(t);if("object"==typeof t&&!isNaN(t?.length)||(0,U.isArrayBuffer)(t))return new Uint8Array(t);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(t.data):null,n=t.httpHeaders||null,o=!0===t.withCredentials,e=t.password??null,l=t.range instanceof Z?t.range:null,h=Number.isInteger(t.rangeChunkSize)&&0<t.rangeChunkSize?t.rangeChunkSize:K;let d=t.worker instanceof tt?t.worker:null;const c=t.verbosity,u="string"!=typeof t.docBaseUrl||(0,z.isDataScheme)(t.docBaseUrl)?null:t.docBaseUrl,p="string"==typeof t.cMapUrl?t.cMapUrl:null,g=!1!==t.cMapPacked,m=t.CMapReaderFactory||Y,f="string"==typeof t.standardFontDataUrl?t.standardFontDataUrl:null,v=t.StandardFontDataFactory||J,b=!0!==t.stopAtErrors,_=Number.isInteger(t.maxImageSize)&&-1<t.maxImageSize?t.maxImageSize:-1,A=!1!==t.isEvalSupported,y="boolean"==typeof t.isOffscreenCanvasSupported?t.isOffscreenCanvasSupported:!U.isNodeJS,w=Number.isInteger(t.canvasMaxAreaInBytes)?t.canvasMaxAreaInBytes:-1,x="boolean"==typeof t.disableFontFace?t.disableFontFace:U.isNodeJS,E=!0===t.fontExtraProperties,C=!0===t.enableXfa,S=t.ownerDocument||globalThis.document,T=!0===t.disableRange,k=!0===t.disableStream,M=!0===t.disableAutoFetch,P=!0===t.pdfBug,R=l?l.length:t.length??NaN,D="boolean"==typeof t.useSystemFonts?t.useSystemFonts:!U.isNodeJS&&!x,I="boolean"==typeof t.useWorkerFetch?t.useWorkerFetch:m===z.DOMCMapReaderFactory&&v===z.DOMStandardFontDataFactory&&p&&f&&(0,z.isValidFetchUrl)(p,document.baseURI)&&(0,z.isValidFetchUrl)(f,document.baseURI),F=t.canvasFactory||new X({ownerDocument:S}),O=t.filterFactory||new $({docId:s,ownerDocument:S}),L=((0,U.setVerbosityLevel)(c),{canvasFactory:F,filterFactory:O});I||(L.cMapReaderFactory=new m({baseUrl:p,isCompressed:g}),L.standardFontDataFactory=new v({baseUrl:f}));d||(t={verbosity:c,port:H.GlobalWorkerOptions.workerPort},d=t.port?tt.fromPort(t):new tt(t),i._worker=d);const N={docId:s,apiVersion:"4.0.379",data:r,password:e,disableAutoFetch:M,rangeChunkSize:h,length:R,docBaseUrl:u,enableXfa:C,evaluatorOptions:{maxImageSize:_,disableFontFace:x,ignoreErrors:b,isEvalSupported:A,isOffscreenCanvasSupported:y,canvasMaxAreaInBytes:w,fontExtraProperties:E,useSystemFonts:D,cMapUrl:I?p:null,standardFontDataUrl:I?f:null}},B={ignoreErrors:b,isEvalSupported:A,disableFontFace:x,fontExtraProperties:E,enableXfa:C,ownerDocument:S,disableAutoFetch:M,pdfBug:P,styleElement:null};return d.promise.then(function(){if(i.destroyed)throw new Error("Loading aborted");var t=async function(t,e){if(t.destroyed)throw new Error("Worker was destroyed");e=await t.messageHandler.sendWithPromise("GetDocRequest",e,e.data?[e.data.buffer]:null);if(t.destroyed)throw new Error("Worker was destroyed");return e}(d,N),e=new Promise(function(t){let e;var i;l?e=new V.PDFDataTransportStream({length:R,initialData:l.initialData,progressiveDone:l.progressiveDone,contentDispositionFilename:l.contentDispositionFilename,disableRange:T,disableStream:k},l):r||(e=(i={url:a,length:R,httpHeaders:n,withCredentials:o,rangeChunkSize:h,disableRange:T,disableStream:k},new(U.isNodeJS?W.PDFNodeStream:(0,z.isValidFetchUrl)(i.url)?G.PDFFetchStream:q.PDFNetworkStream)(i))),t(e)});return Promise.all([t,e]).then(function([t,e]){if(i.destroyed)throw new Error("Loading aborted");t=new j.MessageHandler(s,t,d.port),e=new et(t,i,e,B,L);i._transport=e,t.send("Ready",null)})}).catch(i._capability.reject),i},version:()=>v});var U=A(266),o=A(780),z=A(473),d=A(742),i=A(738),n=A(250),H=A(368),j=A(694),s=A(472),a=A(890),V=A(92),G=A(171),q=A(474),W=A(498),r=A(521),l=t([i,W]);[i,W]=l.then?(await l)():l;const K=65536,X=U.isNodeJS?i.NodeCanvasFactory:z.DOMCanvasFactory,Y=U.isNodeJS?i.NodeCMapReaderFactory:z.DOMCMapReaderFactory,$=U.isNodeJS?i.NodeFilterFactory:z.DOMFilterFactory,J=U.isNodeJS?i.NodeStandardFontDataFactory:z.DOMStandardFontDataFactory;class Q{static#docId=0;constructor(){this._capability=new U.PromiseCapability,this._transport=null,this._worker=null,this.docId="d"+Q.#docId++,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class Z{constructor(t,e,i=!1,s=null){this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new U.PromiseCapability}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const i of this._rangeListeners)i(t,e)}onDataProgress(e,i){this._readyCapability.promise.then(()=>{for(const t of this._progressListeners)t(e,i)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){(0,U.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class c{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,U.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class h{#delayedCleanupTimeout=null;#pendingCleanup=!1;constructor(t,e,i,s=!1){this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=s?new z.StatTimer:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new g,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:a=!1}={}){return new z.PageViewport({viewBox:this.view,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:a})}getAnnotations({intent:t="display"}={}){t=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,t.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,U.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,viewport:e,intent:i="display",annotationMode:s=U.AnnotationMode.ENABLE,transform:a=null,background:r=null,optionalContentConfigPromise:n=null,annotationCanvasMap:o=null,pageColors:l=null,printAnnotationStorage:h=null}){this._stats?.time("Overall");i=this._transport.getRenderingIntent(i,s,h);this.#pendingCleanup=!1,this.#abortDelayedCleanup(),n=n||this._transport.getOptionalContentConfig();let d=this._intentStates.get(i.cacheKey);d||(d=Object.create(null),this._intentStates.set(i.cacheKey,d)),d.streamReaderCancelTimeout&&(clearTimeout(d.streamReaderCancelTimeout),d.streamReaderCancelTimeout=null);const c=!!(i.renderingIntent&U.RenderingIntentFlag.PRINT),u=(d.displayReadyCapability||(d.displayReadyCapability=new U.PromiseCapability,d.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(i)),t=>{d.renderTasks.delete(p),(this._maybeCleanupAfterRender||c)&&(this.#pendingCleanup=!0),this.#tryCleanup(!c),t?(p.capability.reject(t),this._abortOperatorList({intentState:d,reason:t instanceof Error?t:new Error(t)})):p.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")}),p=new f({callback:u,params:{canvasContext:t,viewport:e,transform:a,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:o,operatorList:d.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!c,pdfBug:this._pdfBug,pageColors:l});(d.renderTasks||=new Set).add(p);s=p.task;return Promise.all([d.displayReadyCapability.promise,n]).then(([t,e])=>{this.destroyed?u():(this._stats?.time("Rendering"),p.initializeGraphics({transparency:t,optionalContentConfig:e}),p.operatorListChanged())}).catch(u),s}getOperatorList({intent:t="display",annotationMode:e=U.AnnotationMode.ENABLE,printAnnotationStorage:i=null}={}){t=this._transport.getRenderingIntent(t,e,i,!0);let s=this._intentStates.get(t.cacheKey);s||(s=Object.create(null),this._intentStates.set(t.cacheKey,s));let a;return s.opListReadCapability||((a=Object.create(null)).operatorListChanged=function(){s.operatorList.lastChunk&&(s.opListReadCapability.resolve(s.operatorList),s.renderTasks.delete(a))},s.opListReadCapability=new U.PromiseCapability,(s.renderTasks||=new Set).add(a),s.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(t)),s.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===t,disableNormalization:!0===e},{highWaterMark:100,size(t){return t.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(t=>r.XfaText.textContent(t));const i=this.streamTextContent(t);return new Promise(function(s,t){const e=i.getReader(),a={items:[],styles:Object.create(null)};!function i(){e.read().then(function({value:t,done:e}){e?s(a):(Object.assign(a.styles,t.styles),a.items.push(...t.items),i())},t)}()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;var t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),this.#pendingCleanup=!1,this.#abortDelayedCleanup(),Promise.all(t)}cleanup(t=!1){this.#pendingCleanup=!0;var e=this.#tryCleanup(!1);return t&&e&&(this._stats&&=new z.StatTimer),e}#tryCleanup(t=!1){if(this.#abortDelayedCleanup(),!this.#pendingCleanup||this.destroyed)return!1;if(t)return this.#delayedCleanupTimeout=setTimeout(()=>{this.#delayedCleanupTimeout=null,this.#tryCleanup(!1)},5e3),!1;for(var{renderTasks:e,operatorList:i}of this._intentStates.values())if(0<e.size||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),!(this.#pendingCleanup=!1)}#abortDelayedCleanup(){this.#delayedCleanupTimeout&&(clearTimeout(this.#delayedCleanupTimeout),this.#delayedCleanupTimeout=null)}_startRenderPage(t,e){e=this._intentStates.get(e);e&&(this._stats?.timeEnd("Page Request"),e.displayReadyCapability?.resolve(t))}_renderPageChunk(i,s){for(let t=0,e=i.length;t<e;t++)s.operatorList.fnArray.push(i.fnArray[t]),s.operatorList.argsArray.push(i.argsArray[t]);s.operatorList.lastChunk=i.lastChunk,s.operatorList.separateAnnots=i.separateAnnots;for(const t of s.renderTasks)t.operatorListChanged();i.lastChunk&&this.#tryCleanup(!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i}){var{map:i,transfer:s}=i;const a=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:i},s).getReader(),r=this._intentStates.get(e),n=(r.streamReader=a,()=>{a.read().then(({value:t,done:e})=>{e?r.streamReader=null:this._transport.destroyed||(this._renderPageChunk(t,r),n())},t=>{if(r.streamReader=null,!this._transport.destroyed){if(r.operatorList){r.operatorList.lastChunk=!0;for(const e of r.renderTasks)e.operatorListChanged();this.#tryCleanup(!0)}if(r.displayReadyCapability)r.displayReadyCapability.reject(t);else{if(!r.opListReadCapability)throw t;r.opListReadCapability.reject(t)}}})});n()}_abortOperatorList({intentState:e,reason:i,force:t=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!t){if(0<e.renderTasks.size)return;if(i instanceof z.RenderingCancelledException){let t=100;return 0<i.extraDelay&&i.extraDelay<1e3&&(t+=i.extraDelay),void(e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:i,force:!0})},t))}}if(e.streamReader.cancel(new U.AbortException(i.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(var[s,a]of this._intentStates)if(a===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}class u{#listeners=new Set;#deferred=Promise.resolve();postMessage(t,e){const i={data:structuredClone(t,e?{transfer:e}:null)};this.#deferred.then(()=>{for(const t of this.#listeners)t.call(this,i)})}addEventListener(t,e){this.#listeners.add(e)}removeEventListener(t,e){this.#listeners.delete(e)}terminate(){this.#listeners.clear()}}const p={isWorkerDisabled:!1,fakeWorkerId:0};U.isNodeJS&&(p.isWorkerDisabled=!0,H.GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),p.isSameOrigin=function(t,e){let i;try{if(!(i=new URL(t)).origin||"null"===i.origin)return!1}catch{return!1}t=new URL(e,i);return i.origin===t.origin},p.createCDNWrapper=function(t){return URL.createObjectURL(new Blob([`await import("${t}");`],{type:"text/javascript"}))};class tt{static#workerPorts;constructor({name:t=null,port:e=null,verbosity:i=(0,U.getVerbosityLevel)()}={}){if(this.name=t,this.destroyed=!1,this.verbosity=i,this._readyCapability=new U.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,e){if(tt.#workerPorts?.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(tt.#workerPorts||=new WeakMap).set(e,this),this._initializeFromPort(e)}else this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new j.MessageHandler("main","worker",t),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!p.isWorkerDisabled&&!tt.#mainThreadWorkerMessageHandler){let t=tt["workerSrc"];try{p.isSameOrigin(window.location.href,t)||(t=p.createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),i=new j.MessageHandler("main","worker",e),s=()=>{e.removeEventListener("error",a),i.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},a=()=>{this._webWorker||s()},r=(e.addEventListener("error",a),i.on("test",t=>{e.removeEventListener("error",a),this.destroyed?s():t?(this._messageHandler=i,this._port=e,this._webWorker=e,this._readyCapability.resolve(),i.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),i.destroy(),e.terminate())}),i.on("ready",t=>{if(e.removeEventListener("error",a),this.destroyed)s();else try{r()}catch{this._setupFakeWorker()}}),()=>{var t=new Uint8Array;i.send("test",t,[t.buffer])});return void r()}catch{(0,U.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){p.isWorkerDisabled||((0,U.warn)("Setting up fake worker."),p.isWorkerDisabled=!0),tt._setupFakeWorkerGlobal.then(t=>{var e,i,s;this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):(e=new u,this._port=e,i="fake"+p.fakeWorkerId++,s=new j.MessageHandler(i+"_worker",i,e),t.setup(s,e),t=new j.MessageHandler(i,i+"_worker",e),this._messageHandler=t,this._readyCapability.resolve(),t.send("configure",{verbosity:this.verbosity}))}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),tt.#workerPorts?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(t){if(!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");var e=this.#workerPorts?.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new tt(t)}static get workerSrc(){if(H.GlobalWorkerOptions.workerSrc)return H.GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return(0,U.shadow)(this,"_setupFakeWorkerGlobal",(async()=>{return this.#mainThreadWorkerMessageHandler||(await import(this.workerSrc)).WorkerMessageHandler})())}}class et{#methodPromises=new Map;#pageCache=new Map;#pagePromises=new Map;#passwordCapability=null;constructor(t,e,i,s,a){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new g,this.fontLoader=new d.FontLoader({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this._params=s,this.canvasFactory=a.canvasFactory,this.filterFactory=a.filterFactory,this.cMapReaderFactory=a.cMapReaderFactory,this.standardFontDataFactory=a.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new U.PromiseCapability,this.setupMessageHandler()}#cacheSimpleMethod(t,e=null){var i=this.#methodPromises.get(t);return i||(i=this.messageHandler.sendWithPromise(t,e),this.#methodPromises.set(t,i),i)}get annotationStorage(){return(0,U.shadow)(this,"annotationStorage",new o.AnnotationStorage)}getRenderingIntent(t,e=U.AnnotationMode.ENABLE,i=null,s=!1){let a=U.RenderingIntentFlag.DISPLAY,r=o.SerializableEmpty;switch(t){case"any":a=U.RenderingIntentFlag.ANY;break;case"display":break;case"print":a=U.RenderingIntentFlag.PRINT;break;default:(0,U.warn)("getRenderingIntent - invalid intent: "+t)}switch(e){case U.AnnotationMode.DISABLE:a+=U.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case U.AnnotationMode.ENABLE:break;case U.AnnotationMode.ENABLE_FORMS:a+=U.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case U.AnnotationMode.ENABLE_STORAGE:var n=(a+=U.RenderingIntentFlag.ANNOTATIONS_STORAGE)&U.RenderingIntentFlag.PRINT&&i instanceof o.PrintAnnotationStorage?i:this.annotationStorage;r=n.serializable;break;default:(0,U.warn)("getRenderingIntent - invalid annotationMode: "+e)}return s&&(a+=U.RenderingIntentFlag.OPLIST),{renderingIntent:a,cacheKey:a+"_"+r.hash,annotationStorageSerializable:r}}destroy(){if(!this.destroyCapability){this.destroyed=!0,this.destroyCapability=new U.PromiseCapability,this.#passwordCapability?.reject(new Error("Worker was destroyed during onPassword callback"));var t=[];for(const i of this.#pageCache.values())t.push(i._destroy());this.#pageCache.clear(),this.#pagePromises.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();var e=this.messageHandler.sendWithPromise("Terminate",null);t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#methodPromises.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new U.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject)}return this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:h,loadingTask:s}=this;h.on("GetReader",(t,i)=>{(0,U.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=t=>{this._lastProgress={loaded:t.loaded,total:t.total}},i.onPull=()=>{this._fullReader.read().then(function({value:t,done:e}){e?i.close():((0,U.assert)(t instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(t),1,[t]))}).catch(t=>{i.error(t)})},i.onCancel=t=>{this._fullReader.cancel(t),i.ready.catch(t=>{if(!this.destroyed)throw t})}}),h.on("ReaderHeadersReady",t=>{const e=new U.PromiseCapability,i=this._fullReader;return i.headersReady.then(()=>{i.isStreamingSupported&&i.isRangeSupported||(this._lastProgress&&s.onProgress?.(this._lastProgress),i.onProgress=t=>{s.onProgress?.({loaded:t.loaded,total:t.total})}),e.resolve({isStreamingSupported:i.isStreamingSupported,isRangeSupported:i.isRangeSupported,contentLength:i.contentLength})},e.reject),e.promise}),h.on("GetRangeReader",(t,i)=>{(0,U.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const e=this._networkStream.getRangeReader(t.begin,t.end);e?(i.onPull=()=>{e.read().then(function({value:t,done:e}){e?i.close():((0,U.assert)(t instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(t),1,[t]))}).catch(t=>{i.error(t)})},i.onCancel=t=>{e.cancel(t),i.ready.catch(t=>{if(!this.destroyed)throw t})}):i.close()}),h.on("GetDoc",({pdfInfo:t})=>{this._numPages=t.numPages,this._htmlForXfa=t.htmlForXfa,delete t.htmlForXfa,s._capability.resolve(new c(t,this))}),h.on("DocException",function(t){let e;switch(t.name){case"PasswordException":e=new U.PasswordException(t.message,t.code);break;case"InvalidPDFException":e=new U.InvalidPDFException(t.message);break;case"MissingPDFException":e=new U.MissingPDFException(t.message);break;case"UnexpectedResponseException":e=new U.UnexpectedResponseException(t.message,t.status);break;case"UnknownErrorException":e=new U.UnknownErrorException(t.message,t.details);break;default:(0,U.unreachable)("DocException - expected a valid Error.")}s._capability.reject(e)}),h.on("PasswordRequest",t=>{if(this.#passwordCapability=new U.PromiseCapability,s.onPassword){var e=t=>{t instanceof Error?this.#passwordCapability.reject(t):this.#passwordCapability.resolve({password:t})};try{s.onPassword(e,t.code)}catch(t){this.#passwordCapability.reject(t)}}else this.#passwordCapability.reject(new U.PasswordException(t.message,t.code));return this.#passwordCapability.promise}),h.on("DataLoaded",t=>{s.onProgress?.({loaded:t.length,total:t.length}),this.downloadInfoCapability.resolve(t)}),h.on("StartRenderPage",t=>{this.destroyed||this.#pageCache.get(t.pageIndex)._startRenderPage(t.transparency,t.cacheKey)}),h.on("commonobj",([e,t,i])=>{if(!this.destroyed&&!this.commonObjs.has(e))switch(t){case"Font":const n=this._params;if("error"in i){var s=i.error;(0,U.warn)("Error during font loading: "+s),this.commonObjs.resolve(e,s)}else{s=n.pdfBug&&globalThis.FontInspector?.enabled?(t,e)=>globalThis.FontInspector.fontAdded(t,e):null;const o=new d.FontFaceObject(i,{isEvalSupported:n.isEvalSupported,disableFontFace:n.disableFontFace,ignoreErrors:n.ignoreErrors,inspectFont:s});this.fontLoader.bind(o).catch(t=>h.sendWithPromise("FontFallback",{id:e})).finally(()=>{!n.fontExtraProperties&&o.data&&(o.data=null),this.commonObjs.resolve(e,o)})}break;case"CopyLocalImage":var a=i["imageRef"];(0,U.assert)(a,"The imageRef must be defined.");for(const l of this.#pageCache.values())for(var[,r]of l.objs)if(r.ref===a)return r.dataLen?(this.commonObjs.resolve(e,structuredClone(r)),r.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(e,i);break;default:throw new Error("Got unknown common object type "+t)}return null}),h.on("obj",([t,e,i,s])=>{if(!this.destroyed){var a=this.#pageCache.get(e);if(!a.objs.has(t))if(0===a._intentStates.size)s?.bitmap?.close();else switch(i){case"Image":a.objs.resolve(t,s),s?.dataLen>U.MAX_IMAGE_SIZE_TO_CACHE&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(t,s);break;default:throw new Error("Got unknown object type "+i)}}}),h.on("DocProgress",t=>{this.destroyed||s.onProgress?.({loaded:t.loaded,total:t.total})}),h.on("FetchBuiltInCMap",t=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(t):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),h.on("FetchStandardFontData",t=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(t):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,U.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");var{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,i=this.#pagePromises.get(e);return i||(t=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(t=>{if(this.destroyed)throw new Error("Transport destroyed");t=new h(e,t,this,this._params.pdfBug);return this.#pageCache.set(e,t),t}),this.#pagePromises.set(e,t),t)}getPageIndex(t){return"object"!=typeof t||null===t||!Number.isInteger(t.num)||t.num<0||!Number.isInteger(t.gen)||t.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen})}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#cacheSimpleMethod("GetFieldObjects")}hasJSActions(){return this.#cacheSimpleMethod("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return"string"!=typeof t?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#cacheSimpleMethod("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(t=>new a.OptionalContentConfig(t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){var t="GetMetadata",e=this.#methodPromises.get(t);return e||(e=this.messageHandler.sendWithPromise(t,null).then(t=>({info:t[0],metadata:t[1]?new s.Metadata(t[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null})),this.#methodPromises.set(t,e),e)}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#pageCache.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#methodPromises.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){var{disableAutoFetch:t,enableXfa:e}=this._params;return(0,U.shadow)(this,"loadingParams",{disableAutoFetch:t,enableXfa:e})}}class g{#objs=Object.create(null);#ensureObj(t){return this.#objs[t]||={capability:new U.PromiseCapability,data:null}}get(t,e=null){if(e){const i=this.#ensureObj(t);return i.capability.promise.then(()=>e(i.data)),null}const i=this.#objs[t];if(i?.capability.settled)return i.data;throw new Error(`Requesting object that isn't resolved yet ${t}.`)}has(t){return this.#objs[t]?.capability.settled??!1}resolve(t,e=null){t=this.#ensureObj(t);t.data=e,t.capability.resolve()}clear(){for(const e in this.#objs){var t=this.#objs[e]["data"];t?.bitmap?.close()}this.#objs=Object.create(null)}*[Symbol.iterator](){for(const i in this.#objs){var{capability:t,data:e}=this.#objs[i];t.settled&&(yield[i,e])}}}class m{#internalRenderTask=null;constructor(t){this.#internalRenderTask=t,this.onContinue=null}get promise(){return this.#internalRenderTask.capability.promise}cancel(t=0){this.#internalRenderTask.cancel(null,t)}get separateAnnots(){var t,e=this.#internalRenderTask.operatorList["separateAnnots"];return!!e&&(t=this.#internalRenderTask["annotationCanvasMap"],e.form||e.canvas&&0<t?.size)}}class f{static#canvasInUse=new WeakSet;constructor({callback:t,params:e,objs:i,commonObjs:s,annotationCanvasMap:a,operatorList:r,pageIndex:n,canvasFactory:o,filterFactory:l,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:c=null}){this.callback=t,this.params=e,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=a,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=n,this.canvasFactory=o,this.filterFactory=l,this._pdfBug=d,this.pageColors=c,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===h&&"undefined"!=typeof window,this.cancelled=!1,this.capability=new U.PromiseCapability,this.task=new m(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(!this.cancelled){if(this._canvas){if(f.#canvasInUse.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");f.#canvasInUse.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());var{canvasContext:i,viewport:s,transform:a,background:r}=this.params;this.gfx=new n.CanvasGraphics(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:a,viewport:s,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),f.#canvasInUse.delete(this._canvas),this.callback(t||new z.RenderingCancelledException("Rendering cancelled, page "+(this._pageIndex+1),e))}operatorListChanged(){this.graphicsReady?(this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk)&&(this.gfx.endDrawing(),f.#canvasInUse.delete(this._canvas),this.callback()))}}const v="4.0.379",b="9e14d04fd";e()}catch(t){e(t)}})},822:(t,e,i)=>{i.d(e,{BaseCMapReaderFactory:()=>n,BaseCanvasFactory:()=>r,BaseFilterFactory:()=>a,BaseSVGFactory:()=>l,BaseStandardFontDataFactory:()=>o});var s=i(266);class a{constructor(){this.constructor===a&&(0,s.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addHighlightHCMFilter(t,e,i,s){return"none"}destroy(t=0){}}class r{constructor(){this.constructor===r&&(0,s.unreachable)("Cannot initialize BaseCanvasFactory.")}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");t=this._createCanvas(t,e);return{canvas:t,context:t.getContext("2d")}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){(0,s.unreachable)("Abstract method `_createCanvas` called.")}}class n{constructor({baseUrl:t=null,isCompressed:e=!0}){this.constructor===n&&(0,s.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");t=this.isCompressed?s.CMapCompressionType.BINARY:s.CMapCompressionType.NONE;return this._fetchData(e,t).catch(t=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: `+e)})}_fetchData(t,e){(0,s.unreachable)("Abstract method `_fetchData` called.")}}class o{constructor({baseUrl:t=null}){this.constructor===o&&(0,s.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!t)throw new Error("Font filename must be specified.");const e=""+this.baseUrl+t;return this._fetchData(e).catch(t=>{throw new Error("Unable to load font data at: "+e)})}_fetchData(t){(0,s.unreachable)("Abstract method `_fetchData` called.")}}class l{constructor(){this.constructor===l&&(0,s.unreachable)("Cannot initialize BaseSVGFactory.")}create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");var s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",t+"px"),s.setAttribute("height",e+"px")),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} `+e),s}createElement(t){if("string"!=typeof t)throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){(0,s.unreachable)("Abstract method `_createSVG` called.")}}},250:(O,t,e)=>{e.d(t,{CanvasGraphics:()=>F});var M=e(266),P=e(473);const R={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function o(t,e){var i,s,a;e&&(i=e[2]-e[0],s=e[3]-e[1],(a=new Path2D).rect(e[0],e[1],i,s),t.clip(a))}class i{constructor(){this.constructor===i&&(0,M.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,M.unreachable)("Abstract method `getPattern` called.")}}class s extends i{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;"axial"===this._type?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)e.addColorStop(i[0],i[1]);return e}getPattern(t,e,i,s){let a;var r,n;return s===R.STROKE||s===R.FILL?(s=e.current.getClippedPathBoundingBox(s,(0,P.getCurrentTransform)(t))||[0,0,0,0],r=Math.ceil(s[2]-s[0])||1,n=Math.ceil(s[3]-s[1])||1,(n=(r=e.cachedCanvases.getCanvas("pattern",r,n,!0)).context).clearRect(0,0,n.canvas.width,n.canvas.height),n.beginPath(),n.rect(0,0,n.canvas.width,n.canvas.height),n.translate(-s[0],-s[1]),i=M.Util.transform(i,[1,0,0,1,s[0],s[1]]),n.transform(...e.baseTransform),this.matrix&&n.transform(...this.matrix),o(n,this._bbox),n.fillStyle=this._createGradient(n),n.fill(),a=t.createPattern(r.canvas,"no-repeat"),s=new DOMMatrix(i),a.setTransform(s)):(o(t,this._bbox),a=this._createGradient(t)),a}}function d(t,e,i,s,a,l,h,d){var r=e.coords,c=e.colors,u=t.data,p=4*t.width;let n;r[i+1]>r[s+1]&&(n=i,i=s,s=n,n=l,l=h,h=n),r[s+1]>r[a+1]&&(n=s,s=a,a=n,n=h,h=d,d=n),r[i+1]>r[s+1]&&(n=i,i=s,s=n,n=l,l=h,h=n);var g=(r[i]+e.offsetX)*e.scaleX,m=(r[i+1]+e.offsetY)*e.scaleY,f=(r[s]+e.offsetX)*e.scaleX,v=(r[s+1]+e.offsetY)*e.scaleY,b=(r[a]+e.offsetX)*e.scaleX,_=(r[a+1]+e.offsetY)*e.scaleY;if(!(_<=m)){var A=c[l],y=c[l+1],w=c[l+2],x=c[h],E=c[h+1],C=c[h+2],S=c[d],T=c[d+1],k=c[d+2],t=Math.round(m),M=Math.round(_);let a,r,n,o;for(let s=t;s<=M;s++){if(s<v){var P=s<m?0:(m-s)/(m-v);a=g-(g-f)*P,r=A-(A-x)*P,n=y-(y-E)*P,o=w-(w-C)*P}else{let t;t=s>_?1:v==_?0:(v-s)/(v-_),a=f-(f-b)*t,r=x-(x-S)*t,n=E-(E-T)*t,o=C-(C-k)*t}let e;var R=g-(g-b)*(e=s<m?0:s>_?1:(m-s)/(m-_)),D=A-(A-S)*e,I=y-(y-T)*e,F=w-(w-k)*e,P=Math.round(Math.min(a,R)),L=Math.round(Math.max(a,R));let i=p*s+4*P;for(let t=P;t<=L;t++)(e=(a-t)/(a-R))<0?e=0:1<e&&(e=1),u[i++]=r-(r-D)*e|0,u[i++]=n-(n-I)*e|0,u[i++]=o-(o-F)*e|0,u[i++]=255}}}function p(i,t,s){var a=t.coords,r=t.colors;let n,e;switch(t.type){case"lattice":var o=t.verticesPerRow,l=Math.floor(a.length/o)-1,h=o-1;for(n=0;n<l;n++){let e=n*o;for(let t=0;t<h;t++,e++)d(i,s,a[e],a[e+1],a[e+o],r[e],r[e+1],r[e+o]),d(i,s,a[e+o+1],a[e+1],a[e+o],r[e+o+1],r[e+1],r[e+o])}break;case"triangles":for(n=0,e=a.length;n<e;n+=3)d(i,s,a[n],a[n+1],a[n+2],r[n],r[n+1],r[n+2]);break;default:throw new Error("illegal figure")}}class a extends i{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,i,e){var s=Math.floor(this._bounds[0]),a=Math.floor(this._bounds[1]),r=Math.ceil(this._bounds[2])-s,n=Math.ceil(this._bounds[3])-a,o=Math.min(Math.ceil(Math.abs(r*t[0]*1.1)),3e3),t=Math.min(Math.ceil(Math.abs(n*t[1]*1.1)),3e3),r=r/o,n=n/t,l={coords:this._coords,colors:this._colors,offsetX:-s,offsetY:-a,scaleX:1/r,scaleY:1/n},e=e.getCanvas("mesh",o+4,t+4,!1),h=e.context,d=h.createImageData(o,t);if(i){var c=d.data;for(let t=0,e=c.length;t<e;t+=4)c[t]=i[0],c[t+1]=i[1],c[t+2]=i[2],c[t+3]=255}for(const u of this._figures)p(d,u,l);return h.putImageData(d,2,2),{canvas:e.canvas,offsetX:s-2*r,offsetY:a-2*n,scaleX:r,scaleY:n}}getPattern(t,e,i,s){o(t,this._bbox);let a;s===R.SHADING?a=M.Util.singularValueDecompose2dScale((0,P.getCurrentTransform)(t)):(a=M.Util.singularValueDecompose2dScale(e.baseTransform),this.matrix&&(r=M.Util.singularValueDecompose2dScale(this.matrix),a=[a[0]*r[0],a[1]*r[1]]));var r=this._createMeshCanvas(a,s===R.SHADING?null:this._background,e.cachedCanvases);return s!==R.SHADING&&(t.setTransform(...e.baseTransform),this.matrix)&&t.transform(...this.matrix),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class r extends i{getPattern(){return"hotpink"}}function n(t){switch(t[0]){case"RadialAxial":return new s(t);case"Mesh":return new a(t);case"Dummy":return new r}throw new Error("Unknown IR type: "+t[0])}const l={COLORED:1,UNCOLORED:2};class h{static MAX_PATTERN_SIZE=3e3;constructor(t,e,i,s,a){this.operatorList=t[2],this.matrix=t[3]||[1,0,0,1,0,0],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.ctx=i,this.canvasGraphicsFactory=s,this.baseTransform=a}createPatternCanvas(t){var e=this.operatorList,i=this.bbox,s=this.xstep,a=this.ystep,r=this.paintType,n=this.tilingType,o=this.color,l=this.canvasGraphicsFactory,n=((0,M.info)("TilingType: "+n),i[0]),h=i[1],d=i[2],i=i[3],c=M.Util.singularValueDecompose2dScale(this.matrix),u=M.Util.singularValueDecompose2dScale(this.baseTransform),c=[c[0]*u[0],c[1]*u[1]],u=this.getSizeAndScale(s,this.ctx.canvas.width,c[0]),s=this.getSizeAndScale(a,this.ctx.canvas.height,c[1]),a=t.cachedCanvases.getCanvas("pattern",u.size,s.size,!0),c=a.context,l=l.createCanvasGraphics(c);l.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(l,r,o);let p=n,g=h,m=d,f=i;return n<0&&(p=0,m+=Math.abs(n)),h<0&&(g=0,f+=Math.abs(h)),c.translate(-(u.scale*p),-(s.scale*g)),l.transform(u.scale,0,0,s.scale,0,0),c.save(),this.clipBbox(l,p,g,m,f),l.baseTransform=(0,P.getCurrentTransform)(l.ctx),l.executeOperatorList(e),l.endDrawing(),{canvas:a.canvas,scaleX:u.scale,scaleY:s.scale,offsetX:p,offsetY:g}}getSizeAndScale(t,e,i){t=Math.abs(t);e=Math.max(h.MAX_PATTERN_SIZE,e);let s=Math.ceil(t*i);return s>=e?s=e:i=s/t,{scale:i,size:s}}clipBbox(t,e,i,s,a){t.ctx.rect(e,i,s-e,a-i),t.current.updateRectMinMax((0,P.getCurrentTransform)(t.ctx),[e,i,s,a]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,i){var s=t.ctx,a=t.current;switch(e){case l.COLORED:var r=this.ctx;s.fillStyle=r.fillStyle,s.strokeStyle=r.strokeStyle,a.fillColor=r.fillStyle,a.strokeColor=r.strokeStyle;break;case l.UNCOLORED:r=M.Util.makeHexColor(i[0],i[1],i[2]);s.fillStyle=r,s.strokeStyle=r,a.fillColor=r,a.strokeColor=r;break;default:throw new M.FormatError("Unsupported paint type: "+e)}}getPattern(t,e,i,s){let a=i;s!==R.SHADING&&(a=M.Util.transform(a,e.baseTransform),this.matrix)&&(a=M.Util.transform(a,this.matrix));i=this.createPatternCanvas(e);let r=new DOMMatrix(a);r=(r=r.translate(i.offsetX,i.offsetY)).scale(1/i.scaleX,1/i.scaleY);s=t.createPattern(i.canvas,"repeat");return s.setTransform(r),s}}function u({src:e,srcPos:i=0,dest:s,width:t,height:a,nonBlackColor:r=4294967295,inverseDecode:n=!1}){var o=M.FeatureTest.isLittleEndian?4278190080:255,[l,h]=n?[r,o]:[o,r],d=t>>3,c=7&t,u=e.length;s=new Uint32Array(s.buffer);let p=0;for(let t=0;t<a;t++){for(var g=i+d;i<g;i++){var m=i<u?e[i]:255;s[p++]=128&m?h:l,s[p++]=64&m?h:l,s[p++]=32&m?h:l,s[p++]=16&m?h:l,s[p++]=8&m?h:l,s[p++]=4&m?h:l,s[p++]=2&m?h:l,s[p++]=1&m?h:l}if(0!=c){var f=i<u?e[i++]:255;for(let t=0;t<c;t++)s[p++]=f&1<<7-t?h:l}}return{srcPos:i,destPos:p}}const g=4096;function c(t,n){if(t._removeMirroring)throw new Error("Context is already forwarding operations.");t.__originalSave=t.save,t.__originalRestore=t.restore,t.__originalRotate=t.rotate,t.__originalScale=t.scale,t.__originalTranslate=t.translate,t.__originalTransform=t.transform,t.__originalSetTransform=t.setTransform,t.__originalResetTransform=t.resetTransform,t.__originalClip=t.clip,t.__originalMoveTo=t.moveTo,t.__originalLineTo=t.lineTo,t.__originalBezierCurveTo=t.bezierCurveTo,t.__originalRect=t.rect,t.__originalClosePath=t.closePath,t.__originalBeginPath=t.beginPath,t._removeMirroring=()=>{t.save=t.__originalSave,t.restore=t.__originalRestore,t.rotate=t.__originalRotate,t.scale=t.__originalScale,t.translate=t.__originalTranslate,t.transform=t.__originalTransform,t.setTransform=t.__originalSetTransform,t.resetTransform=t.__originalResetTransform,t.clip=t.__originalClip,t.moveTo=t.__originalMoveTo,t.lineTo=t.__originalLineTo,t.bezierCurveTo=t.__originalBezierCurveTo,t.rect=t.__originalRect,t.closePath=t.__originalClosePath,t.beginPath=t.__originalBeginPath,delete t._removeMirroring},t.save=function(){n.save(),this.__originalSave()},t.restore=function(){n.restore(),this.__originalRestore()},t.translate=function(t,e){n.translate(t,e),this.__originalTranslate(t,e)},t.scale=function(t,e){n.scale(t,e),this.__originalScale(t,e)},t.transform=function(t,e,i,s,a,r){n.transform(t,e,i,s,a,r),this.__originalTransform(t,e,i,s,a,r)},t.setTransform=function(t,e,i,s,a,r){n.setTransform(t,e,i,s,a,r),this.__originalSetTransform(t,e,i,s,a,r)},t.resetTransform=function(){n.resetTransform(),this.__originalResetTransform()},t.rotate=function(t){n.rotate(t),this.__originalRotate(t)},t.clip=function(t){n.clip(t),this.__originalClip(t)},t.moveTo=function(t,e){n.moveTo(t,e),this.__originalMoveTo(t,e)},t.lineTo=function(t,e){n.lineTo(t,e),this.__originalLineTo(t,e)},t.bezierCurveTo=function(t,e,i,s,a,r){n.bezierCurveTo(t,e,i,s,a,r),this.__originalBezierCurveTo(t,e,i,s,a,r)},t.rect=function(t,e,i,s){n.rect(t,e,i,s),this.__originalRect(t,e,i,s)},t.closePath=function(){n.closePath(),this.__originalClosePath()},t.beginPath=function(){n.beginPath(),this.__originalBeginPath()}}class m{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let s;return void 0!==this.cache[t]?(s=this.cache[t],this.canvasFactory.reset(s,e,i)):(s=this.canvasFactory.create(e,i),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(const e in this.cache){var t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function v(t,e,i,s,a,r,n,o,l,h){var d,c,u,p,[g,m,f,v,b,_]=(0,P.getCurrentTransform)(t);0===m&&0===f?(d=Math.round(n*g+b),c=Math.round(o*v+_),u=Math.abs(Math.round((n+l)*g+b)-d)||1,p=Math.abs(Math.round((o+h)*v+_)-c)||1,t.setTransform(Math.sign(g),0,0,Math.sign(v),d,c),t.drawImage(e,i,s,a,r,0,0,u,p),t.setTransform(g,m,f,v,b,_)):0===g&&0===v?(d=Math.round(o*f+b),c=Math.round(n*m+_),u=Math.abs(Math.round((o+h)*f+b)-d)||1,p=Math.abs(Math.round((n+l)*m+_)-c)||1,t.setTransform(0,Math.sign(m),Math.sign(f),0,d,c),t.drawImage(e,i,s,a,r,0,0,p,u),t.setTransform(g,m,f,v,b,_)):(t.drawImage(e,i,s,a,r,n,o,l,h),Math.hypot(g,m),Math.hypot(f,v))}function f(t){const{width:i,height:e}=t;if(1e3<i||1e3<e)return null;var s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),a=i+1;let r=new Uint8Array(a*(e+1)),n,o,l;var h=i+7&-8;let d=new Uint8Array(h*e),c=0;for(const _ of t.data){let t=128;for(;0<t;)d[c++]=_&t?0:255,t>>=1}let u=0;for((c=0)!==d[c]&&(r[0]=1,++u),o=1;o<i;o++)d[c]!==d[c+1]&&(r[o]=d[c]?2:1,++u),c++;for(0!==d[c]&&(r[o]=2,++u),n=1;n<e;n++){c=n*h,l=n*a,d[c-h]!==d[c]&&(r[l]=d[c]?1:8,++u);let t=(d[c]?4:0)+(d[c-h]?8:0);for(o=1;o<i;o++)s[t=(t>>2)+(d[c+1]?4:0)+(d[c-h+1]?8:0)]&&(r[l+o]=s[t],++u),c++;if(d[c-h]!==d[c]&&(r[l+o]=d[c]?2:4,++u),1e3<u)return null}for(c=h*(e-1),l=n*a,0!==d[c]&&(r[l]=8,++u),o=1;o<i;o++)d[c]!==d[c+1]&&(r[l+o]=d[c]?4:8,++u),c++;if(0!==d[c]&&(r[l+o]=4,++u),1e3<u)return null;var p=new Int32Array([0,a,-1,0,-a,0,0,0,1]);const g=new Path2D;for(n=0;u&&n<=e;n++){let e=n*a;for(var m=e+i;e<m&&!r[e];)e++;if(e!==m){g.moveTo(e%a,n);var f=e;let t=r[e];do{for(var v=p[t];e+=v,!r[e];);var b=r[e];5!==b&&10!==b?(t=b,r[e]=0):(t=b&51*t>>4,r[e]&=t>>2|t<<2),g.lineTo(e%a,e/a|0),r[e]||--u}while(f!==e);--n}}d=null,r=null;return function(t){t.save(),t.scale(1/i,-1/e),t.translate(0,-e),t.fill(g),t.beginPath(),t.restore()}}class b{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=M.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=M.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=M.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){var t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,i){[e,i]=M.Util.applyTransform([e,i],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(t,e){var i=M.Util.applyTransform(e,t),s=M.Util.applyTransform(e.slice(2),t),a=M.Util.applyTransform([e[0],e[3]],t),e=M.Util.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,i[0],s[0],a[0],e[0]),this.minY=Math.min(this.minY,i[1],s[1],a[1],e[1]),this.maxX=Math.max(this.maxX,i[0],s[0],a[0],e[0]),this.maxY=Math.max(this.maxY,i[1],s[1],a[1],e[1])}updateScalingPathMinMax(t,e){M.Util.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.maxX=Math.max(this.maxX,e[1]),this.minY=Math.min(this.minY,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,i,s,a,r,n,o,l,h){e=M.Util.bezierBoundingBox(e,i,s,a,r,n,o,l);h?(h[0]=Math.min(h[0],e[0],e[2]),h[1]=Math.max(h[1],e[0],e[2]),h[2]=Math.min(h[2],e[1],e[3]),h[3]=Math.max(h[3],e[1],e[3])):this.updateRectMinMax(t,e)}getPathBoundingBox(t=R.FILL,e=null){var i=[this.minX,this.minY,this.maxX,this.maxY];return t===R.STROKE&&(e||(0,M.unreachable)("Stroke bounding box must include transform."),e=(t=M.Util.singularValueDecompose2dScale(e))[0]*this.lineWidth/2,t=t[1]*this.lineWidth/2,i[0]-=e,i[1]-=t,i[2]+=e,i[3]+=t),i}updateClipFromPath(){var t=M.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=R.FILL,e=null){return M.Util.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function _(n,o){if("undefined"!=typeof ImageData&&o instanceof ImageData)n.putImageData(o,0,0);else{var l=o.height,h=o.width,d=l%16,c=(l-d)/16,u=0==d?c:1+c,p=n.createImageData(h,16);let s=0,a;var g=o.data,m=p.data;let t,e,i,r;if(o.kind===M.ImageKind.GRAYSCALE_1BPP){var f=g.byteLength,v=new Uint32Array(m.buffer,0,m.byteLength>>2),b=v.length,_=h+7>>3,A=4294967295,y=M.FeatureTest.isLittleEndian?4278190080:255;for(t=0;t<u;t++){for(i=t<c?16:d,a=0,e=0;e<i;e++){var w=f-s;let t=0;var x=_<w?h:8*w-7,E=-8&x;let e=0,i=0;for(;t<E;t+=8)i=g[s++],v[a++]=128&i?A:y,v[a++]=64&i?A:y,v[a++]=32&i?A:y,v[a++]=16&i?A:y,v[a++]=8&i?A:y,v[a++]=4&i?A:y,v[a++]=2&i?A:y,v[a++]=1&i?A:y;for(;t<x;t++)0===e&&(i=g[s++],e=128),v[a++]=i&e?A:y,e>>=1}for(;a<b;)v[a++]=0;n.putImageData(p,0,16*t)}}else if(o.kind===M.ImageKind.RGBA_32BPP){for(e=0,r=16*h*4,t=0;t<c;t++)m.set(g.subarray(s,s+r)),s+=r,n.putImageData(p,0,e),e+=16;t<u&&(r=h*d*4,m.set(g.subarray(s,s+r)),n.putImageData(p,0,e))}else{if(o.kind!==M.ImageKind.RGB_24BPP)throw new Error("bad image kind: "+o.kind);for(i=16,r=h*i,t=0;t<u;t++){for(t>=c&&(i=d,r=h*i),a=0,e=r;e--;)m[a++]=g[s++],m[a++]=g[s++],m[a++]=g[s++],m[a++]=255;n.putImageData(p,0,16*t)}}}}function A(i,t){if(t.bitmap)i.drawImage(t.bitmap,0,0);else{var s=t.height,a=t.width,r=s%16,n=(s-r)/16,o=0==r?n:1+n,l=i.createImageData(a,16);let e=0;var h=t.data,d=l.data;for(let t=0;t<o;t++){var c=t<n?16:r;({srcPos:e}=u({src:h,srcPos:e,dest:d,width:a,height:c,nonBlackColor:0})),i.putImageData(l,0,16*t)}}}function y(t,e){for(const i of["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"])void 0!==t[i]&&(e[i]=t[i]);void 0!==t.setLineDash&&(e.setLineDash(t.getLineDash()),e.lineDashOffset=t.lineDashOffset)}function w(t){var e;t.strokeStyle=t.fillStyle="#000000",t.fillRule="nonzero",t.globalAlpha=1,t.lineWidth=1,t.lineCap="butt",t.lineJoin="miter",t.miterLimit=10,t.globalCompositeOperation="source-over",t.font="10px sans-serif",void 0!==t.setLineDash&&(t.setLineDash([]),t.lineDashOffset=0),M.isNodeJS||(e=t["filter"],"none"!==e&&""!==e&&(t.filter="none"))}function D(e,i,s){var a=e.length;for(let t=3;t<a;t+=4){var r=s?s[e[t]]:e[t];i[t]=i[t]*r*(1/255)|0}}function I(e,i,s){var a=e.length;for(let t=3;t<a;t+=4){var r=77*e[t-3]+152*e[t-2]+28*e[t-1];i[t]=s?i[t]*s[r>>8]>>8:i[t]*r>>16}}function x(t,e,i,s){var a=s[0],r=s[1],n=s[2]-a,s=s[3]-r;if(0!=n&&0!=s){var o=e.context,l=i,h=n,d=s,n=e.subtype,s=e.backdrop,c=e.transferMap,u=a,p=r,g=e.offsetX,m=e.offsetY,f=!!s,v=f?s[0]:0,b=f?s[1]:0,_=f?s[2]:0,A="Luminosity"===n?I:D,y=Math.min(d,Math.ceil(1048576/h));for(let t=0;t<d;t+=y){var w=Math.min(y,d-t),x=o.getImageData(u-g,t+(p-m),h,w),w=l.getImageData(u,t+p,h,w);if(f){M=P=k=T=S=C=E=void 0;var E=x.data,C=v,S=b,T=_,k=E.length;for(let t=3;t<k;t+=4){var M,P=E[t];0===P?(E[t-3]=C,E[t-2]=S,E[t-1]=T):P<255&&(M=255-P,E[t-3]=E[t-3]*P+C*M>>8,E[t-2]=E[t-2]*P+S*M>>8,E[t-1]=E[t-1]*P+T*M>>8)}}A(x.data,w.data,c),l.putImageData(w,u,t+p)}t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore()}}function E(t,e){var t=M.Util.singularValueDecompose2dScale(t),i=(t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]),Math.fround((globalThis.devicePixelRatio||1)*P.PixelsPerInch.PDF_TO_CSS_UNITS));return void 0!==e?e:t[0]<=i||t[1]<=i}const C=["butt","round","square"],S=["miter","round","bevel"],T={},k={};class F{constructor(t,e,i,s,a,{optionalContentConfig:r,markedContentStack:n=null},o,l){this.ctx=t,this.current=new b(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=s,this.filterFactory=a,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=n||[],this.optionalContentConfig=r,this.cachedCanvases=new m(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return"string"==typeof t?(t.startsWith("g_")?this.commonObjs:this.objs).get(t):e}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:s=null}){var a=this.ctx.canvas.width,r=this.ctx.canvas.height,n=this.ctx.fillStyle;this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,a,r),this.ctx.fillStyle=n,i&&(s=this.cachedCanvases.getCanvas("transparent",a,r),this.compositeCtx=this.ctx,this.transparentCanvas=s.canvas,this.ctx=s.context,this.ctx.save(),this.ctx.transform(...(0,P.getCurrentTransform)(this.compositeCtx))),this.ctx.save(),w(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=(0,P.getCurrentTransform)(this.ctx)}executeOperatorList(t,e,i,s){var a=t.argsArray,r=t.fnArray;let n=e||0;var o=a.length;if(o===n)return n;var l=10<o-n&&"function"==typeof i,h=l?Date.now()+15:0;let d=0;for(var c,u=this.commonObjs,p=this.objs;;){if(void 0!==s&&n===s.nextBreakPoint)return s.breakIt(n,i),n;if((c=r[n])!==M.OPS.dependency)this[c].apply(this,a[n]);else for(const m of a[n]){var g=m.startsWith("g_")?u:p;if(!g.has(m))return g.get(m,i),n}if(++n===o)return n;if(l&&10<++d){if(Date.now()>h)return i(),n;d=0}}}#restoreInitialState(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#restoreInitialState(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#drawFilter()}#drawFilter(){var t,e;this.pageColors&&"none"!==(t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background))&&(e=this.ctx.filter,this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e)}_scaleImage(i,t){var s,a,e=i.width,r=i.height;let n=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=e,h=r,d="prescale1";for(;2<n&&1<l||2<o&&1<h;){let t=l,e=h;2<n&&1<l&&(t=16384<=l?Math.floor(l/2)-1||1:Math.ceil(l/2),n/=l/t),2<o&&1<h&&(e=16384<=h?Math.floor(h/2)-1||1:Math.ceil(h)/2,o/=h/e),(a=(s=this.cachedCanvases.getCanvas(d,t,e)).context).clearRect(0,0,t,e),a.drawImage(i,0,0,l,h,0,0,t,e),i=s.canvas,l=t,h=e,d="prescale1"===d?"prescale2":"prescale1"}return{img:i,paintWidth:l,paintHeight:h}}_createMaskCanvas(t){var e=this.ctx,{width:i,height:s}=t,a=this.current.fillColor,r=this.current.patternFill,n=(0,P.getCurrentTransform)(e);let o,l,h,d;if((t.bitmap||t.data)&&1<t.count){var c=t.bitmap||t.data.buffer,c=(l=JSON.stringify(r?n:[n.slice(0,4),a]),(o=this._cachedBitmapsMap.get(c))||(o=new Map,this._cachedBitmapsMap.set(c,o)),o.get(l));if(c&&!r){const m=Math.round(Math.min(n[0],n[2])+n[4]),f=Math.round(Math.min(n[1],n[3])+n[5]);return{canvas:c,offsetX:m,offsetY:f}}h=c}h||A((d=this.cachedCanvases.getCanvas("maskCanvas",i,s)).context,t);var c=M.Util.transform(n,[1/i,0,0,-1/s,0,0]),c=M.Util.transform(c,[1,0,0,1,0,-s]),[n,u,p,g]=M.Util.getAxialAlignedBoundingBox([0,0,i,s],c),p=Math.round(p-n)||1,g=Math.round(g-u)||1,p=this.cachedCanvases.getCanvas("fillCanvas",p,g),g=p.context;const m=n,f=u;g.translate(-m,-f),g.transform(...c),h||(h=(h=this._scaleImage(d.canvas,(0,P.getCurrentTransformInverse)(g))).img,o&&r&&o.set(l,h)),g.imageSmoothingEnabled=E((0,P.getCurrentTransform)(g),t.interpolate),v(g,h,0,0,h.width,h.height,0,0,i,s),g.globalCompositeOperation="source-in";n=M.Util.transform((0,P.getCurrentTransformInverse)(g),[1,0,0,1,-m,-f]);return g.fillStyle=r?a.getPattern(e,this,n,R.FILL):a,g.fillRect(0,0,i,s),o&&!r&&(this.cachedCanvases.delete("fillCanvas"),o.set(l,p.canvas)),{canvas:p.canvas,offsetX:Math.round(m),offsetY:Math.round(f)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=C[t]}setLineJoin(t){this.ctx.lineJoin=S[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){var i=this.ctx;void 0!==i.setLineDash&&(i.setLineDash(t),i.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(var[e,i]of t)switch(e){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){var t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");var t=this.ctx.canvas.width,e=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(i,t,e),t=(this.suspendedCtx=this.ctx,this.ctx=i.context,this.ctx);t.setTransform(...(0,P.getCurrentTransform)(this.suspendedCtx)),y(this.suspendedCtx,t),c(t,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),y(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){var e;this.current.activeSMask&&(t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height],e=this.current.activeSMask,x(this.suspendedCtx,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore())}save(){(this.inSMaskMode?(y(this.ctx,this.suspendedCtx),this.suspendedCtx):this.ctx).save();var t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),y(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,i,s,a,r){this.ctx.transform(t,e,i,s,a,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(s,a,t){var r=this.ctx,n=this.current;let o=n.x,l=n.y,h,d;var c=(0,P.getCurrentTransform)(r),u=0===c[0]&&0===c[3]||0===c[1]&&0===c[2],p=u?t.slice(0):null;for(let t=0,e=0,i=s.length;t<i;t++)switch(0|s[t]){case M.OPS.rectangle:o=a[e++],l=a[e++];var g=a[e++],m=a[e++],f=o+g,v=l+m;r.moveTo(o,l),0===g||0===m?r.lineTo(f,v):(r.lineTo(f,l),r.lineTo(f,v),r.lineTo(o,v)),u||n.updateRectMinMax(c,[o,l,f,v]),r.closePath();break;case M.OPS.moveTo:o=a[e++],l=a[e++],r.moveTo(o,l),u||n.updatePathMinMax(c,o,l);break;case M.OPS.lineTo:o=a[e++],l=a[e++],r.lineTo(o,l),u||n.updatePathMinMax(c,o,l);break;case M.OPS.curveTo:h=o,d=l,o=a[e+4],l=a[e+5],r.bezierCurveTo(a[e],a[e+1],a[e+2],a[e+3],o,l),n.updateCurvePathMinMax(c,h,d,a[e],a[e+1],a[e+2],a[e+3],o,l,p),e+=6;break;case M.OPS.curveTo2:h=o,d=l,r.bezierCurveTo(o,l,a[e],a[e+1],a[e+2],a[e+3]),n.updateCurvePathMinMax(c,h,d,o,l,a[e],a[e+1],a[e+2],a[e+3],p),o=a[e+2],l=a[e+3],e+=4;break;case M.OPS.curveTo3:h=o,d=l,o=a[e+2],l=a[e+3],r.bezierCurveTo(a[e],a[e+1],o,l,o,l),n.updateCurvePathMinMax(c,h,d,a[e],a[e+1],o,l,o,l,p),e+=4;break;case M.OPS.closePath:r.closePath()}u&&n.updateScalingPathMinMax(c,p),n.setCurrentPoint(o,l)}closePath(){this.ctx.closePath()}stroke(t=!0){var e=this.ctx,i=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"==typeof i&&i?.getPattern?(e.save(),e.strokeStyle=i.getPattern(e,this,(0,P.getCurrentTransformInverse)(e),R.STROKE),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){var e=this.ctx,i=this.current.fillColor;let s=!1;this.current.patternFill&&(e.save(),e.fillStyle=i.getPattern(e,this,(0,P.getCurrentTransformInverse)(e),R.FILL),s=!0);i=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==i&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),s&&e.restore(),t&&this.consumePath(i)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=T}eoClip(){this.pendingClip=k}beginText(){this.current.textMatrix=M.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){var t=this.pendingTextPaths,e=this.ctx;if(void 0===t)e.beginPath();else{e.save(),e.beginPath();for(const i of t)e.setTransform(...i.transform),e.translate(i.x,i.y),i.addToPath(e,i.fontSize);e.restore(),e.clip(),e.beginPath(),delete this.pendingTextPaths}}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(i,s){var a=this.commonObjs.get(i),r=this.current;if(!a)throw new Error("Can't find font for "+i);if(r.fontMatrix=a.fontMatrix||M.FONT_IDENTITY_MATRIX,0!==r.fontMatrix[0]&&0!==r.fontMatrix[3]||(0,M.warn)("Invalid font matrix for font "+i),s<0?(s=-s,r.fontDirection=-1):r.fontDirection=1,this.current.font=a,this.current.fontSize=s,!a.isType3Font){i=a.loadedName||"sans-serif",r=a.systemFontInfo?.css||`"${i}", `+a.fallbackName;let t="normal";a.black?t="900":a.bold&&(t="bold");i=a.italic?"italic":"normal";let e=s;s<16?e=16:100<s&&(e=100),this.current.fontSizeScale=s/e,this.ctx.font=i+` ${t} ${e}px `+r}}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,i,s,a,r){this.current.textMatrix=[t,e,i,s,a,r],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,i,s){var a=this.ctx,r=this.current,n=r.font,o=r.textRenderingMode,l=r.fontSize/r.fontSizeScale,h=o&M.TextRenderingMode.FILL_STROKE_MASK,o=!!(o&M.TextRenderingMode.ADD_TO_PATH_FLAG),r=r.patternFill&&!n.missingFile;let d;(n.disableFontFace||o||r)&&(d=n.getPathGenerator(this.commonObjs,t)),n.disableFontFace||r?(a.save(),a.translate(e,i),a.beginPath(),d(a,l),s&&a.setTransform(...s),h!==M.TextRenderingMode.FILL&&h!==M.TextRenderingMode.FILL_STROKE||a.fill(),h!==M.TextRenderingMode.STROKE&&h!==M.TextRenderingMode.FILL_STROKE||a.stroke(),a.restore()):(h!==M.TextRenderingMode.FILL&&h!==M.TextRenderingMode.FILL_STROKE||a.fillText(t,e,i),h!==M.TextRenderingMode.STROKE&&h!==M.TextRenderingMode.FILL_STROKE||a.strokeText(t,e,i)),o&&(this.pendingTextPaths||=[]).push({transform:(0,P.getCurrentTransform)(a),x:e,y:i,fontSize:l,addToPath:d})}get isFontSubpixelAAEnabled(){var t=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10)["context"],e=(t.scale(1.5,1),t.fillText("I",0,10),t.getImageData(0,0,10,10).data);let i=!1;for(let t=3;t<e.length;t+=4)if(0<e[t]&&e[t]<255){i=!0;break}return(0,M.shadow)(this,"isFontSubpixelAAEnabled",i)}showText(e){var i=this.current,n=i.font;if(n.isType3Font)return this.showType3Text(e);var o=i.fontSize;if(0!==o){var l=this.ctx,h=i.fontSizeScale,d=i.charSpacing,c=i.wordSpacing,u=i.fontDirection,s=i.textHScale*u,p=e.length,g=n.vertical,m=g?1:-1,f=n.defaultVMetrics,v=o*i.fontMatrix[0],b=i.textRenderingMode===M.TextRenderingMode.FILL&&!n.disableFontFace&&!i.patternFill;l.save(),l.transform(...i.textMatrix),l.translate(i.x,i.y+i.textRise),0<u?l.scale(s,-1):l.scale(s,1);let r,t=(i.patternFill&&(l.save(),_=i.fillColor.getPattern(l,this,(0,P.getCurrentTransformInverse)(l),R.FILL),r=(0,P.getCurrentTransform)(l),l.restore(),l.fillStyle=_),i.lineWidth);var a,_=i.textMatrixScale;if(0===_||0===t?(a=i.textRenderingMode&M.TextRenderingMode.FILL_STROKE_MASK)!==M.TextRenderingMode.STROKE&&a!==M.TextRenderingMode.FILL_STROKE||(t=this.getSinglePixelWidth()):t/=_,1!==h&&(l.scale(h,h),t/=h),l.lineWidth=t,n.isInvalidPDFjsFont){var A=[];let t=0;for(const k of e)A.push(k.unicode),t+=k.width;l.fillText(A.join(""),0,0),i.x+=t*v*s,l.restore(),void this.compose()}else{let a=0,t;for(t=0;t<p;++t){var y=e[t];if("number"==typeof y)a+=m*y*o/1e3;else{let t=!1;var w,x,E,C=(y.isSpace?c:0)+d,S=y.fontChar,T=y.accent;let e,i,s=y.width;i=g?(w=y.vmetric||f,x=-(y.vmetric?w[1]:.5*s)*v,E=w[2]*v,s=w?-w[0]:s,e=x/h,(a+E)/h):(e=a/h,0),n.remeasure&&0<s&&(w=1e3*l.measureText(S).width/o*h,s<w&&this.isFontSubpixelAAEnabled?(x=s/w,t=!0,l.save(),l.scale(x,1),e/=x):s!==w&&(e+=(s-w)/2e3*o/h)),this.contentVisible&&(y.isInFont||n.missingFile)&&(b&&!T?l.fillText(S,e,i):(this.paintChar(S,e,i,r),T&&(E=e+o*T.offset.x/h,y=i-o*T.offset.y/h,this.paintChar(T.fontChar,E,y,r))));S=g?s*v-C*u:s*v+C*u;a+=S,t&&l.restore()}}g?i.y-=a:i.x+=a*s,l.restore(),this.compose()}}}showType3Text(t){var e,i,s=this.ctx,a=this.current,r=a.font,n=a.fontSize,o=a.fontDirection,l=r.vertical?1:-1,h=a.charSpacing,d=a.wordSpacing,c=a.textHScale*o,u=a.fontMatrix||M.FONT_IDENTITY_MATRIX,p=t.length,g=a.textRenderingMode===M.TextRenderingMode.INVISIBLE;let m,f,v,b;if(!g&&0!==n){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),s.transform(...a.textMatrix),s.translate(a.x,a.y),s.scale(c,o),m=0;m<p;++m)"number"==typeof(f=t[m])?(this.ctx.translate(b=l*f*n/1e3,0),a.x+=b*c):(e=(f.isSpace?d:0)+h,(i=r.charProcOperatorList[f.operatorListId])?(this.contentVisible&&(this.processingType3=f,this.save(),s.scale(n,n),s.transform(...u),this.executeOperatorList(i),this.restore()),v=M.Util.applyTransform([f.width,0],u)[0]*n+e,s.translate(v,0),a.x+=v*c):(0,M.warn)(`Type3 character "${f.operatorListId}" is not available.`));s.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,i,s,a,r){this.ctx.rect(i,s,a-i,r-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;var i,s,a;return e="TilingPattern"===t[0]?(i=t[1],s=this.baseTransform||(0,P.getCurrentTransform)(this.ctx),a={createCanvasGraphics:t=>new F(t,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})},new h(t,i,this.ctx,a,s)):this._getPattern(t[1],t[2])}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,i){t=M.Util.makeHexColor(t,e,i);this.ctx.strokeStyle=t,this.current.strokeColor=t}setFillRGBColor(t,e,i){t=M.Util.makeHexColor(t,e,i);this.ctx.fillStyle=t,this.current.fillColor=t,this.current.patternFill=!1}_getPattern(t,e=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=n(this.getObject(t)),this.cachedPatterns.set(t,i)),e&&(i.matrix=e),i}shadingFill(t){var e,i,s;this.contentVisible&&(e=this.ctx,this.save(),t=this._getPattern(t),e.fillStyle=t.getPattern(e,this,(0,P.getCurrentTransformInverse)(e),R.SHADING),(t=(0,P.getCurrentTransformInverse)(e))?({width:e,height:i}=e.canvas,[e,i,t,s]=M.Util.getAxialAlignedBoundingBox([0,0,e,i],t),this.ctx.fillRect(e,i,t-e,s-i)):this.ctx.fillRect(-1e10,-1e10,2e10,2e10),this.compose(this.current.getClippedPathBoundingBox()),this.restore())}beginInlineImage(){(0,M.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,M.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(t,e){var i;this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(t)&&6===t.length&&this.transform(...t),this.baseTransform=(0,P.getCurrentTransform)(this.ctx),e)&&(t=e[2]-e[0],i=e[3]-e[1],this.ctx.rect(e[0],e[1],t,i),this.current.updateRectMinMax((0,P.getCurrentTransform)(this.ctx),e),this.clip(),this.endPath())}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(r){if(this.contentVisible){this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);var n=this.ctx,o=(r.isolated||(0,M.info)("TODO: Support non-isolated groups."),r.knockout&&(0,M.warn)("Knockout groups not supported."),(0,P.getCurrentTransform)(n));if(r.matrix&&n.transform(...r.matrix),!r.bbox)throw new Error("Bounding box is required.");var l=M.Util.getAxialAlignedBoundingBox(r.bbox,(0,P.getCurrentTransform)(n)),h=[0,0,n.canvas.width,n.canvas.height],l=M.Util.intersect(l,h)||[0,0,0,0],h=Math.floor(l[0]),d=Math.floor(l[1]);let t=Math.max(Math.ceil(l[2])-h,1),e=Math.max(Math.ceil(l[3])-d,1),i=1,s=1,a=(t>g&&(i=t/g,t=g),e>g&&(s=e/g,e=g),this.current.startNewPathAndClipBox([0,0,t,e]),"groupAt"+this.groupLevel);r.smask&&(a+="_smask_"+this.smaskCounter++%2);var l=this.cachedCanvases.getCanvas(a,t,e),c=l.context;c.scale(1/i,1/s),c.translate(-h,-d),c.transform(...o),r.smask?this.smaskStack.push({canvas:l.canvas,context:c,offsetX:h,offsetY:d,scaleX:i,scaleY:s,subtype:r.smask.subtype,backdrop:r.smask.backdrop,transferMap:r.smask.transferMap||null,startTransformInverse:null}):(n.setTransform(1,0,0,1,0,0),n.translate(h,d),n.scale(i,s),n.save()),y(n,c),this.ctx=c,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}}endGroup(t){var e,i;this.contentVisible&&(this.groupLevel--,e=this.ctx,i=this.groupStack.pop(),this.ctx=i,this.ctx.imageSmoothingEnabled=!1,t.smask?(this.tempSMask=this.smaskStack.pop(),this.restore()):(this.ctx.restore(),i=(0,P.getCurrentTransform)(this.ctx),this.restore(),this.ctx.save(),this.ctx.setTransform(...i),t=M.Util.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],i),this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(t)))}beginAnnotation(t,e,i,s,a){var r,n,o,l,h;this.#restoreInitialState(),w(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(e)&&4===e.length&&(r=e[2]-e[0],n=e[3]-e[1],a&&this.annotationCanvasMap?((i=i.slice())[4]-=e[0],i[5]-=e[1],(e=e.slice())[0]=e[1]=0,e[2]=r,e[3]=n,[a,o]=M.Util.singularValueDecompose2dScale((0,P.getCurrentTransform)(this.ctx)),h=this["viewportScale"],l=Math.ceil(r*this.outputScaleX*h),h=Math.ceil(n*this.outputScaleY*h),{canvas:l,context:h}=(this.annotationCanvas=this.canvasFactory.create(l,h),this.annotationCanvas),this.annotationCanvasMap.set(t,l),this.annotationCanvas.savedCtx=this.ctx,this.ctx=h,this.ctx.save(),this.ctx.setTransform(a,0,0,-o,0,n*o),w(this.ctx)):(w(this.ctx),this.ctx.rect(e[0],e[1],r,n),this.ctx.clip(),this.endPath())),this.current=new b(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#drawFilter(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){var e,i;this.contentVisible&&(e=t.count,(t=this.getObject(t.data,t)).count=e,e=this.ctx,(i=this.processingType3)&&(void 0===i.compiled&&(i.compiled=f(t)),i.compiled)?i.compiled(e):(t=(i=this._createMaskCanvas(t)).canvas,e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(t,i.offsetX,i.offsetY),e.restore(),this.compose()))}paintImageMaskXObjectRepeat(t,i,s=0,a=0,r,n){if(this.contentVisible){t=this.getObject(t.data,t);var o=this.ctx,l=(o.save(),(0,P.getCurrentTransform)(o)),h=(o.transform(i,s,a,r,0,0),this._createMaskCanvas(t));o.setTransform(1,0,0,1,h.offsetX-l[4],h.offsetY-l[5]);for(let t=0,e=n.length;t<e;t+=2){var d=M.Util.transform(l,[i,s,a,r,n[t],n[t+1]]),[d,c]=M.Util.applyTransform([0,0],d);o.drawImage(h.canvas,d,c)}o.restore(),this.compose()}}paintImageMaskXObjectGroup(t){if(this.contentVisible){var e=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(const d of t){var{data:a,width:r,height:n,transform:o}=d,l=this.cachedCanvases.getCanvas("maskCanvas",r,n),h=l.context,a=(h.save(),this.getObject(a,d));A(h,a),h.globalCompositeOperation="source-in",h.fillStyle=s?i.getPattern(h,this,(0,P.getCurrentTransformInverse)(e),R.FILL):i,h.fillRect(0,0,r,n),h.restore(),e.save(),e.transform(...o),e.scale(1,-1),v(e,l.canvas,0,0,r,n,0,-1,1,1),e.restore()}this.compose()}}paintImageXObject(t){this.contentVisible&&((t=this.getObject(t))?this.paintInlineImageXObject(t):(0,M.warn)("Dependent image isn't ready yet"))}paintImageXObjectRepeat(t,i,s,a){if(this.contentVisible){t=this.getObject(t);if(t){var r=t.width,n=t.height,o=[];for(let t=0,e=a.length;t<e;t+=2)o.push({transform:[i,0,0,s,a[t],a[t+1]],x:0,y:0,w:r,h:n});this.paintInlineImageXObjectGroup(t,o)}else(0,M.warn)("Dependent image isn't ready yet")}}applyTransferMapsToCanvas(t){return"none"!==this.current.transferMaps&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){var e,i;return"none"===this.current.transferMaps?t.bitmap:({bitmap:t,width:e,height:i}=t,(i=(e=this.cachedCanvases.getCanvas("inlineImage",e,i)).context).filter=this.current.transferMaps,i.drawImage(t,0,0),i.filter="none",e.canvas)}paintInlineImageXObject(e){if(this.contentVisible){var i=e.width,s=e.height,a=this.ctx;this.save(),M.isNodeJS||(r=a["filter"],"none"!==r&&""!==r&&(a.filter="none")),a.scale(1/i,-1/s);let t;t=e.bitmap?this.applyTransferMapsToBitmap(e):"function"==typeof HTMLElement&&e instanceof HTMLElement||!e.data?e:(_(r=this.cachedCanvases.getCanvas("inlineImage",i,s).context,e),this.applyTransferMapsToCanvas(r));var r=this._scaleImage(t,(0,P.getCurrentTransformInverse)(a));a.imageSmoothingEnabled=E((0,P.getCurrentTransform)(a),e.interpolate),v(a,r.img,0,0,r.paintWidth,r.paintHeight,0,-s,i,s),this.compose(),this.restore()}}paintInlineImageXObjectGroup(e,i){if(this.contentVisible){var s,a,r=this.ctx;let t;t=e.bitmap||(a=e.width,s=e.height,_(a=this.cachedCanvases.getCanvas("inlineImage",a,s).context,e),this.applyTransferMapsToCanvas(a));for(const n of i)r.save(),r.transform(...n.transform),r.scale(1,-1),v(r,t,n.x,n.y,n.w,n.h,0,-1,1,1),r.restore();this.compose()}}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){"OC"===t?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){var e=this.current.isEmptyClip(),t=(this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t),this.ctx);this.pendingClip&&(e||(this.pendingClip===k?t.clip("evenodd"):t.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),t.beginPath()}getSinglePixelWidth(){var t,e,i;return this._cachedGetSinglePixelWidth||(0===(i=(0,P.getCurrentTransform)(this.ctx))[1]&&0===i[2]?this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(i[0]),Math.abs(i[3])):(t=Math.abs(i[0]*i[3]-i[2]*i[1]),e=Math.hypot(i[0],i[2]),i=Math.hypot(i[1],i[3]),this._cachedGetSinglePixelWidth=Math.max(e,i)/t)),this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){var i,s,a,r=this.current["lineWidth"],{a:n,b:o,c:l,d:h}=this.ctx.getTransform();let t,e;0===o&&0===l?(a=Math.abs(n))===(i=Math.abs(h))?t=e=0===r?1/a:(s=a*r)<1?1/s:1:e=0===r?(t=1/a,1/i):(s=a*r,a=i*r,t=s<1?1/s:1,a<1?1/a:1):(i=Math.abs(n*h-o*l),s=Math.hypot(n,o),a=Math.hypot(l,h),e=0===r?(t=a/i,s/i):(n=r*i,t=n<a?a/n:1,n<s?s/n:1)),this._cachedScaleForStroking[0]=t,this._cachedScaleForStroking[1]=e}return this._cachedScaleForStroking}rescaleAndStroke(t){var e=this["ctx"],i=this.current["lineWidth"],[s,a]=this.getScaleForStroking();if(e.lineWidth=i||1,1===s&&1===a)e.stroke();else{i=e.getLineDash();if(t&&e.save(),e.scale(s,a),0<i.length){const r=Math.max(s,a);e.setLineDash(i.map(t=>t/r)),e.lineDashOffset/=r}e.stroke(),t&&e.restore()}}isContentVisible(){for(let t=this.markedContentStack.length-1;0<=t;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const L in M.OPS)void 0!==F.prototype[L]&&(F.prototype[M.OPS[L]]=F.prototype[L])},473:(t,e,i)=>{i.d(e,{DOMCMapReaderFactory:()=>h,DOMCanvasFactory:()=>n,DOMFilterFactory:()=>a,DOMSVGFactory:()=>c,DOMStandardFontDataFactory:()=>d,PDFDateString:()=>b,PageViewport:()=>u,PixelsPerInch:()=>s,RenderingCancelledException:()=>p,StatTimer:()=>m,fetchData:()=>o,getColorValues:()=>function(t){var e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const s of t.keys()){e.style.color=s;var i=window.getComputedStyle(e).color;t.set(s,_(i))}e.remove()},getCurrentTransform:()=>function(t){var{a:t,b:e,c:i,d:s,e:a,f:r}=t.getTransform();return[t,e,i,s,a,r]},getCurrentTransformInverse:()=>function(t){var{a:t,b:e,c:i,d:s,e:a,f:r}=t.getTransform().invertSelf();return[t,e,i,s,a,r]},getFilenameFromUrl:()=>function(t,e=!1){e||([t]=t.split(/[#?]/,1));return t.substring(t.lastIndexOf("/")+1)},getPdfFilenameFromUrl:()=>function(t,e="document.pdf"){if("string"!=typeof t)return e;if(g(t))return(0,l.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;var i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(t);let s=i.exec(t[1])||i.exec(t[2])||i.exec(t[3]);if(s&&(s=s[0]).includes("%"))try{s=i.exec(decodeURIComponent(s))[0]}catch{}return s||e},getRGB:()=>_,getXfaPageViewport:()=>function(t,{scale:e=1,rotation:i=0}){var{width:t,height:s}=t.attributes.style,t=[0,0,parseInt(t),parseInt(s)];return new u({viewBox:t,scale:e,rotation:i})},isDataScheme:()=>g,isPdfFile:()=>function(t){return"string"==typeof t&&/\.pdf$/i.test(t)},isValidFetchUrl:()=>f,noContextMenu:()=>function(t){t.preventDefault()},setLayerDimensions:()=>function(t,e,i=!1,s=!0){{var a,r,n,o;e instanceof u&&({pageWidth:n,pageHeight:r}=e.rawDims,a=t["style"],o=l.FeatureTest.isCSSRoundSupported,n=`var(--scale-factor) * ${n}px`,r=`var(--scale-factor) * ${r}px`,n=o?`round(${n}, 1px)`:`calc(${n})`,o=o?`round(${r}, 1px)`:`calc(${r})`,i&&e.rotation%180!=0?(a.width=o,a.height=n):(a.width=n,a.height=o))}s&&t.setAttribute("data-main-rotation",e.rotation)}});var e=i(822),l=i(266);const r="http://www.w3.org/2000/svg";class s{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}class a extends e.BaseFilterFactory{#_cache;#_defs;#docId;#document;#hcmFilter;#hcmKey;#hcmUrl;#hcmHighlightFilter;#hcmHighlightKey;#hcmHighlightUrl;#id=0;constructor({docId:t,ownerDocument:e=globalThis.document}={}){super(),this.#docId=t,this.#document=e}get#cache(){return this.#_cache||=new Map}get#defs(){var t,e;return this.#_defs||(e=(t=this.#document.createElement("div"))["style"],e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1,(e=this.#document.createElementNS(r,"svg")).setAttribute("width",0),e.setAttribute("height",0),this.#_defs=this.#document.createElementNS(r,"defs"),t.append(e),e.append(this.#_defs),this.#document.body.append(t)),this.#_defs}addFilter(t){if(!t)return"none";var e=this.#cache.get(t);if(e)return e;let i,s,a,r;if(1===t.length){var n=t[0],o=new Array(256);for(let t=0;t<256;t++)o[t]=n[t]/255;r=i=s=a=o.join(",")}else{var[l,h,d]=t,c=new Array(256),u=new Array(256),p=new Array(256);for(let t=0;t<256;t++)c[t]=l[t]/255,u[t]=h[t]/255,p[t]=d[t]/255;i=c.join(","),s=u.join(","),a=p.join(","),r=""+i+s+a}return(e=this.#cache.get(r))?(this.#cache.set(t,e),e):(e=`g_${this.#docId}_transfer_map_`+this.#id++,this.#cache.set(t,t=`url(#${e})`),this.#cache.set(r,t),e=this.#createFilter(e),this.#addTransferMapConversion(i,s,a,e),t)}addHCMFilter(t,e){var i=t+"-"+e;if(this.#hcmKey!==i&&(this.#hcmKey=i,this.#hcmUrl="none",this.#hcmFilter?.remove(),t)&&e){const r=this.#getRGB(t),n=(t=l.Util.makeHexColor(...r),this.#getRGB(e));if(e=l.Util.makeHexColor(...n),this.#defs.style.color="",("#000000"!==t||"#ffffff"!==e)&&t!==e){var s=new Array(256);for(let t=0;t<=255;t++){var a=t/255;s[t]=a<=.03928?a/12.92:((.055+a)/1.055)**2.4}i=s.join(","),t=`g_${this.#docId}_hcm_filter`,e=this.#hcmHighlightFilter=this.#createFilter(t),i=(this.#addTransferMapConversion(i,i,i,e),this.#addGrayConversion(e),(t,e)=>{var i=r[t]/255,s=n[t]/255,a=new Array(e+1);for(let t=0;t<=e;t++)a[t]=i+t/e*(s-i);return a.join(",")});this.#addTransferMapConversion(i(0,5),i(1,5),i(2,5),e),this.#hcmUrl=`url(#${t})`}}return this.#hcmUrl}addHighlightHCMFilter(i,s,a,r){var n=i+`-${s}-${a}-`+r;if(this.#hcmHighlightKey!==n&&(this.#hcmHighlightKey=n,this.#hcmHighlightUrl="none",this.#hcmHighlightFilter?.remove(),i)&&s){var[n,i]=[i,s].map(this.#getRGB.bind(this));let d=Math.round(.2126*n[0]+.7152*n[1]+.0722*n[2]),c=Math.round(.2126*i[0]+.7152*i[1]+.0722*i[2]),[t,e]=[a,r].map(this.#getRGB.bind(this));c<d&&([d,c,t,e]=[c,d,e,t]),this.#defs.style.color="";s=(t,e,i)=>{var s=new Array(256),a=(c-d)/i,r=t/255,n=(e-t)/(255*i);let o=0;for(let t=0;t<=i;t++){var l=Math.round(d+t*a),h=r+t*n;for(let t=o;t<=l;t++)s[t]=h;o=l+1}for(let t=o;t<256;t++)s[t]=s[o-1];return s.join(",")},n=`g_${this.#docId}_hcm_highlight_filter`,i=this.#hcmHighlightFilter=this.#createFilter(n);this.#addGrayConversion(i),this.#addTransferMapConversion(s(t[0],e[0],5),s(t[1],e[1],5),s(t[2],e[2],5),i),this.#hcmHighlightUrl=`url(#${n})`}return this.#hcmHighlightUrl}destroy(t=!1){t&&(this.#hcmUrl||this.#hcmHighlightUrl)||(this.#_defs&&(this.#_defs.parentNode.parentNode.remove(),this.#_defs=null),this.#_cache&&(this.#_cache.clear(),this.#_cache=null),this.#id=0)}#addGrayConversion(t){var e=this.#document.createElementNS(r,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#createFilter(t){var e=this.#document.createElementNS(r,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#defs.append(e),e}#appendFeFunc(t,e,i){e=this.#document.createElementNS(r,e);e.setAttribute("type","discrete"),e.setAttribute("tableValues",i),t.append(e)}#addTransferMapConversion(t,e,i,s){var a=this.#document.createElementNS(r,"feComponentTransfer");s.append(a),this.#appendFeFunc(a,"feFuncR",t),this.#appendFeFunc(a,"feFuncG",e),this.#appendFeFunc(a,"feFuncB",i)}#getRGB(t){return this.#defs.style.color=t,_(getComputedStyle(this.#defs).getPropertyValue("color"))}}class n extends e.BaseCanvasFactory{constructor({ownerDocument:t=globalThis.document}={}){super(),this._document=t}_createCanvas(t,e){var i=this._document.createElement("canvas");return i.width=t,i.height=e,i}}async function o(s,a="text"){if(f(s,document.baseURI)){var t=await fetch(s);if(!t.ok)throw new Error(t.statusText);switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((e,t)=>{const i=new XMLHttpRequest;i.open("GET",s,!0),i.responseType=a,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(200===i.status||0===i.status){let t;switch(a){case"arraybuffer":case"blob":case"json":t=i.response;break;default:t=i.responseText}if(t)return void e(t)}t(new Error(i.statusText))}},i.send(null)})}class h extends e.BaseCMapReaderFactory{_fetchData(t,e){return o(t,this.isCompressed?"arraybuffer":"text").then(t=>({cMapData:t instanceof ArrayBuffer?new Uint8Array(t):(0,l.stringToBytes)(t),compressionType:e}))}}class d extends e.BaseStandardFontDataFactory{_fetchData(t){return o(t,"arraybuffer").then(t=>new Uint8Array(t))}}class c extends e.BaseSVGFactory{_createSVG(t){return document.createElementNS(r,t)}}class u{constructor({viewBox:t,scale:e,rotation:i,offsetX:s=0,offsetY:a=0,dontFlip:r=!1}){this.viewBox=t,this.scale=e,this.rotation=i,this.offsetX=s,this.offsetY=a;var n=(t[2]+t[0])/2,o=(t[3]+t[1])/2;let l,h,d,c;switch((i%=360)<0&&(i+=360),i){case 180:l=-1,h=0,d=0,c=1;break;case 90:l=0,h=1,d=1,c=0;break;case 270:l=0,h=-1,d=-1,c=0;break;case 0:l=1,h=0,d=0,c=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}r&&(d=-d,c=-c);let u,p,g,m;m=0===l?(u=Math.abs(o-t[1])*e+s,p=Math.abs(n-t[0])*e+a,g=(t[3]-t[1])*e,(t[2]-t[0])*e):(u=Math.abs(n-t[0])*e+s,p=Math.abs(o-t[1])*e+a,g=(t[2]-t[0])*e,(t[3]-t[1])*e),this.transform=[l*e,h*e,d*e,c*e,u-l*e*n-d*e*o,p-h*e*n-c*e*o],this.width=g,this.height=m}get rawDims(){var t=this["viewBox"];return(0,l.shadow)(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:a=!1}={}){return new u({viewBox:this.viewBox.slice(),scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:a})}convertToViewportPoint(t,e){return l.Util.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){var e=l.Util.applyTransform([t[0],t[1]],this.transform),t=l.Util.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],t[0],t[1]]}convertToPdfPoint(t,e){return l.Util.applyInverseTransform([t,e],this.transform)}}class p extends l.BaseException{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function g(t){var e=t.length;let i=0;for(;i<e&&""===t[i].trim();)i++;return"data:"===t.substring(i,i+5).toLowerCase()}class m{started=Object.create(null);times=[];time(t){t in this.started&&(0,l.warn)("Timer is already running for "+t),this.started[t]=Date.now()}timeEnd(t){t in this.started||(0,l.warn)("Timer has not been started for "+t),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){var t,e,i,s,a=[];let r=0;for({name:t}of this.times)r=Math.max(t.length,r);for({name:e,start:i,end:s}of this.times)a.push(`${e.padEnd(r)} ${s-i}ms\n`);return a.join("")}}function f(t,e){try{var i=(e?new URL(t,e):new URL(t))["protocol"];return"http:"===i||"https:"===i}catch{return!1}}let v;class b{static toDateObject(t){if(!t||"string"!=typeof t)return null;t=(v||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?")).exec(t);if(!t)return null;var e=parseInt(t[1],10),i=1<=(i=parseInt(t[2],10))&&i<=12?i-1:0,s=1<=(s=parseInt(t[3],10))&&s<=31?s:1;let a=parseInt(t[4],10),r=(a=0<=a&&a<=23?a:0,parseInt(t[5],10));r=0<=r&&r<=59?r:0;var n=0<=(n=parseInt(t[6],10))&&n<=59?n:0,o=t[7]||"Z",l=0<=(l=parseInt(t[8],10))&&l<=23?l:0,t=0<=(t=parseInt(t[9],10)||0)&&t<=59?t:0;return"-"===o?(a+=l,r+=t):"+"===o&&(a-=l,r-=t),new Date(Date.UTC(e,i,s,a,r,n))}}function _(t){var e;return t.startsWith("#")?[(16711680&(e=parseInt(t.slice(1),16)))>>16,(65280&e)>>8,255&e]:t.startsWith("rgb(")?t.slice(4,-1).split(",").map(t=>parseInt(t)):t.startsWith("rgba(")?t.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):((0,l.warn)(`Not a valid color format: "${t}"`),[0,0,0])}},423:(t,e,i)=>{i.d(e,{DrawLayer:()=>l});var s=i(473),a=i(266);class l{#parent=null;#id=0;#mapping=new Map;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(this.#parent){if(this.#parent!==t){if(0<this.#mapping.size)for(const e of this.#mapping.values())e.remove(),t.append(e);this.#parent=t}}else this.#parent=t}static get _svgFactory(){return(0,a.shadow)(this,"_svgFactory",new s.DOMSVGFactory)}static#setBox(t,{x:e,y:i,width:s,height:a}){t=t.style;t.top=100*i+"%",t.left=100*e+"%",t.width=100*s+"%",t.height=100*a+"%"}#createSVG(t){var e=l._svgFactory.create(1,1,!0);return this.#parent.append(e),l.#setBox(e,t),e}highlight({outlines:t,box:e},i,s){var a=this.#id++,e=this.#createSVG(e),r=(e.classList.add("highlight"),l._svgFactory.createElement("defs")),n=(e.append(r),l._svgFactory.createElement("path")),o=(r.append(n),`path_p${this.pageIndex}_`+a),n=(n.setAttribute("id",o),n.setAttribute("d",l.#extractPathFromHighlightOutlines(t)),l._svgFactory.createElement("clipPath")),t=(r.append(n),"clip_"+o),r=(n.setAttribute("id",t),n.setAttribute("clipPathUnits","objectBoundingBox"),l._svgFactory.createElement("use")),n=(n.append(r),r.setAttribute("href","#"+o),r.classList.add("clip"),l._svgFactory.createElement("use"));return e.append(n),e.setAttribute("fill",i),e.setAttribute("fill-opacity",s),n.setAttribute("href","#"+o),this.#mapping.set(a,e),{id:a,clipPathId:`url(#${t})`}}highlightOutline({outlines:t,box:e}){var i=this.#id++,e=this.#createSVG(e),s=(e.classList.add("highlightOutline"),l._svgFactory.createElement("defs")),a=(e.append(s),l._svgFactory.createElement("path")),s=(s.append(a),`path_p${this.pageIndex}_`+i),t=(a.setAttribute("id",s),a.setAttribute("d",l.#extractPathFromHighlightOutlines(t)),a.setAttribute("vector-effect","non-scaling-stroke"),l._svgFactory.createElement("use")),a=(e.append(t),t.setAttribute("href","#"+s),t.cloneNode());return e.append(a),t.classList.add("mainOutline"),a.classList.add("secondaryOutline"),this.#mapping.set(i,e),i}static#extractPathFromHighlightOutlines(t){var s=[];for(const n of t){let[e,i]=n;s.push(`M${e} `+i);for(let t=2;t<n.length;t+=2){var a=n[t],r=n[t+1];a===e?(s.push("V"+r),i=r):r===i&&(s.push("H"+a),e=a)}s.push("Z")}return s.join(" ")}updateBox(t,e){l.#setBox(this.#mapping.get(t),e)}rotate(t,e){this.#mapping.get(t).setAttribute("data-main-rotation",e)}changeColor(t,e){this.#mapping.get(t).setAttribute("fill",e)}changeOpacity(t,e){this.#mapping.get(t).setAttribute("fill-opacity",e)}addClass(t,e){this.#mapping.get(t).classList.add(e)}removeClass(t,e){this.#mapping.get(t).classList.remove(e)}remove(t){null!==this.#parent&&(this.#mapping.get(t).remove(),this.#mapping.delete(t))}destroy(){this.#parent=null;for(const t of this.#mapping.values())t.remove();this.#mapping.clear()}}},629:(t,e,i)=>{i.d(e,{AnnotationEditorLayer:()=>c});var b=i(266),_=i(115),p=i(812),A=i(640);class a extends _.AnnotationEditor{#boundEditorDivBlur=this.editorDivBlur.bind(this);#boundEditorDivFocus=this.editorDivFocus.bind(this);#boundEditorDivInput=this.editorDivInput.bind(this);#boundEditorDivKeydown=this.editorDivKeydown.bind(this);#color;#content="";#editorDivId=this.id+"-editor";#fontSize;#initialData=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){var t=a.prototype,e=t=>t.isEmpty(),i=p.AnnotationEditorUIManager.TRANSLATE_SMALL,s=p.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,b.shadow)(this,"_keyboardManager",new p.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}]]))}static _type="freetext";static _editorType=b.AnnotationEditorType.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#color=t.color||a._defaultColor||_.AnnotationEditor._defaultLineColor,this.#fontSize=t.fontSize||a._defaultFontSize}static initialize(t){_.AnnotationEditor.initialize(t,{strings:["pdfjs-free-text-default-content"]});t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case b.AnnotationEditorParamsType.FREETEXT_SIZE:a._defaultFontSize=e;break;case b.AnnotationEditorParamsType.FREETEXT_COLOR:a._defaultColor=e}}updateParams(t,e){switch(t){case b.AnnotationEditorParamsType.FREETEXT_SIZE:this.#updateFontSize(e);break;case b.AnnotationEditorParamsType.FREETEXT_COLOR:this.#updateColor(e)}}static get defaultPropertiesToUpdate(){return[[b.AnnotationEditorParamsType.FREETEXT_SIZE,a._defaultFontSize],[b.AnnotationEditorParamsType.FREETEXT_COLOR,a._defaultColor||_.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[b.AnnotationEditorParamsType.FREETEXT_SIZE,this.#fontSize],[b.AnnotationEditorParamsType.FREETEXT_COLOR,this.#color]]}#updateFontSize(t){const e=t=>{this.editorDiv.style.fontSize=`calc(${t}px * var(--scale-factor))`,this.translate(0,-(t-this.#fontSize)*this.parentScale),this.#fontSize=t,this.#setEditorDimensions()},i=this.#fontSize;this.addCommands({cmd:()=>{e(t)},undo:()=>{e(i)},mustExec:!0,type:b.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#updateColor(t){const e=this.#color;this.addCommands({cmd:()=>{this.#color=this.editorDiv.style.color=t},undo:()=>{this.#color=this.editorDiv.style.color=e},mustExec:!0,type:b.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){var t=this.parentScale;return[-a._internalPadding*t,-(a._internalPadding+this.#fontSize)*t]}rebuild(){this.parent&&(super.rebuild(),null===this.div||this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(b.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#boundEditorDivKeydown),this.editorDiv.addEventListener("focus",this.#boundEditorDivFocus),this.editorDiv.addEventListener("blur",this.#boundEditorDivBlur),this.editorDiv.addEventListener("input",this.#boundEditorDivInput))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#editorDivId),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#boundEditorDivKeydown),this.editorDiv.removeEventListener("focus",this.#boundEditorDivFocus),this.editorDiv.removeEventListener("blur",this.#boundEditorDivBlur),this.editorDiv.removeEventListener("input",this.#boundEditorDivInput),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv)&&this.editorDiv.focus()}onceAdded(){this.width?this.#cheatInitialRect():(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#extractText(){var t=this.editorDiv.getElementsByTagName("div");if(0===t.length)return this.editorDiv.innerText;var e=[];for(const i of t)e.push(i.innerText.replace(/\r\n?|\n/,""));return e.join("\n")}#setEditorDimensions(){var t,e,i,[s,a]=this.parentDimensions;let r;this.isAttachedToDOM?r=this.div.getBoundingClientRect():({currentLayer:t,div:e}=this,i=e.style.display,e.style.display="hidden",t.div.append(this.div),r=e.getBoundingClientRect(),e.remove(),e.style.display=i),this.rotation%180==this.parentRotation%180?(this.width=r.width/s,this.height=r.height/a):(this.width=r.height/s,this.height=r.width/a),this.fixAndSetPosition()}commit(){if(this.isInEditMode()){super.commit(),this.disableEditMode();const t=this.#content,e=this.#content=this.#extractText().trimEnd();if(t!==e){const i=t=>{(this.#content=t)?(this.#setContent(),this._uiManager.rebuild(this),this.#setEditorDimensions()):this.remove()};this.addCommands({cmd:()=>{i(e)},undo:()=>{i(t)},mustExec:!1}),this.#setEditorDimensions()}}}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&"Enter"===t.key&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){a._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(!this.div){let a,r;this.width&&(a=this.x,r=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#editorDivId),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),_.AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then(t=>this.editorDiv?.setAttribute("default-content",t)),this.editorDiv.contentEditable=!0;var n=this.editorDiv["style"];if(n.fontSize=`calc(${this.#fontSize}px * var(--scale-factor))`,n.color=this.#color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,p.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){var[n,o]=this.parentDimensions;if(this.annotationElementId){var l=this.#initialData["position"];let[t,e]=this.getInitialTranslation();[t,e]=this.pageTranslationToScreen(t,e);var[h,d]=this.pageDimensions,[c,u]=this.pageTranslation;let i,s;switch(this.rotation){case 0:i=a+(l[0]-c)/h,s=r+this.height-(l[1]-u)/d;break;case 90:i=a+(l[0]-c)/h,s=r-(l[1]-u)/d,[t,e]=[e,-t];break;case 180:i=a-this.width+(l[0]-c)/h,s=r-(l[1]-u)/d,[t,e]=[-t,-e];break;case 270:i=a+(l[0]-c-this.height*d)/h,s=r+(l[1]-u-this.width*h)/d,[t,e]=[-e,t]}this.setAt(i*n,s*o,t,e)}else this.setAt(a*n,r*o,this.width*n,this.height*o);this.#setContent(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0}return this.div}#setContent(){if(this.editorDiv.replaceChildren(),this.#content)for(const e of this.#content.split("\n")){var t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}get contentDiv(){return this.editorDiv}static deserialize(t,e,i){let s=null;if(t instanceof A.FreeTextAnnotationElement){var{data:{defaultAppearanceData:{fontSize:a,fontColor:r},rect:n,rotation:o,id:l},textContent:h,textPosition:d,parent:{page:{pageNumber:c}}}=t;if(!h||0===h.length)return null;s=t={annotationType:b.AnnotationEditorType.FREETEXT,color:Array.from(r),fontSize:a,value:h.join("\n"),position:d,pageIndex:c-1,rect:n,rotation:o,id:l,deleted:!1}}r=super.deserialize(t,e,i);return r.#fontSize=t.fontSize,r.#color=b.Util.makeHexColor(...t.color),r.#content=t.value,r.annotationElementId=t.id||null,r.#initialData=s,r}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};var e=a._internalPadding*this.parentScale,e=this.getRect(e,e),i=_.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#color),i={annotationType:b.AnnotationEditorType.FREETEXT,color:i,fontSize:this.#fontSize,value:this.#content,pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(!t){if(this.annotationElementId&&!this.#hasElementChanged(i))return null;i.id=this.annotationElementId}return i}#hasElementChanged(t){const{value:e,fontSize:i,color:s,rect:a,pageIndex:r}=this.#initialData;return t.value!==e||t.fontSize!==i||t.rect.some((t,e)=>1<=Math.abs(t-a[e]))||t.color.some((t,e)=>t!==s[e])||t.pageIndex!==r}#cheatInitialRect(t=!1){this.annotationElementId&&(this.#setEditorDimensions(),t||0!==this.width&&0!==this.height?(t=a._internalPadding*this.parentScale,this.#initialData.rect=this.getRect(t,t)):setTimeout(()=>this.#cheatInitialRect(!0),0))}}var s=i(97),r=i(405);class n extends _.AnnotationEditor{#boxes;#clipPathId=null;#colorPicker=null;#focusOutlines=null;#highlightDiv=null;#highlightOutlines=null;#id=null;#lastPoint=null;#opacity;#outlineId=null;static _defaultColor=null;static _defaultOpacity=1;static _l10nPromise;static _type="highlight";static _editorType=b.AnnotationEditorType.HIGHLIGHT;constructor(t){super({...t,name:"highlightEditor"}),n._defaultColor||=this._uiManager.highlightColors?.values().next().value||"#fff066",this.color=t.color||n._defaultColor,this.#opacity=t.opacity||n._defaultOpacity,this.#boxes=t.boxes||null,this._isDraggable=!1,this.#createOutlines(),this.#addToDrawLayer(),this.rotate(this.rotation)}#createOutlines(){var t=new r.Outliner(this.#boxes,.001),t=(this.#highlightOutlines=t.getOutlines(),{x:this.x,y:this.y,width:this.width,height:this.height}=this.#highlightOutlines.box,new r.Outliner(this.#boxes,.0025,.001,"ltr"===this._uiManager.direction)),t=(this.#focusOutlines=t.getOutlines(),this.#focusOutlines.box)["lastPoint"];this.#lastPoint=[(t[0]-this.x)/this.width,(t[1]-this.y)/this.height]}static initialize(t){_.AnnotationEditor.initialize(t)}static updateDefaultParams(t,e){t===b.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR&&(n._defaultColor=e)}get toolbarPosition(){return this.#lastPoint}updateParams(t,e){t===b.AnnotationEditorParamsType.HIGHLIGHT_COLOR&&this.#updateColor(e)}static get defaultPropertiesToUpdate(){return[[b.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,n._defaultColor]]}get propertiesToUpdate(){return[[b.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||n._defaultColor]]}#updateColor(t){const e=this.color;this.addCommands({cmd:()=>{this.color=t,this.parent.drawLayer.changeColor(this.#id,t),this.#colorPicker?.updateColor(t)},undo:()=>{this.color=e,this.parent.drawLayer.changeColor(this.#id,e),this.#colorPicker?.updateColor(e)},mustExec:!0,type:b.AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}async addEditToolbar(){var t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(this.#colorPicker=new s.ColorPicker({editor:this}),t.addColorPicker(this.#colorPicker)),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(0)}getRect(t,e){return super.getRect(t,e,0)}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){super.remove(),this.#cleanDrawLayer()}rebuild(){this.parent&&(super.rebuild(),null===this.div||(this.#addToDrawLayer(),this.isAttachedToDOM)||this.parent.add(this))}setParent(t){let e=!1;this.parent&&!t?this.#cleanDrawLayer():t&&(this.#addToDrawLayer(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#cleanDrawLayer(){null!==this.#id&&this.parent&&(this.parent.drawLayer.remove(this.#id),this.#id=null,this.parent.drawLayer.remove(this.#outlineId),this.#outlineId=null)}#addToDrawLayer(t=this.parent){null===this.#id&&({id:this.#id,clipPathId:this.#clipPathId}=t.drawLayer.highlight(this.#highlightOutlines,this.color,this.#opacity),this.#highlightDiv&&(this.#highlightDiv.style.clipPath=this.#clipPathId),this.#outlineId=t.drawLayer.highlightOutline(this.#focusOutlines))}static#rotateBbox({x:t,y:e,width:i,height:s},a){switch(a){case 90:return{x:1-e-s,y:t,width:s,height:i};case 180:return{x:1-t-i,y:1-e-s,width:i,height:s};case 270:return{x:e,y:1-t-i,width:s,height:i}}return{x:t,y:e,width:i,height:s}}rotate(t){var e=this.parent["drawLayer"];e.rotate(this.#id,t),e.rotate(this.#outlineId,t),e.updateBox(this.#id,n.#rotateBbox(this,t)),e.updateBox(this.#outlineId,n.#rotateBbox(this.#focusOutlines.box,t))}render(){var t,e,i;return this.div||(t=super.render(),e=this.#highlightDiv=document.createElement("div"),[e,i]=(t.append(e),e.className="internal",e.style.clipPath=this.#clipPathId,this.parentDimensions),this.setDims(this.width*e,this.height*i),(0,p.bindEvents)(this,this.#highlightDiv,["pointerover","pointerleave"]),this.enableEditing(),t)}pointerover(){this.parent.drawLayer.addClass(this.#outlineId,"hovered")}pointerleave(){this.parent.drawLayer.removeClass(this.#outlineId,"hovered")}select(){super.select(),this.parent?.drawLayer.removeClass(this.#outlineId,"hovered"),this.parent?.drawLayer.addClass(this.#outlineId,"selected")}unselect(){super.unselect(),this.parent?.drawLayer.removeClass(this.#outlineId,"selected")}#serializeBoxes(){var t,e,i,s,[a,r]=this.pageDimensions,n=this.#boxes,o=new Array(8*n.length);let l=0;for({x:t,y:e,width:i,height:s}of n){var h=t*a,d=(1-e-s)*r;o[l]=o[l+4]=h,o[l+1]=o[l+3]=d,o[l+2]=o[l+6]=h+i*a,o[l+5]=o[l+7]=d+s*r,l+=8}return o}#serializeOutlines(){var[t,e]=this.pageDimensions,i=this.width*t,s=this.height*e,a=this.x*t,r=(1-this.y-this.height)*e,n=[];for(const l of this.#highlightOutlines.outlines){var o=new Array(l.length);for(let t=0;t<l.length;t+=2)o[t]=a+l[t]*i,o[t+1]=r+(1-l[t+1])*s;n.push(o)}return n}static deserialize(t,e,i){var e=super.deserialize(t,e,i),{rect:i,color:s,quadPoints:a}=t,[r,n]=(e.color=b.Util.makeHexColor(...s),e.#opacity=t.opacity,e.pageDimensions),o=(e.width=(i[2]-i[0])/r,e.height=(i[3]-i[1])/n,e.#boxes=[]);for(let t=0;t<a.length;t+=8)o.push({x:a[4]/r,y:1-a[t+5]/n,width:(a[t+2]-a[t])/r,height:(a[t+5]-a[t+1])/n});return e.#createOutlines(),e}serialize(t=!1){var e;return this.isEmpty()||t?null:(t=this.getRect(0,0),e=_.AnnotationEditor._colorManager.convert(this.color),{annotationType:b.AnnotationEditorType.HIGHLIGHT,color:e,opacity:this.#opacity,quadPoints:this.#serializeBoxes(),outlines:this.#serializeOutlines(),pageIndex:this.pageIndex,rect:t,rotation:0,structTreeParentId:this._structTreeParentId})}static canCreateNewEmptyEditor(){return!1}}var o=i(473);class y extends _.AnnotationEditor{#baseHeight=0;#baseWidth=0;#boundCanvasPointermove=this.canvasPointermove.bind(this);#boundCanvasPointerleave=this.canvasPointerleave.bind(this);#boundCanvasPointerup=this.canvasPointerup.bind(this);#boundCanvasPointerdown=this.canvasPointerdown.bind(this);#canvasContextMenuTimeoutId=null;#currentPath2D=new Path2D;#disableEditing=!1;#hasSomethingToDraw=!1;#isCanvasInitialized=!1;#observer=null;#realWidth=0;#realHeight=0;#requestFrameCallback=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=b.AnnotationEditorType.INK;constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t){_.AnnotationEditor.initialize(t)}static updateDefaultParams(t,e){switch(t){case b.AnnotationEditorParamsType.INK_THICKNESS:y._defaultThickness=e;break;case b.AnnotationEditorParamsType.INK_COLOR:y._defaultColor=e;break;case b.AnnotationEditorParamsType.INK_OPACITY:y._defaultOpacity=e/100}}updateParams(t,e){switch(t){case b.AnnotationEditorParamsType.INK_THICKNESS:this.#updateThickness(e);break;case b.AnnotationEditorParamsType.INK_COLOR:this.#updateColor(e);break;case b.AnnotationEditorParamsType.INK_OPACITY:this.#updateOpacity(e)}}static get defaultPropertiesToUpdate(){return[[b.AnnotationEditorParamsType.INK_THICKNESS,y._defaultThickness],[b.AnnotationEditorParamsType.INK_COLOR,y._defaultColor||_.AnnotationEditor._defaultLineColor],[b.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*y._defaultOpacity)]]}get propertiesToUpdate(){return[[b.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||y._defaultThickness],[b.AnnotationEditorParamsType.INK_COLOR,this.color||y._defaultColor||_.AnnotationEditor._defaultLineColor],[b.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??y._defaultOpacity))]]}#updateThickness(t){const e=this.thickness;this.addCommands({cmd:()=>{this.thickness=t,this.#fitToContent()},undo:()=>{this.thickness=e,this.#fitToContent()},mustExec:!0,type:b.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#updateColor(t){const e=this.color;this.addCommands({cmd:()=>{this.color=t,this.#redraw()},undo:()=>{this.color=e,this.#redraw()},mustExec:!0,type:b.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#updateOpacity(t){t/=100;const e=this.opacity;this.addCommands({cmd:()=>{this.opacity=t,this.#redraw()},undo:()=>{this.opacity=e,this.#redraw()},mustExec:!0,type:b.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),null!==this.div)&&(this.canvas||(this.#createCanvas(),this.#createObserver()),this.isAttachedToDOM||(this.parent.add(this),this.#setCanvasDims()),this.#fitToContent())}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#canvasContextMenuTimeoutId&&(clearTimeout(this.#canvasContextMenuTimeoutId),this.#canvasContextMenuTimeoutId=null),this.#observer.disconnect(),this.#observer=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&null===t&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){var[t,e]=this.parentDimensions,t=this.width*t,e=this.height*e;this.setDimensions(t,e)}enableEditMode(){this.#disableEditing||null===this.canvas||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#boundCanvasPointerdown))}disableEditMode(){this.isInEditMode()&&null!==this.canvas&&(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#boundCanvasPointerdown))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}#getInitialBBox(){var{parentRotation:t,parentDimensions:[e,i]}=this;switch(t){case 90:return[0,i,i,e];case 180:return[e,i,e,i];case 270:return[e,0,i,e];default:return[0,0,e,i]}}#setStroke(){var{ctx:t,color:e,opacity:i,thickness:s,parentScale:a,scaleFactor:r}=this;t.lineWidth=s*a/r,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=""+e+(0,p.opacityToHex)(i)}#startDrawing(t,e){this.canvas.addEventListener("contextmenu",o.noContextMenu),this.canvas.addEventListener("pointerleave",this.#boundCanvasPointerleave),this.canvas.addEventListener("pointermove",this.#boundCanvasPointermove),this.canvas.addEventListener("pointerup",this.#boundCanvasPointerup),this.canvas.removeEventListener("pointerdown",this.#boundCanvasPointerdown),this.isEditing=!0,this.#isCanvasInitialized||(this.#isCanvasInitialized=!0,this.#setCanvasDims(),this.thickness||=y._defaultThickness,this.color||=y._defaultColor||_.AnnotationEditor._defaultLineColor,this.opacity??=y._defaultOpacity),this.currentPath.push([t,e]),this.#hasSomethingToDraw=!1,this.#setStroke(),this.#requestFrameCallback=()=>{this.#drawPoints(),this.#requestFrameCallback&&window.requestAnimationFrame(this.#requestFrameCallback)},window.requestAnimationFrame(this.#requestFrameCallback)}#draw(e,i){var[s,t]=this.currentPath.at(-1);if(!(1<this.currentPath.length&&e===s&&i===t)){s=this.currentPath;let t=this.#currentPath2D;s.push([e,i]),this.#hasSomethingToDraw=!0,s.length<=2?(t.moveTo(...s[0]),t.lineTo(e,i)):(3===s.length&&(this.#currentPath2D=t=new Path2D,t.moveTo(...s[0])),this.#makeBezierCurve(t,...s.at(-3),...s.at(-2),e,i))}}#endPath(){var t;0!==this.currentPath.length&&(t=this.currentPath.at(-1),this.#currentPath2D.lineTo(...t))}#stopDrawing(t,e){this.#requestFrameCallback=null,t=Math.min(Math.max(t,0),this.canvas.width),e=Math.min(Math.max(e,0),this.canvas.height),this.#draw(t,e),this.#endPath();let i;i=1!==this.currentPath.length?this.#generateBezierPoints():[[t=[t,e],t.slice(),t.slice(),t]];const s=this.#currentPath2D,a=this.currentPath;this.currentPath=[],this.#currentPath2D=new Path2D;this.addCommands({cmd:()=>{this.allRawPaths.push(a),this.paths.push(i),this.bezierPath2D.push(s),this.rebuild()},undo:()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(this.#createCanvas(),this.#createObserver()),this.#fitToContent())},mustExec:!0})}#drawPoints(){if(this.#hasSomethingToDraw){this.#hasSomethingToDraw=!1;Math.ceil(this.thickness*this.parentScale);var t=this.currentPath.slice(-3),e=t.map(t=>t[0]),t=t.map(t=>t[1]),i=(Math.min(...e),Math.max(...e),Math.min(...t),Math.max(...t),this["ctx"]);i.save(),i.clearRect(0,0,this.canvas.width,this.canvas.height);for(const s of this.bezierPath2D)i.stroke(s);i.stroke(this.#currentPath2D),i.restore()}}#makeBezierCurve(t,e,i,s,a,r,n){e=(e+s)/2,i=(i+a)/2,r=(s+r)/2,n=(a+n)/2;t.bezierCurveTo(e+2*(s-e)/3,i+2*(a-i)/3,r+2*(s-r)/3,n+2*(a-n)/3,r,n)}#generateBezierPoints(){var t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];var e=[];let i,[s,a]=t[0];for(i=1;i<t.length-2;i++){const[o,l]=t[i],[h,d]=t[i+1];var r=(o+h)/2,n=(l+d)/2;const c=[s+2*(o-s)/3,a+2*(l-a)/3],u=[r+2*(o-r)/3,n+2*(l-n)/3];e.push([[s,a],c,u,[r,n]]),[s,a]=[r,n]}const[o,l]=t[i],[h,d]=t[i+1],c=[s+2*(o-s)/3,a+2*(l-a)/3],u=[h+2*(o-h)/3,d+2*(l-d)/3];return e.push([[s,a],c,u,[h,d]]),e}#redraw(){if(this.isEmpty())this.#updateTransform();else{this.#setStroke();var{canvas:t,ctx:e}=this;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height),this.#updateTransform();for(const i of this.bezierPath2D)e.stroke(i)}}commit(){this.#disableEditing||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#disableEditing=!0,this.div.classList.add("disabled"),this.#fitToContent(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){0===t.button&&this.isInEditMode()&&!this.#disableEditing&&(this.setInForeground(),t.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#startDrawing(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#draw(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#endDrawing(t)}canvasPointerleave(t){this.#endDrawing(t)}#endDrawing(t){this.canvas.removeEventListener("pointerleave",this.#boundCanvasPointerleave),this.canvas.removeEventListener("pointermove",this.#boundCanvasPointermove),this.canvas.removeEventListener("pointerup",this.#boundCanvasPointerup),this.canvas.addEventListener("pointerdown",this.#boundCanvasPointerdown),this.#canvasContextMenuTimeoutId&&clearTimeout(this.#canvasContextMenuTimeoutId),this.#canvasContextMenuTimeoutId=setTimeout(()=>{this.#canvasContextMenuTimeoutId=null,this.canvas.removeEventListener("contextmenu",o.noContextMenu)},10),this.#stopDrawing(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#createObserver(){this.#observer=new ResizeObserver(t=>{t=t[0].contentRect;t.width&&t.height&&this.setDimensions(t.width,t.height)}),this.#observer.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#disableEditing}render(){if(!this.div){let t,e;this.width&&(t=this.x,e=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");var[i,s,a,r]=this.#getInitialBBox();this.setAt(i,s,0,0),this.setDims(a,r),this.#createCanvas(),this.width?([i,s]=this.parentDimensions,this.setAspectRatio(this.width*i,this.height*s),this.setAt(t*i,e*s,this.width*i,this.height*s),this.#isCanvasInitialized=!0,this.#setCanvasDims(),this.setDims(this.width*i,this.height*s),this.#redraw(),this.div.classList.add("disabled")):(this.div.classList.add("editing"),this.enableEditMode()),this.#createObserver()}return this.div}#setCanvasDims(){var t,e;this.#isCanvasInitialized&&([t,e]=this.parentDimensions,this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*e),this.#updateTransform())}setDimensions(t,e){var i=Math.round(t),s=Math.round(e);this.#realWidth===i&&this.#realHeight===s||(this.#realWidth=i,this.#realHeight=s,this.canvas.style.visibility="hidden",[i,s]=this.parentDimensions,this.width=t/i,this.height=e/s,this.fixAndSetPosition(),this.#disableEditing&&this.#setScaleFactor(t,e),this.#setCanvasDims(),this.#redraw(),this.canvas.style.visibility="visible",this.fixDims())}#setScaleFactor(t,e){var i=this.#getPadding(),t=(t-i)/this.#baseWidth,e=(e-i)/this.#baseHeight;this.scaleFactor=Math.min(t,e)}#updateTransform(){var t=this.#getPadding()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#buildPath2D(i){var s=new Path2D;for(let t=0,e=i.length;t<e;t++){var[a,r,n,o]=i[t];0===t&&s.moveTo(...a),s.bezierCurveTo(r[0],r[1],n[0],n[1],o[0],o[1])}return s}static#toPDFCoordinates(i,t,e){var[s,a,r,n]=t;switch(e){case 0:for(let t=0,e=i.length;t<e;t+=2)i[t]+=s,i[t+1]=n-i[t+1];break;case 90:for(let t=0,e=i.length;t<e;t+=2){var o=i[t];i[t]=i[t+1]+s,i[t+1]=o+a}break;case 180:for(let t=0,e=i.length;t<e;t+=2)i[t]=r-i[t],i[t+1]+=a;break;case 270:for(let t=0,e=i.length;t<e;t+=2){var l=i[t];i[t]=r-i[t+1],i[t+1]=n-l}break;default:throw new Error("Invalid rotation")}return i}static#fromPDFCoordinates(i,t,e){var[s,a,r,n]=t;switch(e){case 0:for(let t=0,e=i.length;t<e;t+=2)i[t]-=s,i[t+1]=n-i[t+1];break;case 90:for(let t=0,e=i.length;t<e;t+=2){var o=i[t];i[t]=i[t+1]-a,i[t+1]=o-s}break;case 180:for(let t=0,e=i.length;t<e;t+=2)i[t]=r-i[t],i[t+1]-=a;break;case 270:for(let t=0,e=i.length;t<e;t+=2){var l=i[t];i[t]=n-i[t+1],i[t+1]=r-l}break;default:throw new Error("Invalid rotation")}return i}#serializePaths(i,t,e,s){var a=[],r=this.thickness/2,n=i*t+r,o=i*e+r;for(const b of this.paths){var l=[],h=[];for(let t=0,e=b.length;t<e;t++){var[d,c,u,p]=b[t],g=i*d[0]+n,d=i*d[1]+o,m=i*c[0]+n,c=i*c[1]+o,f=i*u[0]+n,u=i*u[1]+o,v=i*p[0]+n,p=i*p[1]+o;0===t&&(l.push(g,d),h.push(g,d)),l.push(m,c,f,u,v,p),h.push(m,c),t===e-1&&h.push(v,p)}a.push({bezier:y.#toPDFCoordinates(l,s,this.rotation),points:y.#toPDFCoordinates(h,s,this.rotation)})}return a}#getBbox(){let t=1/0,e=-1/0,i=1/0,s=-1/0;for(const l of this.paths)for(var[a,r,n,o]of l){a=b.Util.bezierBoundingBox(...a,...r,...n,...o);t=Math.min(t,a[0]),i=Math.min(i,a[1]),e=Math.max(e,a[2]),s=Math.max(s,a[3])}return[t,i,e,s]}#getPadding(){return this.#disableEditing?Math.ceil(this.thickness*this.parentScale):0}#fitToContent(t=!1){var e,i,s,a,r,n;this.isEmpty()||(this.#disableEditing?(n=this.#getBbox(),e=this.#getPadding(),this.#baseWidth=Math.max(_.AnnotationEditor.MIN_SIZE,n[2]-n[0]),this.#baseHeight=Math.max(_.AnnotationEditor.MIN_SIZE,n[3]-n[1]),i=Math.ceil(e+this.#baseWidth*this.scaleFactor),s=Math.ceil(e+this.#baseHeight*this.scaleFactor),[a,r]=this.parentDimensions,this.width=i/a,this.height=s/r,this.setAspectRatio(i,s),a=this.translationX,r=this.translationY,this.translationX=-n[0],this.translationY=-n[1],this.#setCanvasDims(),this.#redraw(),this.#realWidth=i,this.#realHeight=s,this.setDims(i,s),n=t?e/this.scaleFactor/2:0,this.translate(a-this.translationX-n,r-this.translationY-n)):this.#redraw())}static deserialize(t,e,i){if(t instanceof A.InkAnnotationElement)return null;var a,r=super.deserialize(t,e,i),[e,i]=(r.thickness=t.thickness,r.color=b.Util.makeHexColor(...t.color),r.opacity=t.opacity,r.pageDimensions),e=r.width*e,i=r.height*i,n=r.parentScale,o=t.thickness/2,{paths:t,rect:l,rotation:h}=(r.#disableEditing=!0,r.#realWidth=Math.round(e),r.#realHeight=Math.round(i),t);for({bezier:a}of t){a=y.#fromPDFCoordinates(a,l,h);var d=[];r.paths.push(d);let i=n*(a[0]-o),s=n*(a[1]-o);for(let t=2,e=a.length;t<e;t+=6){var c=n*(a[t]-o),u=n*(a[t+1]-o),p=n*(a[t+2]-o),g=n*(a[t+3]-o),m=n*(a[t+4]-o),f=n*(a[t+5]-o);d.push([[i,s],[c,u],[p,g],[m,f]]),i=m,s=f}var v=this.#buildPath2D(d);r.bezierPath2D.push(v)}t=r.#getBbox();return r.#baseWidth=Math.max(_.AnnotationEditor.MIN_SIZE,t[2]-t[0]),r.#baseHeight=Math.max(_.AnnotationEditor.MIN_SIZE,t[3]-t[1]),r.#setScaleFactor(e,i),r}serialize(){var t,e;return this.isEmpty()?null:(t=this.getRect(0,0),e=_.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle),{annotationType:b.AnnotationEditorType.INK,color:e,thickness:this.thickness,opacity:this.opacity,paths:this.#serializePaths(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId})}}class l extends _.AnnotationEditor{#bitmap=null;#bitmapId=null;#bitmapPromise=null;#bitmapUrl=null;#bitmapFile=null;#bitmapFileName="";#canvas=null;#observer=null;#resizeTimeoutId=null;#isSvg=!1;#hasBeenAddedInUndoStack=!1;static _type="stamp";static _editorType=b.AnnotationEditorType.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#bitmapUrl=t.bitmapUrl,this.#bitmapFile=t.bitmapFile}static initialize(t){_.AnnotationEditor.initialize(t)}static get supportedTypes(){return(0,b.shadow)(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(t=>"image/"+t))}static get supportedTypesStr(){return(0,b.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,e){e.pasteEditor(b.AnnotationEditorType.STAMP,{bitmapFile:t.getAsFile()})}#getBitmapFetched(t,e=!1){t?(this.#bitmap=t.bitmap,e||(this.#bitmapId=t.id,this.#isSvg=t.isSvg),t.file&&(this.#bitmapFileName=t.file.name),this.#createCanvas()):this.remove()}#getBitmapDone(){this.#bitmapPromise=null,this._uiManager.enableWaiting(!1),this.#canvas&&this.div.focus()}#getBitmap(){var t;if(this.#bitmapId)this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#bitmapId).then(t=>this.#getBitmapFetched(t,!0)).finally(()=>this.#getBitmapDone());else if(this.#bitmapUrl)t=this.#bitmapUrl,this.#bitmapUrl=null,this._uiManager.enableWaiting(!0),this.#bitmapPromise=this._uiManager.imageManager.getFromUrl(t).then(t=>this.#getBitmapFetched(t)).finally(()=>this.#getBitmapDone());else if(this.#bitmapFile)t=this.#bitmapFile,this.#bitmapFile=null,this._uiManager.enableWaiting(!0),this.#bitmapPromise=this._uiManager.imageManager.getFromFile(t).then(t=>this.#getBitmapFetched(t)).finally(()=>this.#getBitmapDone());else{const i=document.createElement("input");i.type="file",i.accept=l.supportedTypesStr,this.#bitmapPromise=new Promise(e=>{i.addEventListener("change",async()=>{var t;i.files&&0!==i.files.length?(this._uiManager.enableWaiting(!0),t=await this._uiManager.imageManager.getFromFile(i.files[0]),this.#getBitmapFetched(t)):this.remove(),e()}),i.addEventListener("cancel",()=>{this.remove(),e()})}).finally(()=>this.#getBitmapDone()),i.click()}}remove(){this.#bitmapId&&(this.#bitmap=null,this._uiManager.imageManager.deleteId(this.#bitmapId),this.#canvas?.remove(),this.#canvas=null,this.#observer?.disconnect(),this.#observer=null,this.#resizeTimeoutId)&&(clearTimeout(this.#resizeTimeoutId),this.#resizeTimeoutId=null),super.remove()}rebuild(){this.parent?(super.rebuild(),null===this.div||(this.#bitmapId&&this.#getBitmap(),this.isAttachedToDOM)||this.parent.add(this)):this.#bitmapId&&this.#getBitmap()}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#bitmapPromise||this.#bitmap||this.#bitmapUrl||this.#bitmapFile)}get isResizable(){return!0}render(){if(!this.div){let t,e;var i,s;this.width&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.#bitmap?this.#createCanvas():this.#getBitmap(),this.width&&([i,s]=this.parentDimensions,this.setAt(t*i,e*s,this.width*i,this.height*s))}return this.div}#createCanvas(){var t=this["div"];let{width:e,height:i}=this.#bitmap;var[s,a]=this.pageDimensions,[r,n]=(this.width?(e=this.width*s,i=this.height*a):(e>.75*s||i>.75*a)&&(r=Math.min(.75*s/e,.75*a/i),e*=r,i*=r),this.parentDimensions),r=(this.setDims(e*r/s,i*n/a),this._uiManager.enableWaiting(!1),this.#canvas=document.createElement("canvas"));t.append(r),t.hidden=!1,this.#drawBitmap(e,i),this.#createObserver(),this.#hasBeenAddedInUndoStack||(this.parent.addUndoableEditor(this),this.#hasBeenAddedInUndoStack=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton(),this.#bitmapFileName&&r.setAttribute("aria-label",this.#bitmapFileName)}#setDimensions(t,e){var[i,s]=this.parentDimensions;this.width=t/i,this.height=e/s,this.setDims(t,e),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),(this._initialOptions=null)!==this.#resizeTimeoutId&&clearTimeout(this.#resizeTimeoutId);this.#resizeTimeoutId=setTimeout(()=>{this.#resizeTimeoutId=null,this.#drawBitmap(t,e)},200)}#scaleBitmap(t,e){var{width:i,height:s}=this.#bitmap;let a=i,r=s,n=this.#bitmap;for(;a>2*t||r>2*e;){var o=a,l=r,h=(a>2*t&&(a=16384<=a?Math.floor(a/2)-1:Math.ceil(a/2)),r>2*e&&(r=16384<=r?Math.floor(r/2)-1:Math.ceil(r/2)),new OffscreenCanvas(a,r));h.getContext("2d").drawImage(n,0,0,o,l,0,0,a,r),n=h.transferToImageBitmap()}return n}#drawBitmap(t,e){t=Math.ceil(t),e=Math.ceil(e);var i,s=this.#canvas;!s||s.width===t&&s.height===e||(s.width=t,s.height=e,i=this.#isSvg?this.#bitmap:this.#scaleBitmap(t,e),(s=s.getContext("2d")).filter=this._uiManager.hcmFilter,s.drawImage(i,0,0,i.width,i.height,0,0,t,e))}getImageForAltText(){return this.#canvas}#serializeBitmap(t){if(t){if(this.#isSvg){t=this._uiManager.imageManager.getSvgUrl(this.#bitmapId);if(t)return t}t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#bitmap,t.getContext("2d").drawImage(this.#bitmap,0,0),t.toDataURL()}var e,i;return this.#isSvg?([t,e]=this.pageDimensions,t=Math.round(this.width*t*o.PixelsPerInch.PDF_TO_CSS_UNITS),e=Math.round(this.height*e*o.PixelsPerInch.PDF_TO_CSS_UNITS),(i=new OffscreenCanvas(t,e)).getContext("2d").drawImage(this.#bitmap,0,0,this.#bitmap.width,this.#bitmap.height,0,0,t,e),i.transferToImageBitmap()):structuredClone(this.#bitmap)}#createObserver(){this.#observer=new ResizeObserver(t=>{t=t[0].contentRect;t.width&&t.height&&this.#setDimensions(t.width,t.height)}),this.#observer.observe(this.div)}static deserialize(t,e,i){var s,a,r,n;return t instanceof A.StampAnnotationElement?null:(e=super.deserialize(t,e,i),{rect:t,bitmapUrl:s,bitmapId:n,isSvg:a,accessibilityData:r}=t,[i,n]=(n&&i.imageManager.isValidId(n)?e.#bitmapId=n:e.#bitmapUrl=s,e.#isSvg=a,e.pageDimensions),e.width=(t[2]-t[0])/i,e.height=(t[3]-t[1])/n,r&&(e.altTextData=r),e)}serialize(t=!1,e=null){var i,s;return this.isEmpty()?null:(i={annotationType:b.AnnotationEditorType.STAMP,bitmapId:this.#bitmapId,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#isSvg,structTreeParentId:this._structTreeParentId},t?(i.bitmapUrl=this.#serializeBitmap(!0),i.accessibilityData=this.altTextData):({decorative:t,altText:s}=this.altTextData,!t&&s&&(i.accessibilityData={type:"Figure",alt:s}),null!==e&&(e.stamps||=new Map,t=this.#isSvg?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null,e.stamps.has(this.#bitmapId)?this.#isSvg&&t>(s=e.stamps.get(this.#bitmapId)).area&&(s.area=t,s.serialized.bitmap.close(),s.serialized.bitmap=this.#serializeBitmap(!1)):(e.stamps.set(this.#bitmapId,{area:t,serialized:i}),i.bitmap=this.#serializeBitmap(!1)))),i)}}class c{#accessibilityManager;#allowClick=!1;#annotationLayer=null;#boundPointerup=this.pointerup.bind(this);#boundPointerUpAfterSelection=this.pointerUpAfterSelection.bind(this);#boundPointerdown=this.pointerdown.bind(this);#editorFocusTimeoutId=null;#boundSelectionStart=this.selectionStart.bind(this);#editors=new Map;#hadPointerDown=!1;#isCleaningUp=!1;#isDisabling=!1;#textLayer=null;#uiManager;static _initialized=!1;static#editorTypes=new Map([a,y,l,n].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:i,accessibilityManager:s,annotationLayer:a,drawLayer:r,textLayer:n,viewport:o,l10n:l}){var h=[...c.#editorTypes.values()];if(!c._initialized){c._initialized=!0;for(const d of h)d.initialize(l)}t.registerEditorTypes(h),this.#uiManager=t,this.pageIndex=e,this.div=i,this.#accessibilityManager=s,this.#annotationLayer=a,this.viewport=o,this.#textLayer=n,this.drawLayer=r,this.#uiManager.addLayer(this)}get isEmpty(){return 0===this.#editors.size}updateToolbar(t){this.#uiManager.updateToolbar(t)}updateMode(t=this.#uiManager.getMode()){switch(this.#cleanup(),t){case b.AnnotationEditorType.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;case b.AnnotationEditorType.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case b.AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}if(t!==b.AnnotationEditorType.NONE){var e=this.div["classList"];for(const i of c.#editorTypes.values())e.toggle(i._type+"Editing",t===i._editorType);this.div.hidden=!1}}addInkEditorIfNeeded(t){if(this.#uiManager.getMode()===b.AnnotationEditorType.INK){if(!t)for(const e of this.#editors.values())if(e.isEmpty())return void e.setInBackground();const e=this.#createAndAddNewEditor({offsetX:0,offsetY:0},!1);e.setInBackground()}}setEditingState(t){this.#uiManager.setEditingState(t)}addCommands(t){this.#uiManager.addCommands(t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}enable(){this.togglePointerEvents(!0);var t,e=new Set;for(const i of this.#editors.values())i.enableEditing(),i.annotationElementId&&e.add(i.annotationElementId);if(this.#annotationLayer)for(const s of this.#annotationLayer.getEditableAnnotations())s.hide(),this.#uiManager.isDeletedAnnotationElement(s.data.id)||e.has(s.data.id)||(t=this.deserialize(s))&&(this.addOrRebuild(t),t.enableEditing())}disable(){this.#isDisabling=!0,this.togglePointerEvents(!1);var t=new Set;for(const s of this.#editors.values())s.disableEditing(),s.annotationElementId&&null===s.serialize()?(this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()):t.add(s.annotationElementId);if(this.#annotationLayer)for(const a of this.#annotationLayer.getEditableAnnotations()){var e=a.data["id"];t.has(e)||this.#uiManager.isDeletedAnnotationElement(e)||a.show()}this.#cleanup(),this.isEmpty&&(this.div.hidden=!0);var i=this.div["classList"];for(const r of c.#editorTypes.values())i.remove(r._type+"Editing");this.disableTextSelection(),this.#isDisabling=!1}getEditableAnnotation(t){return this.#annotationLayer?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#uiManager.getActive()!==t&&this.#uiManager.setActiveEditor(t)}enableTextSelection(){this.#textLayer?.div&&document.addEventListener("selectstart",this.#boundSelectionStart)}disableTextSelection(){this.#textLayer?.div&&document.removeEventListener("selectstart",this.#boundSelectionStart)}enableClick(){this.div.addEventListener("pointerdown",this.#boundPointerdown),this.div.addEventListener("pointerup",this.#boundPointerup)}disableClick(){this.div.removeEventListener("pointerdown",this.#boundPointerdown),this.div.removeEventListener("pointerup",this.#boundPointerup)}attach(t){this.#editors.set(t.id,t);var e=t["annotationElementId"];e&&this.#uiManager.isDeletedAnnotationElement(e)&&this.#uiManager.removeDeletedAnnotationElement(t)}detach(t){this.#editors.delete(t.id),this.#accessibilityManager?.removePointerInTextLayer(t.contentDiv),!this.#isDisabling&&t.annotationElementId&&this.#uiManager.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#uiManager.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1,this.#isCleaningUp||this.addInkEditorIfNeeded(!1)}changeParent(t){t.parent!==this&&(t.annotationElementId&&(this.#uiManager.addDeletedAnnotationElement(t.annotationElementId),_.AnnotationEditor.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div)&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div))}add(t){var e;this.changeParent(t),this.#uiManager.addEditor(t),this.attach(t),t.isAttachedToDOM||(e=t.render(),this.div.append(e),t.isAttachedToDOM=!0),t.fixAndSetPosition(),t.onceAdded(),this.#uiManager.addToAnnotationStorage(t)}moveEditorInDOM(t){if(t.isAttachedToDOM){const e=document["activeElement"];t.div.contains(e)&&!this.#editorFocusTimeoutId&&(t._focusEventsAllowed=!1,this.#editorFocusTimeoutId=setTimeout(()=>{this.#editorFocusTimeoutId=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0}),e.focus())},0)),t._structTreeParentId=this.#accessibilityManager?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild()):this.add(t)}addUndoableEditor(t){this.addCommands({cmd:()=>t._uiManager.rebuild(t),undo:()=>{t.remove()},mustExec:!1})}getNextId(){return this.#uiManager.getId()}get#currentEditorType(){return c.#editorTypes.get(this.#uiManager.getMode())}#createNewEditor(t){var e=this.#currentEditorType;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#currentEditorType?.canCreateNewEmptyEditor()}pasteEditor(t,e){this.#uiManager.updateToolbar(t),this.#uiManager.updateMode(t);var{offsetX:t,offsetY:i}=this.#getCenterPoint(),s=this.getNextId(),s=this.#createNewEditor({parent:this,id:s,x:t,y:i,uiManager:this.#uiManager,isCentered:!0,...e});s&&this.add(s)}deserialize(t){return c.#editorTypes.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#uiManager)||null}#createAndAddNewEditor(t,e,i={}){var s=this.getNextId(),s=this.#createNewEditor({parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:this.#uiManager,isCentered:e,...i});return s&&this.add(s),s}#getCenterPoint(){var{x:t,y:e,width:i,height:s}=this.div.getBoundingClientRect(),a=Math.max(0,t),r=Math.max(0,e),a=(a+Math.min(window.innerWidth,t+i))/2-t,i=(r+Math.min(window.innerHeight,e+s))/2-e,[t,r]=this.viewport.rotation%180==0?[a,i]:[i,a];return{offsetX:t,offsetY:r}}addNewEditor(){this.#createAndAddNewEditor(this.#getCenterPoint(),!0)}setSelected(t){this.#uiManager.setSelected(t)}toggleSelected(t){this.#uiManager.toggleSelected(t)}isSelected(t){return this.#uiManager.isSelected(t)}unselect(t){this.#uiManager.unselect(t)}selectionStart(t){this.#textLayer?.div.addEventListener("pointerup",this.#boundPointerUpAfterSelection,{once:!0})}pointerUpAfterSelection(e){var i=document.getSelection();if(0!==i.rangeCount){var s=i.getRangeAt(0);if(!s.collapsed&&this.#textLayer?.div.contains(s.commonAncestorContainer)){const{x:h,y:d,width:c,height:u}=this.#textLayer.div.getBoundingClientRect();s=s.getClientRects();let t;switch(this.viewport.rotation){case 90:t=(t,e,i,s)=>({x:(e-d)/u,y:1-(t+i-h)/c,width:s/u,height:i/c});break;case 180:t=(t,e,i,s)=>({x:1-(t+i-h)/c,y:1-(e+s-d)/u,width:i/c,height:s/u});break;case 270:t=(t,e,i,s)=>({x:1-(e+s-d)/u,y:(t-h)/c,width:s/u,height:i/c});break;default:t=(t,e,i,s)=>({x:(t-h)/c,y:(e-d)/u,width:i/c,height:s/u})}var a,r,n,o,l=[];for({x:a,y:r,width:n,height:o}of s)0!==n&&0!==o&&l.push(t(a,r,n,o));0!==l.length&&this.#createAndAddNewEditor(e,!1,{boxes:l}),i.empty()}}}pointerup(t){var e=b.FeatureTest.platform["isMac"];0!==t.button||t.ctrlKey&&e||t.target===this.div&&this.#hadPointerDown&&(this.#hadPointerDown=!1,this.#allowClick?this.#uiManager.getMode()===b.AnnotationEditorType.STAMP?this.#uiManager.unselectAll():this.#createAndAddNewEditor(t,!1):this.#allowClick=!0)}pointerdown(t){var e;this.#uiManager.getMode()===b.AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),this.#hadPointerDown?this.#hadPointerDown=!1:(e=b.FeatureTest.platform.isMac,0!==t.button||t.ctrlKey&&e||t.target===this.div&&(this.#hadPointerDown=!0,e=this.#uiManager.getActive(),this.#allowClick=!e||e.isEmpty()))}findNewParent(t,e,i){e=this.#uiManager.findParent(e,i);return null!==e&&e!==this&&(e.changeParent(t),!0)}destroy(){this.#uiManager.getActive()?.parent===this&&(this.#uiManager.commitOrRemove(),this.#uiManager.setActiveEditor(null)),this.#editorFocusTimeoutId&&(clearTimeout(this.#editorFocusTimeoutId),this.#editorFocusTimeoutId=null);for(const t of this.#editors.values())this.#accessibilityManager?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#editors.clear(),this.#uiManager.removeLayer(this)}#cleanup(){this.#isCleaningUp=!0;for(const t of this.#editors.values())t.isEmpty()&&t.remove();this.#isCleaningUp=!1}render({viewport:t}){this.viewport=t,(0,o.setLayerDimensions)(this.div,t);for(const e of this.#uiManager.getEditors(this.pageIndex))this.add(e);this.updateMode()}update({viewport:t}){this.#uiManager.commitOrRemove();var e=this.viewport.rotation,i=t.rotation;if(this.viewport=t,(0,o.setLayerDimensions)(this.div,{rotation:i}),e!==i)for(const s of this.#editors.values())s.rotate(i);this.updateMode()}get pageDimensions(){var{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}}},97:(t,e,i)=>{i.d(e,{ColorPicker:()=>r});var s=i(266),a=i(812),n=i(473);class r{#boundKeyDown=this.#keyDown.bind(this);#button=null;#buttonSwatch=null;#defaultColor;#dropdown=null;#dropdownWasFromKeyboard=!1;#isMainColorPicker=!1;#eventBus;#uiManager=null;static get _keyboardManager(){return(0,s.shadow)(this,"_keyboardManager",new a.KeyboardManager([[["Escape","mac+Escape"],r.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],r.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],r.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],r.prototype._moveToPrevious],[["Home","mac+Home"],r.prototype._moveToBeginning],[["End","mac+End"],r.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){this.#isMainColorPicker=!t,this.#uiManager=t?._uiManager||e,this.#eventBus=this.#uiManager._eventBus,this.#defaultColor=t?.color||this.#uiManager?.highlightColors.values().next().value||"#FFFF98"}renderButton(){var t=this.#button=document.createElement("button"),e=(t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0),t.addEventListener("click",this.#openDropdown.bind(this)),this.#buttonSwatch=document.createElement("span"));return e.className="swatch",e.style.backgroundColor=this.#defaultColor,t.append(e),t}renderMainDropdown(){var t=this.#dropdown=this.#getDropdownRoot(s.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR);return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}#getDropdownRoot(t){var e,i,s=document.createElement("div");s.addEventListener("contextmenu",n.noContextMenu),s.className="dropdown",s.role="listbox",s.setAttribute("aria-multiselectable",!1),s.setAttribute("aria-orientation","vertical"),s.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for([e,i]of this.#uiManager.highlightColors){var a=document.createElement("button"),r=(a.tabIndex="0",a.role="option",a.setAttribute("data-color",i),a.title=e,a.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-"+e),document.createElement("span"));a.append(r),r.className="swatch",r.style.backgroundColor=i,a.setAttribute("aria-selected",i===this.#defaultColor),a.addEventListener("click",this.#colorSelect.bind(this,t,i)),s.append(a)}return s.addEventListener("keydown",this.#boundKeyDown),s}#colorSelect(t,e,i){i.stopPropagation(),this.#eventBus.dispatch("switchannotationeditorparams",{source:this,type:t,value:e})}_colorSelectFromKeyboard(t){var e=t.target.getAttribute("data-color");e&&this.#colorSelect(e,t)}_moveToNext(t){(t.target===this.#button?this.#dropdown.firstChild:t.target.nextSibling)?.focus()}_moveToPrevious(t){t.target.previousSibling?.focus()}_moveToBeginning(){this.#dropdown.firstChild?.focus()}_moveToEnd(){this.#dropdown.lastChild?.focus()}#keyDown(t){r._keyboardManager.exec(this,t)}#openDropdown(t){this.#dropdown&&!this.#dropdown.classList.contains("hidden")?this.hideDropdown():(this.#button.addEventListener("keydown",this.#boundKeyDown),this.#dropdownWasFromKeyboard=0===t.detail,this.#dropdown?this.#dropdown.classList.remove("hidden"):(t=this.#dropdown=this.#getDropdownRoot(s.AnnotationEditorParamsType.HIGHLIGHT_COLOR),this.#button.append(t)))}hideDropdown(){this.#dropdown?.classList.add("hidden")}_hideDropdownFromKeyboard(){this.#isMainColorPicker||!this.#dropdown||this.#dropdown.classList.contains("hidden")||(this.hideDropdown(),this.#button.removeEventListener("keydown",this.#boundKeyDown),this.#button.focus({preventScroll:!0,focusVisible:this.#dropdownWasFromKeyboard}))}updateColor(t){if(this.#buttonSwatch&&(this.#buttonSwatch.style.backgroundColor=t),this.#dropdown){var e=this.#uiManager.highlightColors.values();for(const i of this.#dropdown.children)i.setAttribute("aria-selected",e.next().value===t)}}destroy(){this.#button?.remove(),this.#button=null,this.#buttonSwatch=null,this.#dropdown?.remove(),this.#dropdown=null}}},115:(t,e,i)=>{i.d(e,{AnnotationEditor:()=>C});var s=i(812),p=i(266),a=i(473);class r{#altText="";#altTextDecorative=!1;#altTextButton=null;#altTextTooltip=null;#altTextTooltipTimeout=null;#altTextWasFromKeyBoard=!1;#editor=null;static _l10nPromise=null;constructor(t){this.#editor=t}static initialize(t){r._l10nPromise||=t}async render(){const e=this.#altTextButton=document.createElement("button");e.className="altText";var t=await r._l10nPromise.get("pdfjs-editor-alt-text-button-label");e.textContent=t,e.setAttribute("aria-label",t),e.tabIndex="0",e.addEventListener("contextmenu",a.noContextMenu),e.addEventListener("pointerdown",t=>t.stopPropagation());const i=t=>{t.preventDefault(),this.#editor._uiManager.editAltText(this.#editor)};return e.addEventListener("click",i,{capture:!0}),e.addEventListener("keydown",t=>{t.target===e&&"Enter"===t.key&&(this.#altTextWasFromKeyBoard=!0,i(t))}),await this.#setState(),e}finish(){this.#altTextButton&&(this.#altTextButton.focus({focusVisible:this.#altTextWasFromKeyBoard}),this.#altTextWasFromKeyBoard=!1)}get data(){return{altText:this.#altText,decorative:this.#altTextDecorative}}set data({altText:t,decorative:e}){this.#altText===t&&this.#altTextDecorative===e||(this.#altText=t,this.#altTextDecorative=e,this.#setState())}toggle(t=!1){this.#altTextButton&&(!t&&this.#altTextTooltipTimeout&&(clearTimeout(this.#altTextTooltipTimeout),this.#altTextTooltipTimeout=null),this.#altTextButton.disabled=!t)}destroy(){this.#altTextButton?.remove(),this.#altTextButton=null,this.#altTextTooltip=null}async#setState(){const e=this.#altTextButton;if(e)if(this.#altText||this.#altTextDecorative){e.classList.add("done"),r._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(t=>{e.setAttribute("aria-label",t)});let t=this.#altTextTooltip;if(!t){this.#altTextTooltip=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip");var i=t.id="alt-text-tooltip-"+this.#editor.id;e.setAttribute("aria-describedby",i);e.addEventListener("mouseenter",()=>{this.#altTextTooltipTimeout=setTimeout(()=>{this.#altTextTooltipTimeout=null,this.#altTextTooltip.classList.add("show"),this.#editor._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.#editor.editorType,data:{action:"alt_text_tooltip"}}})},100)}),e.addEventListener("mouseleave",()=>{this.#altTextTooltipTimeout&&(clearTimeout(this.#altTextTooltipTimeout),this.#altTextTooltipTimeout=null),this.#altTextTooltip?.classList.remove("show")})}t.innerText=this.#altTextDecorative?await r._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#altText,t.parentNode||e.append(t),this.#editor.getImageForAltText()?.setAttribute("aria-describedby",t.id)}else e.classList.remove("done"),this.#altTextTooltip?.remove()}}class n{#toolbar=null;#colorPicker=null;#editor;#buttons=null;constructor(t){this.#editor=t}render(){var t,e,i=this.#toolbar=document.createElement("div"),s=(i.className="editToolbar",i.addEventListener("contextmenu",a.noContextMenu),i.addEventListener("pointerdown",n.#pointerDown),this.#buttons=document.createElement("div")),s=(s.className="buttons",i.append(s),this.#editor.toolbarPosition);return s&&(t=i["style"],e="ltr"===this.#editor._uiManager.direction?1-s[0]:s[0],t.insetInlineEnd=100*e+"%",t.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`),this.#addDeleteButton(),i}static#pointerDown(t){t.stopPropagation()}#focusIn(t){this.#editor._focusEventsAllowed=!1,t.preventDefault(),t.stopPropagation()}#focusOut(t){this.#editor._focusEventsAllowed=!0,t.preventDefault(),t.stopPropagation()}#addListenersToElement(t){t.addEventListener("focusin",this.#focusIn.bind(this),{capture:!0}),t.addEventListener("focusout",this.#focusOut.bind(this),{capture:!0}),t.addEventListener("contextmenu",a.noContextMenu)}hide(){this.#toolbar.classList.add("hidden"),this.#colorPicker?.hideDropdown()}show(){this.#toolbar.classList.remove("hidden")}#addDeleteButton(){var t=document.createElement("button");t.className="delete",t.tabIndex=0,t.setAttribute("data-l10n-id",`pdfjs-editor-remove-${this.#editor.editorType}-button`),this.#addListenersToElement(t),t.addEventListener("click",t=>{this.#editor._uiManager.delete()}),this.#buttons.append(t)}get#divider(){var t=document.createElement("div");return t.className="divider",t}addAltTextButton(t){this.#addListenersToElement(t),this.#buttons.prepend(t,this.#divider)}addColorPicker(t){t=(this.#colorPicker=t).renderButton();this.#addListenersToElement(t),this.#buttons.prepend(t,this.#divider)}remove(){this.#toolbar.remove(),this.#colorPicker?.destroy(),this.#colorPicker=null}}class C{#allResizerDivs=null;#altText=null;#keepAspectRatio=!1;#resizersDiv=null;#savedDimensions=null;#boundFocusin=this.focusin.bind(this);#boundFocusout=this.focusout.bind(this);#editToolbar=null;#focusedResizerName="";#hasBeenClicked=!1;#isEditing=!1;#isInEditMode=!1;#isResizerEnabledForKeyboard=!1;#moveInDOMTimeout=null;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#isDraggable=!1;#zIndex=C._zIndex++;static _borderLineWidth=-1;static _colorManager=new s.ColorManager;static _zIndex=1;static get _resizerKeyboardManager(){var t=C.prototype._resizeWithKeyboard,e=s.AnnotationEditorUIManager.TRANSLATE_SMALL,i=s.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,p.shadow)(this,"_resizerKeyboardManager",new s.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],C.prototype._stopResizingWithKeyboard]]))}constructor(t){this.constructor===C&&(0,p.unreachable)("Cannot initialize AnnotationEditor."),this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;var{rotation:e,rawDims:{pageWidth:i,pageHeight:s,pageX:a,pageY:r}}=this.parent.viewport,[e,i]=(this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[a,r],this.parentDimensions);this.x=t.x/e,this.y=t.y/i,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,p.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){var e=new o({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(e,t=null){if(C._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map(t=>[t,e.get(t.replaceAll(/([A-Z])/g,t=>"-"+t.toLowerCase()))])),t?.strings)for(const i of t.strings)C._l10nPromise.set(i,e.get(i));-1===C._borderLineWidth&&(t=getComputedStyle(document.documentElement),C._borderLineWidth=parseFloat(t.getPropertyValue("--outline-width"))||0)}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){(0,p.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#isDraggable}set _isDraggable(t){this.#isDraggable=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){var[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(2*t),this.y+=this.width*t/(2*e);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(2*t),this.y-=this.width*t/(2*e);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#zIndex}setParent(t){null!==t?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#stopResizing(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#hasBeenClicked?this.#hasBeenClicked=!1:this.parent.setSelected(this))}focusout(t){this._focusEventsAllowed&&this.isAttachedToDOM&&!t.relatedTarget?.closest("#"+this.id)&&(t.preventDefault(),!this.parent?.isMultipleSelection)&&this.commitOrRemove()}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,s){var[a,r]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(t+i)/a,this.y=(e+s)/r,this.fixAndSetPosition()}#translate([t,e],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/t,this.y+=s/e,this.fixAndSetPosition()}translate(t,e){this.#translate(this.parentDimensions,t,e)}translateInPage(t,e){this.#translate(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){var[i,s]=this.parentDimensions;if(this.x+=t/i,this.y+=e/s,this.parent&&(this.x<0||1<this.x||this.y<0||1<this.y)){const{x:a,y:r}=this.div.getBoundingClientRect();this.parent.findNewParent(this,a,r)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:r}=this;var[t,i]=this.#getBaseTranslation();a+=t,r+=i,this.div.style.left=(100*a).toFixed(2)+"%",this.div.style.top=(100*r).toFixed(2)+"%",this.div.scrollIntoView({block:"nearest"})}#getBaseTranslation(){var[t,e]=this.parentDimensions,i=C["_borderLineWidth"],s=i/t,a=i/e;switch(this.rotation){case 90:return[-s,a];case 180:return[s,a];case 270:return[s,-a];default:return[-s,-a]}}fixAndSetPosition(t=this.rotation){var[e,i]=this.pageDimensions;let{x:s,y:a,width:r,height:n}=this;switch(r*=e,n*=i,s*=e,a*=i,t){case 0:s=Math.max(0,Math.min(e-r,s)),a=Math.max(0,Math.min(i-n,a));break;case 90:s=Math.max(0,Math.min(e-n,s)),a=Math.min(i,Math.max(r,a));break;case 180:s=Math.min(e,Math.max(r,s)),a=Math.min(i,Math.max(n,a));break;case 270:s=Math.min(e,Math.max(n,s)),a=Math.max(0,Math.min(i-r,a))}this.x=s/=e,this.y=a/=i;var[t,o]=this.#getBaseTranslation(),t=(s+=t,a+=o,this.div)["style"];t.left=(100*s).toFixed(2)+"%",t.top=(100*a).toFixed(2)+"%",this.moveInDOM()}static#rotatePoint(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return C.#rotatePoint(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return C.#rotatePoint(t,e,360-this.parentRotation)}#getRotationMatrix(t){switch(t){case 90:var[e,i]=this.pageDimensions;return[0,-e/i,i/e,0];case 180:return[-1,0,0,-1];case 270:var[i,e]=this.pageDimensions;return[0,i/e,-e/i,0];default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){var{parentScale:t,pageDimensions:[e,i]}=this,e=e*t,i=i*t;return p.FeatureTest.isCSSRoundSupported?[Math.round(e),Math.round(i)]:[e,i]}setDims(t,e){var[i,s]=this.parentDimensions;this.div.style.width=(100*t/i).toFixed(2)+"%",this.#keepAspectRatio||(this.div.style.height=(100*e/s).toFixed(2)+"%")}fixDims(){var t,e,i=this.div["style"],{height:s,width:a}=i,r=a.endsWith("%"),n=!this.#keepAspectRatio&&s.endsWith("%");r&&n||([t,e]=this.parentDimensions,r||(i.width=(100*parseFloat(a)/t).toFixed(2)+"%"),this.#keepAspectRatio)||n||(i.height=(100*parseFloat(s)/e).toFixed(2)+"%")}getInitialTranslation(){return[0,0]}#createResizers(){if(!this.#resizersDiv){this.#resizersDiv=document.createElement("div"),this.#resizersDiv.classList.add("resizers");for(const e of this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"]){var t=document.createElement("div");this.#resizersDiv.append(t),t.classList.add("resizer",e),t.setAttribute("data-resizer-name",e),t.addEventListener("pointerdown",this.#resizerPointerdown.bind(this,e)),t.addEventListener("contextmenu",a.noContextMenu),t.tabIndex=-1}this.div.prepend(this.#resizersDiv)}}#resizerPointerdown(t,e){e.preventDefault();var i=p.FeatureTest.platform["isMac"];if(!(0!==e.button||e.ctrlKey&&i)){this.#altText?.toggle(!1);const s=this.#resizerPointermove.bind(this,t),a=this._isDraggable,r={passive:!(this._isDraggable=!1),capture:!0},n=(this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",s,r),this.x),o=this.y,l=this.width,h=this.height,d=this.parent.div.style.cursor,c=this.div.style.cursor,u=(this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor,()=>{this.parent.togglePointerEvents(!0),this.#altText?.toggle(!0),this._isDraggable=a,window.removeEventListener("pointerup",u),window.removeEventListener("blur",u),window.removeEventListener("pointermove",s,r),this.parent.div.style.cursor=d,this.div.style.cursor=c,this.#addResizeToUndoStack(n,o,l,h)});window.addEventListener("pointerup",u),window.addEventListener("blur",u)}}#addResizeToUndoStack(i,s,a,r){const n=this.x,o=this.y,l=this.width,h=this.height;n===i&&o===s&&l===a&&h===r||this.addCommands({cmd:()=>{this.width=l,this.height=h,this.x=n,this.y=o;var[t,e]=this.parentDimensions;this.setDims(t*l,e*h),this.fixAndSetPosition()},undo:()=>{this.width=a,this.height=r,this.x=i,this.y=s;var[t,e]=this.parentDimensions;this.setDims(t*a,e*r),this.fixAndSetPosition()},mustExec:!0})}#resizerPointermove(t,e){var[i,s]=this.parentDimensions,a=this.x,r=this.y,n=this.width,o=this.height,l=C.MIN_SIZE/i,h=C.MIN_SIZE/s,d=t=>Math.round(1e4*t)/1e4;const c=this.#getRotationMatrix(this.rotation);var u=(t,e)=>[c[0]*t+c[2]*e,c[1]*t+c[3]*e];const p=this.#getRotationMatrix(360-this.rotation);let g,m,f=!1,v=!1;switch(t){case"topLeft":f=!0,g=(t,e)=>[0,0],m=(t,e)=>[t,e];break;case"topMiddle":g=(t,e)=>[t/2,0],m=(t,e)=>[t/2,e];break;case"topRight":f=!0,g=(t,e)=>[t,0],m=(t,e)=>[0,e];break;case"middleRight":v=!0,g=(t,e)=>[t,e/2],m=(t,e)=>[0,e/2];break;case"bottomRight":f=!0,g=(t,e)=>[t,e],m=(t,e)=>[0,0];break;case"bottomMiddle":g=(t,e)=>[t/2,e],m=(t,e)=>[t/2,0];break;case"bottomLeft":f=!0,g=(t,e)=>[0,e],m=(t,e)=>[t,0];break;case"middleLeft":v=!0,g=(t,e)=>[0,e/2],m=(t,e)=>[t,e/2]}var t=g(n,o),b=m(n,o),_=u(...b),a=d(a+_[0]),r=d(r+_[1]);let A=1,y=1;var[e,w]=this.screenToPageTranslation(e.movementX,e.movementY),x=([e,w]=(E=e/i,x=w/s,[p[0]*E+p[2]*x,p[1]*E+p[3]*x]),f?(E=Math.hypot(n,o),A=y=Math.max(Math.min(Math.hypot(b[0]-t[0]-e,b[1]-t[1]-w)/E,1/n,1/o),l/n,h/o)):v?A=Math.max(l,Math.min(1,Math.abs(b[0]-t[0]-e)))/n:y=Math.max(h,Math.min(1,Math.abs(b[1]-t[1]-w)))/o,d(n*A)),E=d(o*y),l=a-(_=u(...m(x,E)))[0],e=r-_[1];this.width=x,this.height=E,this.x=l,this.y=e,this.setDims(i*x,s*E),this.fixAndSetPosition()}altTextFinish(){this.#altText?.finish()}async addEditToolbar(){return this.#editToolbar||this.#isInEditMode||(this.#editToolbar=new n(this),this.div.append(this.#editToolbar.render()),this.#altText&&this.#editToolbar.addAltTextButton(await this.#altText.render())),this.#editToolbar}removeEditToolbar(){this.#editToolbar&&(this.#editToolbar.remove(),this.#editToolbar=null,this.#altText?.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#altText||(r.initialize(C._l10nPromise),this.#altText=new r(this),await this.addEditToolbar())}get altTextData(){return this.#altText?.data}set altTextData(t){this.#altText&&(this.#altText.data=t)}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#boundFocusin),this.div.addEventListener("focusout",this.#boundFocusout);var[t,e]=this.parentDimensions,[t,e]=(this.parentRotation%180!=0&&(this.div.style.maxWidth=(100*e/t).toFixed(2)+"%",this.div.style.maxHeight=(100*t/e).toFixed(2)+"%"),this.getInitialTranslation());return this.translate(t,e),(0,s.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(t){var e=p.FeatureTest.platform["isMac"];0!==t.button||t.ctrlKey&&e?t.preventDefault():(this.#hasBeenClicked=!0,this._isDraggable?this.#setUpDragSession(t):this.#selectOnPointerEvent(t))}#selectOnPointerEvent(t){var e=p.FeatureTest.platform["isMac"];t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#setUpDragSession(t){const e=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let i,s;e&&(i={passive:!0,capture:!0},s=t=>{var[t,e]=this.screenToPageTranslation(t.movementX,t.movementY);this._uiManager.dragSelectedEditors(t,e)},window.addEventListener("pointermove",s,i));const a=()=>{window.removeEventListener("pointerup",a),window.removeEventListener("blur",a),e&&window.removeEventListener("pointermove",s,i),this.#hasBeenClicked=!1,this._uiManager.endDragSession()||this.#selectOnPointerEvent(t)};window.addEventListener("pointerup",a),window.addEventListener("blur",a)}moveInDOM(){this.#moveInDOMTimeout&&clearTimeout(this.#moveInDOMTimeout),this.#moveInDOMTimeout=setTimeout(()=>{this.#moveInDOMTimeout=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition()}getRect(t,e,i=this.rotation){var s=this.parentScale,[a,r]=this.pageDimensions,[n,o]=this.pageTranslation,l=t/s,h=e/s,d=this.x*a,c=this.y*r,u=this.width*a,p=this.height*r;switch(i){case 0:return[d+l+n,r-c-h-p+o,d+l+u+n,r-c-h+o];case 90:return[d+h+n,r-c+l+o,d+h+p+n,r-c+l+u+o];case 180:return[d-l-u+n,r-c+h+o,d-l+n,r-c+h+p+o];case 270:return[d-h-p+n,r-c-l-u+o,d-h+n,r-c-l+o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){var[i,s,a,r]=t,n=a-i,o=r-s;switch(this.rotation){case 0:return[i,e-r,n,o];case 90:return[i,e-s,o,n];case 180:return[a,e-s,n,o];case 270:return[a,e-r,o,n];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#isInEditMode=!0}disableEditMode(){this.#isInEditMode=!1}isInEditMode(){return this.#isInEditMode}shouldGetKeyboardEvents(){return this.#isResizerEnabledForKeyboard}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#boundFocusin),this.div?.addEventListener("focusout",this.#boundFocusout)}rotate(t){}serialize(t=0,e){(0,p.unreachable)("An editor must be serializable")}static deserialize(t,e,i){var e=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i}),[i,s]=(e.rotation=t.rotation,e.pageDimensions),[t,a,r,n]=e.getRectInCurrentCoords(t.rect,s);return e.x=t/i,e.y=a/s,e.width=r/i,e.height=n/s,e}remove(){this.div.removeEventListener("focusin",this.#boundFocusin),this.div.removeEventListener("focusout",this.#boundFocusout),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#moveInDOMTimeout&&(clearTimeout(this.#moveInDOMTimeout),this.#moveInDOMTimeout=null),this.#stopResizing(),this.removeEditToolbar()}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#createResizers(),this.#resizersDiv.classList.remove("hidden"),(0,s.bindEvents)(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(this.isResizable&&t.target===this.div&&"Enter"===t.key){this._uiManager.setSelected(this),this.#savedDimensions={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};var i=this.#resizersDiv.children;if(!this.#allResizerDivs){this.#allResizerDivs=Array.from(i);var s=this.#resizerKeydown.bind(this),a=this.#resizerBlur.bind(this);for(const h of this.#allResizerDivs){var r=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",s),h.addEventListener("blur",a),h.addEventListener("focus",this.#resizerFocus.bind(this,r)),C._l10nPromise.get("pdfjs-editor-resizer-label-"+r).then(t=>h.setAttribute("aria-label",t))}}var n=this.#allResizerDivs[0];let e=0;for(const d of i){if(d===n)break;e++}var o=(360-this.rotation+this.parentRotation)%360/90*(this.#allResizerDivs.length/4);if(o!==e){if(o<e)for(let t=0;t<e-o;t++)this.#resizersDiv.append(this.#resizersDiv.firstChild);else if(o>e)for(let t=0;t<o-e;t++)this.#resizersDiv.firstChild.before(this.#resizersDiv.lastChild);let t=0;for(const c of i){var l=this.#allResizerDivs[t++].getAttribute("data-resizer-name");C._l10nPromise.get("pdfjs-editor-resizer-label-"+l).then(t=>c.setAttribute("aria-label",t))}}this.#setResizerTabIndex(0),this.#isResizerEnabledForKeyboard=!0,this.#resizersDiv.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}}#resizerKeydown(t){C._resizerKeyboardManager.exec(this,t)}#resizerBlur(t){this.#isResizerEnabledForKeyboard&&t.relatedTarget?.parentNode!==this.#resizersDiv&&this.#stopResizing()}#resizerFocus(t){this.#focusedResizerName=this.#isResizerEnabledForKeyboard?t:""}#setResizerTabIndex(t){if(this.#allResizerDivs)for(const e of this.#allResizerDivs)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#isResizerEnabledForKeyboard&&this.#resizerPointermove(this.#focusedResizerName,{movementX:t,movementY:e})}#stopResizing(){var t,e,i,s;this.#isResizerEnabledForKeyboard=!1,this.#setResizerTabIndex(-1),this.#savedDimensions&&({savedX:t,savedY:e,savedWidth:i,savedHeight:s}=this.#savedDimensions,this.#addResizeToUndoStack(t,e,i,s),this.#savedDimensions=null)}_stopResizingWithKeyboard(){this.#stopResizing(),this.div.focus()}select(){this.makeResizable(),this.div?.classList.add("selectedEditor"),this.#editToolbar?this.#editToolbar?.show():this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this.#editToolbar?.show()})}unselect(){this.#resizersDiv?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus(),this.#editToolbar?.hide()}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#isEditing}set isEditing(t){this.#isEditing=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#keepAspectRatio=!0;var i=this.div["style"];i.aspectRatio=t/e,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}}class o extends C{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},405:(t,e,i)=>{i.d(e,{Outliner:()=>s});class s{#box;#verticalEdges=[];#intervals=[];constructor(t,e=0,i=0,s=!0){let a=1/0,r=-1/0,n=1/0,o=-1/0;var l,h,d,c,u=10**-4;for({x:l,y:h,width:d,height:c}of t){var p=Math.floor((l-e)/u)*u,g=Math.ceil((l+d+e)/u)*u,m=Math.floor((h-e)/u)*u,f=Math.ceil((h+c+e)/u)*u;this.#verticalEdges.push([p,m,f,!0],[g,m,f,!1]),a=Math.min(a,p),r=Math.max(r,g),n=Math.min(n,m),o=Math.max(o,f)}var v=r-a+2*i,b=o-n+2*i,_=a-i,A=n-i,t=this.#verticalEdges.at(s?-1:-2),i=[t[0],t[2]];for(const E of this.#verticalEdges){var[y,w,x]=E;E[0]=(y-_)/v,E[1]=(w-A)/b,E[2]=(x-A)/b}this.#box={x:_,y:A,width:v,height:b,lastPoint:i}}getOutlines(){this.#verticalEdges.sort((t,e)=>t[0]-e[0]||t[1]-e[1]||t[2]-e[2]);var t=[];for(const e of this.#verticalEdges)e[3]?(t.push(...this.#breakEdge(e)),this.#insert(e)):(this.#remove(e),t.push(...this.#breakEdge(e)));return this.#getOutlines(t)}#getOutlines(t){var i=[],l=new Set;for(const o of t){var[e,s,a]=o;i.push([e,s,o],[e,a,o])}i.sort((t,e)=>t[1]-e[1]||t[0]-e[0]);for(let t=0,e=i.length;t<e;t+=2){var r=i[t][2],n=i[t+1][2];r.push(n),n.push(r),l.add(r),l.add(n)}for(var h,d=[];0<l.size;){var c=l.values().next().value;let[e,i,s,a,r]=c,n=(l.delete(c),e),o=i;for(d.push(h=[e,s]);;){let t;if(l.has(a))t=a;else{if(!l.has(r))break;t=r}l.delete(t),[e,i,s,a,r]=t,n!==e&&(h.push(n,o,e,o===i?i:s),n=e),o=o===i?s:i}h.push(n,o)}return{outlines:d,box:this.#box}}#binarySearch(t){var e=this.#intervals;let i=0,s=e.length-1;for(;i<=s;){var a=i+s>>1,r=e[a][0];if(r===t)return a;r<t?i=1+a:s=a-1}return s+1}#insert([,t,e]){var i=this.#binarySearch(t);this.#intervals.splice(i,0,[t,e])}#remove([,e,i]){var s=this.#binarySearch(e);for(let t=s;t<this.#intervals.length;t++){var[a,r]=this.#intervals[t];if(a!==e)break;if(a===e&&r===i)return void this.#intervals.splice(t,1)}for(let t=s-1;0<=t;t--){var[n,o]=this.#intervals[t];if(n!==e)break;if(n===e&&o===i)return void this.#intervals.splice(t,1)}}#breakEdge(t){var[i,t,e]=t,s=[[i,t,e]],a=this.#binarySearch(e);for(let t=0;t<a;t++){var[r,n]=this.#intervals[t];for(let t=0,e=s.length;t<e;t++){var[,o,l]=s[t];if(!(n<=o||l<=r))if(r<=o)if(n<l)s[t][1]=n;else{if(1===e)return[];s.splice(t,1),t--,e--}else s[t][2]=r,n<l&&s.push([i,n,l])}}return s}}},812:(t,e,i)=>{i.d(e,{AnnotationEditorUIManager:()=>d,ColorManager:()=>n,KeyboardManager:()=>r,bindEvents:()=>function(t,e,i){for(const s of i)e.addEventListener(s,t[s].bind(t))},opacityToHex:()=>function(t){return Math.round(Math.min(255,Math.max(1,255*t))).toString(16).padStart(2,"0")}});var l=i(266),o=i(473);class s{#id=0;getId(){return""+l.AnnotationEditorPrefix+this.#id++}}class h{#baseId=(0,l.getUuid)();#id=0;#cache=null;static get _isSVGFittingCanvas(){const t=new OffscreenCanvas(1,3).getContext("2d"),e=new Image;e.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>';var i=e.decode().then(()=>(t.drawImage(e,0,0,1,1,0,0,1,3),0===new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0]));return(0,l.shadow)(this,"_isSVGFittingCanvas",i)}async#get(t,e){this.#cache||=new Map;let i=this.#cache.get(t);if(null===i)return null;if(i?.bitmap)i.refCounter+=1;else{try{i||={bitmap:null,id:`image_${this.#baseId}_`+this.#id++,refCounter:0,isSvg:!1};let t;if("image/svg+xml"===(t="string"==typeof e?(i.url=e,await(0,o.fetchData)(e,"blob")):i.file=e).type){const a=h._isSVGFittingCanvas,r=new FileReader,n=new Image;var s=new Promise((t,e)=>{n.onload=()=>{i.bitmap=n,i.isSvg=!0,t()},r.onload=async()=>{var t=i.svgUrl=r.result;n.src=await a?t+"#svgView(preserveAspectRatio(none))":t},n.onerror=r.onerror=e});r.readAsDataURL(t),await s}else i.bitmap=await createImageBitmap(t);i.refCounter=1}catch(t){console.error(t),i=null}this.#cache.set(t,i),i&&this.#cache.set(i.id,i)}return i}async getFromFile(t){var{lastModified:e,name:i,size:s,type:a}=t;return this.#get(e+`_${i}_${s}_`+a,t)}async getFromUrl(t){return this.#get(t,t)}async getFromId(t){this.#cache||=new Map;t=this.#cache.get(t);return t?t.bitmap?(t.refCounter+=1,t):t.file?this.getFromFile(t.file):this.getFromUrl(t.url):null}getSvgUrl(t){t=this.#cache.get(t);return t?.isSvg?t.svgUrl:null}deleteId(t){this.#cache||=new Map;t=this.#cache.get(t);t&&(--t.refCounter,0===t.refCounter)&&(t.bitmap=null)}isValidId(t){return t.startsWith(`image_${this.#baseId}_`)}}class a{#commands=[];#locked=!1;#maxSize;#position=-1;constructor(t=128){this.#maxSize=t}add({cmd:t,undo:e,mustExec:i,type:s=NaN,overwriteIfSameType:a=!1,keepUndo:r=!1}){i&&t(),this.#locked||(i={cmd:t,undo:e,type:s},-1===this.#position?(0<this.#commands.length&&(this.#commands.length=0),this.#position=0,this.#commands.push(i)):a&&this.#commands[this.#position].type===s?(r&&(i.undo=this.#commands[this.#position].undo),this.#commands[this.#position]=i):((t=this.#position+1)===this.#maxSize?this.#commands.splice(0,1):(this.#position=t)<this.#commands.length&&this.#commands.splice(t),this.#commands.push(i)))}undo(){-1!==this.#position&&(this.#locked=!0,this.#commands[this.#position].undo(),this.#locked=!1,--this.#position)}redo(){this.#position<this.#commands.length-1&&(this.#position+=1,this.#locked=!0,this.#commands[this.#position].cmd(),this.#locked=!1)}hasSomethingToUndo(){return-1!==this.#position}hasSomethingToRedo(){return this.#position<this.#commands.length-1}destroy(){this.#commands=null}}class r{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;var e,i,s,a=l.FeatureTest.platform["isMac"];for([e,i,s={}]of t)for(const n of e){var r=n.startsWith("mac+");a&&r?(this.callbacks.set(n.slice(4),{callback:i,options:s}),this.allKeys.add(n.split("+").at(-1))):a||r||(this.callbacks.set(n,{callback:i,options:s}),this.allKeys.add(n.split("+").at(-1)))}}#serialize(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);t=this.buffer.join("+");return this.buffer.length=0,t}exec(t,e){var i,s,a,r;this.allKeys.has(e.key)&&(i=this.callbacks.get(this.#serialize(e)))&&({callback:i,options:{bubbles:s=!1,args:a=[],checker:r=null}}=i,r&&!r(t,e)||(i.bind(t,...a,e)(),s)||(e.stopPropagation(),e.preventDefault()))}}class n{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){var t=new Map([["CanvasText",null],["Canvas",null]]);return(0,o.getColorValues)(t),(0,l.shadow)(this,"_colors",t)}convert(t){const i=(0,o.getRGB)(t);if(window.matchMedia("(forced-colors: active)").matches)for(var[e,s]of this._colors)if(s.every((t,e)=>t===i[e]))return n._colorsMapping.get(e);return i}getHexCode(t){var e=this._colors.get(t);return e?l.Util.makeHexColor(...e):t}}class d{#activeEditor=null;#allEditors=new Map;#allLayers=new Map;#altTextManager=null;#annotationStorage=null;#commandManager=new a;#currentPageIndex=0;#deletedAnnotationsElementIds=new Set;#draggingEditors=null;#editorTypes=null;#editorsToRescale=new Set;#filterFactory=null;#focusMainContainerTimeoutId=null;#highlightColors=null;#idManager=new s;#isEnabled=!1;#isWaiting=!1;#lastActiveElement=null;#mainHighlightColorPicker=null;#mode=l.AnnotationEditorType.NONE;#selectedEditors=new Set;#pageColors=null;#boundBlur=this.blur.bind(this);#boundFocus=this.focus.bind(this);#boundCopy=this.copy.bind(this);#boundCut=this.cut.bind(this);#boundPaste=this.paste.bind(this);#boundKeydown=this.keydown.bind(this);#boundOnEditingAction=this.onEditingAction.bind(this);#boundOnPageChanging=this.onPageChanging.bind(this);#boundOnScaleChanging=this.onScaleChanging.bind(this);#boundOnRotationChanging=this.onRotationChanging.bind(this);#previousStates={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#translation=[0,0];#translationTimeoutId=null;#container=null;#viewer=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){var t=d.prototype,e=t=>t.#container.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&t.hasSomethingToControl(),i=(t,{target:e})=>{return!(e instanceof HTMLInputElement)||(e=e["type"],"text"!==e&&"number"!==e)},s=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return(0,l.shadow)(this,"_keyboardManager",new r([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(t,{target:e})=>!(e instanceof HTMLButtonElement)&&t.#container.contains(e)&&!t.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:t=>t.#container.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-a,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[a,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-a],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,a],checker:e}]]))}constructor(t,e,i,s,a,r,n){this.#container=t,this.#viewer=e,this.#altTextManager=i,this._eventBus=s,this._eventBus._on("editingaction",this.#boundOnEditingAction),this._eventBus._on("pagechanging",this.#boundOnPageChanging),this._eventBus._on("scalechanging",this.#boundOnScaleChanging),this._eventBus._on("rotationchanging",this.#boundOnRotationChanging),this.#annotationStorage=a.annotationStorage,this.#filterFactory=a.filterFactory,this.#pageColors=r,this.#highlightColors=n||null,this.viewParameters={realScale:o.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#removeKeyboardManager(),this.#removeFocusManager(),this._eventBus._off("editingaction",this.#boundOnEditingAction),this._eventBus._off("pagechanging",this.#boundOnPageChanging),this._eventBus._off("scalechanging",this.#boundOnScaleChanging),this._eventBus._off("rotationchanging",this.#boundOnRotationChanging);for(const t of this.#allLayers.values())t.destroy();this.#allLayers.clear(),this.#allEditors.clear(),this.#editorsToRescale.clear(),this.#activeEditor=null,this.#selectedEditors.clear(),this.#commandManager.destroy(),this.#altTextManager?.destroy(),this.#focusMainContainerTimeoutId&&(clearTimeout(this.#focusMainContainerTimeoutId),this.#focusMainContainerTimeoutId=null),this.#translationTimeoutId&&(clearTimeout(this.#translationTimeoutId),this.#translationTimeoutId=null)}get hcmFilter(){return(0,l.shadow)(this,"hcmFilter",this.#pageColors?this.#filterFactory.addHCMFilter(this.#pageColors.foreground,this.#pageColors.background):"none")}get direction(){return(0,l.shadow)(this,"direction",getComputedStyle(this.#container).direction)}get highlightColors(){return(0,l.shadow)(this,"highlightColors",this.#highlightColors?new Map(this.#highlightColors.split(",").map(t=>t.split("=").map(t=>t.trim()))):null)}setMainHighlightColorPicker(t){this.#mainHighlightColorPicker=t}editAltText(t){this.#altTextManager?.editAltText(this,t)}onPageChanging({pageNumber:t}){this.#currentPageIndex=t-1}focusMainContainer(){this.#container.focus()}findParent(t,e){for(const n of this.#allLayers.values()){var{x:i,y:s,width:a,height:r}=n.div.getBoundingClientRect();if(i<=t&&t<=i+a&&s<=e&&e<=s+r)return n}return null}disableUserSelect(t=!1){this.#viewer.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#editorsToRescale.add(t)}removeShouldRescale(t){this.#editorsToRescale.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*o.PixelsPerInch.PDF_TO_CSS_UNITS;for(const e of this.#editorsToRescale)e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}addToAnnotationStorage(t){t.isEmpty()||!this.#annotationStorage||this.#annotationStorage.has(t.id)||this.#annotationStorage.setValue(t.id,t)}#addFocusManager(){window.addEventListener("focus",this.#boundFocus),window.addEventListener("blur",this.#boundBlur)}#removeFocusManager(){window.removeEventListener("focus",this.#boundFocus),window.removeEventListener("blur",this.#boundBlur)}blur(){if(this.hasSelection){var t=document["activeElement"];for(const e of this.#selectedEditors)if(e.div.contains(t)){this.#lastActiveElement=[e,t],e._focusEventsAllowed=!1;break}}}focus(){if(this.#lastActiveElement){const[t,e]=this.#lastActiveElement;this.#lastActiveElement=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0}),e.focus()}}#addKeyboardManager(){window.addEventListener("keydown",this.#boundKeydown)}#removeKeyboardManager(){window.removeEventListener("keydown",this.#boundKeydown)}#addCopyPasteListeners(){document.addEventListener("copy",this.#boundCopy),document.addEventListener("cut",this.#boundCut),document.addEventListener("paste",this.#boundPaste)}#removeCopyPasteListeners(){document.removeEventListener("copy",this.#boundCopy),document.removeEventListener("cut",this.#boundCut),document.removeEventListener("paste",this.#boundPaste)}addEditListeners(){this.#addKeyboardManager(),this.#addCopyPasteListeners()}removeEditListeners(){this.#removeKeyboardManager(),this.#removeCopyPasteListeners()}copy(t){if(t.preventDefault(),this.#activeEditor?.commitOrRemove(),this.hasSelection){var e=[];for(const s of this.#selectedEditors){var i=s.serialize(!0);i&&e.push(i)}0!==e.length&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}}cut(t){this.copy(t),this.delete()}paste(t){t.preventDefault();t=t.clipboardData;for(const a of t.items)for(const r of this.#editorTypes)if(r.isHandlingMimeForPasting(a.type))return void r.paste(a,this.currentLayer);let e=t.getData("application/pdfjs");if(e){try{e=JSON.parse(e)}catch(t){return void(0,l.warn)(`paste: "${t.message}".`)}if(Array.isArray(e)){this.unselectAll();var i=this.currentLayer;try{const n=[];for(const o of e){var s=i.deserialize(o);if(!s)return;n.push(s)}this.addCommands({cmd:()=>{for(const t of n)this.#addEditorToLayer(t);this.#selectEditors(n)},undo:()=>{for(const t of n)t.remove()},mustExec:!0})}catch(t){(0,l.warn)(`paste: "${t.message}".`)}}}}keydown(t){this.isEditorHandlingKeyboard||d._keyboardManager.exec(this,t)}onEditingAction(t){["undo","redo","delete","selectAll"].includes(t.name)&&this[t.name]()}#dispatchUpdateStates(t){Object.entries(t).some(([t,e])=>this.#previousStates[t]!==e)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#previousStates,t)})}#dispatchUpdateUI(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#addFocusManager(),this.#addKeyboardManager(),this.#addCopyPasteListeners(),this.#dispatchUpdateStates({isEditing:this.#mode!==l.AnnotationEditorType.NONE,isEmpty:this.#isEmpty(),hasSomethingToUndo:this.#commandManager.hasSomethingToUndo(),hasSomethingToRedo:this.#commandManager.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#removeFocusManager(),this.#removeKeyboardManager(),this.#removeCopyPasteListeners(),this.#dispatchUpdateStates({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#editorTypes){this.#editorTypes=t;for(const e of this.#editorTypes)this.#dispatchUpdateUI(e.defaultPropertiesToUpdate)}}getId(){return this.#idManager.getId()}get currentLayer(){return this.#allLayers.get(this.#currentPageIndex)}getLayer(t){return this.#allLayers.get(t)}get currentPageIndex(){return this.#currentPageIndex}addLayer(t){this.#allLayers.set(t.pageIndex,t),this.#isEnabled?t.enable():t.disable()}removeLayer(t){this.#allLayers.delete(t.pageIndex)}updateMode(t,e=null,i=!1){if(this.#mode!==t)if((this.#mode=t)===l.AnnotationEditorType.NONE)this.setEditingState(!1),this.#disableAll();else{this.setEditingState(!0),this.#enableAll(),this.unselectAll();for(const s of this.#allLayers.values())s.updateMode(t);if(!e&&i)this.addNewEditorFromKeyboard();else if(e)for(const a of this.#allEditors.values())if(a.annotationElementId===e){this.setSelected(a),a.enterInEditMode();break}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==this.#mode&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){if(this.#editorTypes){switch(t){case l.AnnotationEditorParamsType.CREATE:return void this.currentLayer.addNewEditor();case l.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:this.#mainHighlightColorPicker?.updateColor(e)}for(const i of this.#selectedEditors)i.updateParams(t,e);for(const s of this.#editorTypes)s.updateDefaultParams(t,e)}}enableWaiting(t=!1){if(this.#isWaiting!==t){this.#isWaiting=t;for(const e of this.#allLayers.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}#enableAll(){if(!this.#isEnabled){this.#isEnabled=!0;for(const t of this.#allLayers.values())t.enable()}}#disableAll(){if(this.unselectAll(),this.#isEnabled){this.#isEnabled=!1;for(const t of this.#allLayers.values())t.disable()}}getEditors(t){var e=[];for(const i of this.#allEditors.values())i.pageIndex===t&&e.push(i);return e}getEditor(t){return this.#allEditors.get(t)}addEditor(t){this.#allEditors.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#focusMainContainerTimeoutId&&clearTimeout(this.#focusMainContainerTimeoutId),this.#focusMainContainerTimeoutId=setTimeout(()=>{this.focusMainContainer(),this.#focusMainContainerTimeoutId=null},0)),this.#allEditors.delete(t.id),this.unselect(t),t.annotationElementId&&this.#deletedAnnotationsElementIds.has(t.annotationElementId)||this.#annotationStorage?.remove(t.id)}addDeletedAnnotationElement(t){this.#deletedAnnotationsElementIds.add(t.annotationElementId),t.deleted=!0}isDeletedAnnotationElement(t){return this.#deletedAnnotationsElementIds.has(t)}removeDeletedAnnotationElement(t){this.#deletedAnnotationsElementIds.delete(t.annotationElementId),t.deleted=!1}#addEditorToLayer(t){var e=this.#allLayers.get(t.pageIndex);e?e.addOrRebuild(t):this.addEditor(t)}setActiveEditor(t){this.#activeEditor!==t&&(this.#activeEditor=t)&&this.#dispatchUpdateUI(t.propertiesToUpdate)}toggleSelected(t){this.#selectedEditors.has(t)?(this.#selectedEditors.delete(t),t.unselect(),this.#dispatchUpdateStates({hasSelectedEditor:this.hasSelection})):(this.#selectedEditors.add(t),t.select(),this.#dispatchUpdateUI(t.propertiesToUpdate),this.#dispatchUpdateStates({hasSelectedEditor:!0}))}setSelected(t){for(const e of this.#selectedEditors)e!==t&&e.unselect();this.#selectedEditors.clear(),this.#selectedEditors.add(t),t.select(),this.#dispatchUpdateUI(t.propertiesToUpdate),this.#dispatchUpdateStates({hasSelectedEditor:!0})}isSelected(t){return this.#selectedEditors.has(t)}get firstSelectedEditor(){return this.#selectedEditors.values().next().value}unselect(t){t.unselect(),this.#selectedEditors.delete(t),this.#dispatchUpdateStates({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#selectedEditors.size}get isEnterHandled(){return 1===this.#selectedEditors.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#commandManager.undo(),this.#dispatchUpdateStates({hasSomethingToUndo:this.#commandManager.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#isEmpty()})}redo(){this.#commandManager.redo(),this.#dispatchUpdateStates({hasSomethingToUndo:!0,hasSomethingToRedo:this.#commandManager.hasSomethingToRedo(),isEmpty:this.#isEmpty()})}addCommands(t){this.#commandManager.add(t),this.#dispatchUpdateStates({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#isEmpty()})}#isEmpty(){if(0===this.#allEditors.size)return!0;if(1===this.#allEditors.size)for(const t of this.#allEditors.values())return t.isEmpty();return!1}delete(){if(this.commitOrRemove(),this.hasSelection){const e=[...this.#selectedEditors];this.addCommands({cmd:()=>{for(const t of e)t.remove()},undo:()=>{for(const t of e)this.#addEditorToLayer(t)},mustExec:!0})}}commitOrRemove(){this.#activeEditor?.commitOrRemove()}hasSomethingToControl(){return this.#activeEditor||this.hasSelection}#selectEditors(t){this.#selectedEditors.clear();for(const e of t)e.isEmpty()||(this.#selectedEditors.add(e),e.select());this.#dispatchUpdateStates({hasSelectedEditor:!0})}selectAll(){for(const t of this.#selectedEditors)t.commit();this.#selectEditors(this.#allEditors.values())}unselectAll(){if((!this.#activeEditor||(this.#activeEditor.commitOrRemove(),this.#mode===l.AnnotationEditorType.NONE))&&this.hasSelection){for(const t of this.#selectedEditors)t.unselect();this.#selectedEditors.clear(),this.#dispatchUpdateStates({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,i=!1){if(i||this.commitOrRemove(),this.hasSelection){this.#translation[0]+=t,this.#translation[1]+=e;const[s,a]=this.#translation,r=[...this.#selectedEditors];this.#translationTimeoutId&&clearTimeout(this.#translationTimeoutId),this.#translationTimeoutId=setTimeout(()=>{this.#translationTimeoutId=null,this.#translation[0]=this.#translation[1]=0,this.addCommands({cmd:()=>{for(const t of r)this.#allEditors.has(t.id)&&t.translateInPage(s,a)},undo:()=>{for(const t of r)this.#allEditors.has(t.id)&&t.translateInPage(-s,-a)},mustExec:!1})},1e3);for(const n of r)n.translateInPage(t,e)}}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#draggingEditors=new Map;for(const t of this.#selectedEditors)this.#draggingEditors.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#draggingEditors)return!1;this.disableUserSelect(!1);const a=this.#draggingEditors;this.#draggingEditors=null;let t=!1;for(var[{x:e,y:i,pageIndex:s},r]of a)r.newX=e,r.newY=i,r.newPageIndex=s,t||=e!==r.savedX||i!==r.savedY||s!==r.savedPageIndex;if(!t)return!1;const n=(t,e,i,s)=>{var a;this.#allEditors.has(t.id)&&((a=this.#allLayers.get(s))?t._setParentAndPosition(a,e,i):(t.pageIndex=s,t.x=e,t.y=i))};return this.addCommands({cmd:()=>{for(var[t,{newX:e,newY:i,newPageIndex:s}]of a)n(t,e,i,s)},undo:()=>{for(var[t,{savedX:e,savedY:i,savedPageIndex:s}]of a)n(t,e,i,s)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#draggingEditors)for(const i of this.#draggingEditors.keys())i.drag(t,e)}rebuild(t){var e;null===t.parent?(e=this.getLayer(t.pageIndex))?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild()):t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#selectedEditors.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#activeEditor===t}getActive(){return this.#activeEditor}getMode(){return this.#mode}get imageManager(){return(0,l.shadow)(this,"imageManager",new h)}}},171:(t,e,i)=>{i.d(e,{PDFFetchStream:()=>a});var r=i(266),n=i(253);function o(t,e,i){return{method:"GET",headers:t,signal:i.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function l(t){var e=new Headers;for(const s in t){var i=t[s];void 0!==i&&e.append(s,i)}return e}function s(t){return t instanceof Uint8Array?t.buffer:t instanceof ArrayBuffer?t:((0,r.warn)("getArrayBuffer - unexpected data format: "+t),new Uint8Array(t).buffer)}class a{constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.httpHeaders=this.isHttp&&t.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new h(this),this._fullRequestReader}getRangeReader(t,e){return e<=this._progressiveDataLength?null:(t=new d(this,t,e),this._rangeRequestReaders.push(t),t)}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class h{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;t=t.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=new r.PromiseCapability,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=l(this._stream.httpHeaders);const a=t.url;fetch(a,o(this._headers,this._withCredentials,this._abortController)).then(e=>{if(!(0,n.validateResponseStatus)(e.status))throw(0,n.createResponseStatusError)(e.status,a);this._reader=e.body.getReader(),this._headersCapability.resolve();var t=t=>e.headers.get(t),{allowRangeRequests:i,suggestedLength:s}=(0,n.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=i,this._contentLength=s||this._contentLength,this._filename=(0,n.extractFilenameFromHeader)(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new r.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;var{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:s(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class d{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;t=t.source;this._withCredentials=t.withCredentials||!1,this._readCapability=new r.PromiseCapability,this._isStreamingSupported=!t.disableStream,this._abortController=new AbortController,this._headers=l(this._stream.httpHeaders),this._headers.append("Range",`bytes=${e}-`+(i-1));const s=t.url;fetch(s,o(this._headers,this._withCredentials,this._abortController)).then(t=>{if(!(0,n.validateResponseStatus)(t.status))throw(0,n.createResponseStatusError)(t.status,s);this._readCapability.resolve(),this._reader=t.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;var{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:s(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}},742:(t,e,i)=>{i.d(e,{FontFaceObject:()=>a,FontLoader:()=>s});var m=i(266);class s{#systemFonts=new Set;constructor({ownerDocument:t=globalThis.document}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));var e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#systemFonts.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,_inspectFont:e}){if(t&&!this.#systemFonts.has(t.loadedName))if((0,m.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){var{loadedName:i,src:s,style:a}=t,s=new FontFace(i,s,a);this.addNativeFontFace(s);try{await s.load(),this.#systemFonts.add(i),e?.(t)}catch{(0,m.warn)(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(s)}}else(0,m.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}async bind(e){if(!(e.attached||e.missingFile&&!e.systemFontInfo))if(e.attached=!0,e.systemFontInfo)await this.loadSystemFont(e);else if(this.isFontLoadingAPISupported){var i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(t){throw(0,m.warn)(`Failed to load font '${i.family}': '${t}'.`),e.disableFontFace=!0,t}}}else{i=e.createFontFaceRule();i&&(this.insertRule(i),this.isSyncFontLoadingSupported||await new Promise(t=>{t=this._queueLoadingCallback(t);this._prepareFontLoadEvent(e,t)}))}}get isFontLoadingAPISupported(){var t=!!this._document?.fonts;return(0,m.shadow)(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=!1;return(m.isNodeJS||"undefined"!=typeof navigator&&"string"==typeof navigator?.userAgent&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),(0,m.shadow)(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){const e=this["loadingRequests"],i={done:!1,complete:function(){for((0,m.assert)(!i.done,"completeRequest() cannot be called twice."),i.done=!0;0<e.length&&e[0].done;){var t=e.shift();setTimeout(t.callback,0)}},callback:t};return e.push(i),i}get _loadTestFont(){var t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,m.shadow)(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|255&t.charCodeAt(e+3)}function s(t,e,i,s){return t.substring(0,e)+s+t.substring(e+i)}let a,r;var n=this._document.createElement("canvas");n.width=1,n.height=1;const o=n.getContext("2d");let l=0;function h(t,e){30<++l?((0,m.warn)("Load test font never loaded."),e()):(o.font="30px "+t,o.fillText(".",0,20),0<o.getImageData(0,0,1,1).data[3]?e():setTimeout(h.bind(null,t,e)))}var d="lt"+Date.now()+this.loadTestFontId++;let c=i(n=s(this._loadTestFont,976,d.length,d),16);for(a=0,r=d.length-3;a<r;a+=4)c=c-1482184792+i(d,a)|0;a<d.length&&(c=c-1482184792+i(d+"XXX",a)|0),n=s(n,16,4,(0,m.string32)(c));n=`url(data:font/opentype;base64,${btoa(n)});`;this.insertRule(`@font-face {font-family:"${d}";src:${n}}`);const u=this._document.createElement("div");u.style.visibility="hidden",u.style.width=u.style.height="10px",u.style.position="absolute",u.style.top=u.style.left="0px";for(const g of[t.loadedName,d]){var p=this._document.createElement("span");p.textContent="Hi",p.style.fontFamily=g,u.append(p)}this._document.body.append(u),h(d,()=>{u.remove(),e.complete()})}}class a{constructor(t,{isEvalSupported:e=!0,disableFontFace:i=!1,ignoreErrors:s=!1,inspectFont:a=null}){this.compiledGlyphs=Object.create(null);for(const r in t)this[r]=t[r];this.isEvalSupported=!1!==e,this.disableFontFace=!0===i,this.ignoreErrors=!0===s,this._inspectFont=a}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;var e;return t=this.cssFontInfo?(e={weight:this.cssFontInfo.fontWeight},this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),new FontFace(this.cssFontInfo.fontFamily,this.data,e)):new FontFace(this.loadedName,this.data,{}),this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;var e=(0,m.bytesToString)(this.data),e=`url(data:${this.mimetype};base64,${btoa(e)});`;let i;if(this.cssFontInfo){let t=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(t+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),i=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${t}src:${e}}`}else i=`@font-face {font-family:"${this.loadedName}";src:${e}}`;return this._inspectFont?.(this,e),i}getPathGenerator(t,e){if(void 0!==this.compiledGlyphs[e])return this.compiledGlyphs[e];let s;try{s=t.get(this.loadedName+"_path_"+e)}catch(t){if(this.ignoreErrors)return(0,m.warn)(`getPathGenerator - ignoring character: "${t}".`),this.compiledGlyphs[e]=function(t,e){};throw t}if(this.isEvalSupported&&m.FeatureTest.isEvalSupported){var i=[];for(const r of s){var a=void 0!==r.args?r.args.join(","):"";i.push("c.",r.cmd,"(",a,");\n")}return this.compiledGlyphs[e]=new Function("c","size",i.join(""))}return this.compiledGlyphs[e]=function(t,e){for(const i of s)"scale"===i.cmd&&(i.args=[e,-e]),t[i.cmd].apply(t,i.args)}}}},472:(t,e,i)=>{i.d(e,{Metadata:()=>a});var s=i(266);class a{#metadataMap;#data;constructor({parsedData:t,rawData:e}){this.#metadataMap=t,this.#data=e}getRaw(){return this.#data}get(t){return this.#metadataMap.get(t)??null}getAll(){return(0,s.objectFromMap)(this.#metadataMap)}has(t){return this.#metadataMap.has(t)}}},474:(t,e,i)=>{i.d(e,{PDFNetworkStream:()=>o});var s=i(266),r=i(253);function n(t){t=t.response;return"string"!=typeof t?t:(0,s.stringToBytes)(t).buffer}class a{constructor(t,e={}){this.url=t,this.isHttp=/^https?:/i.test(t),this.httpHeaders=this.isHttp&&e.httpHeaders||Object.create(null),this.withCredentials=e.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(t,e,i){var s={begin:t,end:e};for(const a in i)s[a]=i[a];return this.request(s)}requestFull(t){return this.request(t)}request(e){const i=new XMLHttpRequest;var t=this.currXhrId++,s=this.pendingRequests[t]={xhr:i};i.open("GET",this.url),i.withCredentials=this.withCredentials;for(const r in this.httpHeaders){var a=this.httpHeaders[r];void 0!==a&&i.setRequestHeader(r,a)}return this.isHttp&&"begin"in e&&"end"in e?(i.setRequestHeader("Range",`bytes=${e.begin}-`+(e.end-1)),s.expectedStatus=206):s.expectedStatus=200,i.responseType="arraybuffer",e.onError&&(i.onerror=function(t){e.onError(i.status)}),i.onreadystatechange=this.onStateChange.bind(this,t),i.onprogress=this.onProgress.bind(this,t),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,i.send(null),t}onProgress(t,e){t=this.pendingRequests[t];t&&t.onProgress?.(e)}onStateChange(t,e){var i,s,a=this.pendingRequests[t];a&&(2<=(i=a.xhr).readyState&&a.onHeadersReceived&&(a.onHeadersReceived(),delete a.onHeadersReceived),4===i.readyState)&&t in this.pendingRequests&&(delete this.pendingRequests[t],(0!==i.status||!this.isHttp)&&(200===(t=i.status||200)&&206===a.expectedStatus||t===a.expectedStatus)?(s=n(i),206===t?(t=i.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(t),a.onDone({begin:parseInt(t[1],10),chunk:s})):s?a.onDone({begin:0,chunk:s}):a.onError?.(i.status)):a.onError?.(i.status))}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){var e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class o{constructor(t){this._source=t,this._manager=new a(t.url,{httpHeaders:t.httpHeaders,withCredentials:t.withCredentials}),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){t=this._rangeRequestReaders.indexOf(t);0<=t&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return(0,s.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new l(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){t=new h(this._manager,t,e);return t.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(t),t}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class l{constructor(t,e){this._manager=t;var i={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._fullRequestId=t.requestFull(i),this._headersReceivedCapability=new s.PromiseCapability,this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){var t=this._fullRequestId;const e=this._manager.getRequestXhr(t);var i=t=>e.getResponseHeader(t),{allowRangeRequests:s,suggestedLength:a}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersReceivedCapability.resolve()}_onDone(t){if(t&&(0<this._requests.length?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(0<this._cachedChunks.length)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=(0,r.createResponseStatusError)(t,this._url),this._headersReceivedCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;var t;return 0<this._cachedChunks.length?{value:this._cachedChunks.shift(),done:!1}:this._done?{value:void 0,done:!0}:(t=new s.PromiseCapability,this._requests.push(t),t.promise)}cancel(t){this._done=!0,this._headersReceivedCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class h{constructor(t,e,i){this._manager=t;var s={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._requestId=t.requestRange(e,i,s),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(t){t=t.chunk;0<this._requests.length?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError=(0,r.createResponseStatusError)(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;var t;return null!==this._queuedChunk?(t=this._queuedChunk,this._queuedChunk=null,{value:t,done:!1}):this._done?{value:void 0,done:!0}:(t=new s.PromiseCapability,this._requests.push(t),t.promise)}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},253:(t,e,i)=>{i.d(e,{createResponseStatusError:()=>function(t,e){if(404===t||0===t&&e.startsWith("file:"))return new d.MissingPDFException('Missing PDF "'+e+'".');return new d.UnexpectedResponseException(`Unexpected server response (${t}) while retrieving PDF "${e}".`,t)},extractFilenameFromHeader:()=>function(e){e=e("Content-Disposition");if(e){let t=function(t){let a=!0,e=o("filename\\*","i").exec(t);{var i;if(e)return i=l(e=e[1]),s(i=n(i=h(i=unescape(i))))}if(e=function(t){var s=[];var e=o("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(i=e.exec(t));){var[,i,a,r]=i;if((i=parseInt(i,10))in s){if(0===i)break}else s[i]=[a,r]}var n=[];for(let i=0;i<s.length&&i in s;++i){let[t,e]=s[i];e=l(e),t&&(e=unescape(e),0===i)&&(e=h(e)),n.push(e)}return n.join("")}(t))return s(n(e));if(e=o("filename","i").exec(t))return e=e[1],s(n(l(e)));function o(t,e){return new RegExp("(?:^|;)\\s*"+t+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',e)}function r(t,e){if(t){if(!/^[\x00-\xFF]+$/.test(e))return e;try{var i=new TextDecoder(t,{fatal:!0}),s=(0,d.stringToBytes)(e);e=i.decode(s),a=!1}catch{}}return e}function s(t){return t=a&&/[\x80-\xff]/.test(t)&&(t=r("utf-8",t),a)?r("iso-8859-1",t):t}function l(t){if(t.startsWith('"')){var e=t.slice(1).split('\\"');for(let t=0;t<e.length;++t){var i=e[t].indexOf('"');-1!==i&&(e[t]=e[t].slice(0,i),e.length=t+1),e[t]=e[t].replaceAll(/\\(.)/g,"$1")}t=e.join('"')}return t}function h(t){var e=t.indexOf("'");return-1===e?t:r(t.slice(0,e),t.slice(e+1).replace(/^[^']*'/,""))}function n(t){return!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)?t:t.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(t,e,i,s){if("q"===i||"Q"===i)return r(e,s=(s=s.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(t,e){return String.fromCharCode(parseInt(e,16))}));try{s=atob(s)}catch{}return r(e,s)})}return""}(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if((0,s.isPdfFile)(t))return t}return null},validateRangeRequestCapabilities:()=>function({getResponseHeader:t,isHttp:e,rangeChunkSize:i,disableRange:s}){var a={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(t("Content-Length"),10);return!Number.isInteger(r)||(a.suggestedLength=r)<=2*i||!s&&e&&"bytes"===t("Accept-Ranges")&&"identity"===(t("Content-Encoding")||"identity")&&(a.allowRangeRequests=!0),a},validateResponseStatus:()=>function(t){return 200===t||206===t}});var d=i(266);var s=i(473)},498:(t,b,_)=>{_.a(t,async(t,e)=>{try{_.d(b,{PDFNodeStream:()=>c});var o=_(266),l=_(253);let a,r,n,i;o.isNodeJS&&(a=await import("fs"),r=await import("http"),n=await import("https"),i=await import("url"));const d=/^file:\/\/\/[a-zA-Z]:\//;function s(t){var e=i.parse(t);if("file:"!==e.protocol&&!e.host){if(/^[a-z]:[/\\]/i.test(t))return i.parse("file:///"+t);e.host||(e.protocol="file:")}return e}class c{constructor(t){this.source=t,this.url=s(t.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&t.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,o.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new(this.isFsUrl?f:g)(this),this._fullRequestReader}getRangeReader(t,e){return e<=this._progressiveDataLength?null:(t=new(this.isFsUrl?v:m)(this,t,e),this._rangeRequestReaders.push(t),t)}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class u{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;t=t.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=new o.PromiseCapability,this._headersCapability=new o.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;var t=this._readableStream.read();return null===t?(this._readCapability=new o.PromiseCapability,this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){(this._readableStream=t).on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new o.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class p{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new o.PromiseCapability;t=t.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;var t=this._readableStream.read();return null===t?(this._readCapability=new o.PromiseCapability,this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){(this._readableStream=t).on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function h(t,e){return{protocol:t.protocol,auth:t.auth,host:t.hostname,port:t.port,path:t.path,method:"GET",headers:e}}class g extends u{constructor(s){super(s);var t=t=>{var e,i;404===t.statusCode?(e=new o.MissingPDFException(`Missing PDF "${this._url}".`),this._storedError=e,this._headersCapability.reject(e)):(this._headersCapability.resolve(),this._setReadableStream(t),{allowRangeRequests:t,suggestedLength:i}=(0,l.validateRangeRequestCapabilities)({getResponseHeader:e=t=>this._readableStream.headers[t.toLowerCase()],isHttp:s.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange}),this._isRangeSupported=t,this._contentLength=i||this._contentLength,this._filename=(0,l.extractFilenameFromHeader)(e))};this._request=null,"http:"===this._url.protocol?this._request=r.request(h(this._url,s.httpHeaders),t):this._request=n.request(h(this._url,s.httpHeaders),t),this._request.on("error",t=>{this._storedError=t,this._headersCapability.reject(t)}),this._request.end()}}class m extends p{constructor(t,e,i){super(t),this._httpHeaders={};for(const a in t.httpHeaders){var s=t.httpHeaders[a];void 0!==s&&(this._httpHeaders[a]=s)}this._httpHeaders.Range=`bytes=${e}-`+(i-1);e=t=>{var e;404===t.statusCode?(e=new o.MissingPDFException(`Missing PDF "${this._url}".`),this._storedError=e):this._setReadableStream(t)};this._request=null,"http:"===this._url.protocol?this._request=r.request(h(this._url,this._httpHeaders),e):this._request=n.request(h(this._url,this._httpHeaders),e),this._request.on("error",t=>{this._storedError=t}),this._request.end()}}class f extends u{constructor(t){super(t);let i=decodeURIComponent(this._url.path);d.test(this._url.href)&&(i=i.replace(/^\//,"")),a.lstat(i,(t,e)=>{t?("ENOENT"===t.code&&(t=new o.MissingPDFException(`Missing PDF "${i}".`)),this._storedError=t,this._headersCapability.reject(t)):(this._contentLength=e.size,this._setReadableStream(a.createReadStream(i)),this._headersCapability.resolve())})}}class v extends p{constructor(t,e,i){super(t);let s=decodeURIComponent(this._url.path);d.test(this._url.href)&&(s=s.replace(/^\//,"")),this._setReadableStream(a.createReadStream(s,{start:e,end:i-1}))}}e()}catch(t){e(t)}},1)},738:(t,c,u)=>{u.a(t,async(t,s)=>{try{u.d(c,{NodeCMapReaderFactory:()=>h,NodeCanvasFactory:()=>l,NodeFilterFactory:()=>o,NodeStandardFontDataFactory:()=>d});var a=u(822),r=u(266);let e,i;if(r.isNodeJS){e=await import("fs");try{i=await import("canvas")}catch{}try{await import("path2d-polyfill")}catch{}}const n=function(t){return new Promise((i,s)=>{e.readFile(t,(t,e)=>{t||!e?s(new Error(t)):i(new Uint8Array(e))})})};class o extends a.BaseFilterFactory{}class l extends a.BaseCanvasFactory{_createCanvas(t,e){return i.createCanvas(t,e)}}class h extends a.BaseCMapReaderFactory{_fetchData(t,e){return n(t).then(t=>({cMapData:t,compressionType:e}))}}class d extends a.BaseStandardFontDataFactory{_fetchData(t){return n(t)}}s()}catch(t){s(t)}},1)},890:(t,e,i)=>{i.d(e,{OptionalContentConfig:()=>a});var r=i(266),s=i(825);const n=Symbol("INTERNAL");class o{#visible=!0;constructor(t,e){this.name=t,this.intent=e}get visible(){return this.#visible}_setVisible(t,e){t!==n&&(0,r.unreachable)("Internal method `_setVisible` called."),this.#visible=e}}class a{#cachedGetHash=null;#groups=new Map;#initialHash=null;#order=null;constructor(t){if(this.name=null,(this.creator=null)!==t){this.name=t.name,this.creator=t.creator,this.#order=t.order;for(const e of t.groups)this.#groups.set(e.id,new o(e.name,e.intent));if("OFF"===t.baseState)for(const i of this.#groups.values())i._setVisible(n,!1);for(const s of t.on)this.#groups.get(s)._setVisible(n,!0);for(const a of t.off)this.#groups.get(a)._setVisible(n,!1);this.#initialHash=this.getHash()}}#evaluateVisibilityExpression(i){var t=i.length;if(t<2)return!0;var s=i[0];for(let e=1;e<t;e++){var a=i[e];let t;if(Array.isArray(a))t=this.#evaluateVisibilityExpression(a);else{if(!this.#groups.has(a))return(0,r.warn)("Optional content group not found: "+a),!0;t=this.#groups.get(a).visible}switch(s){case"And":if(t)break;return!1;case"Or":if(t)return!0;break;case"Not":return!t;default:return!0}}return"And"===s}isVisible(t){if(0!==this.#groups.size)if(t){if("OCG"===t.type)return this.#groups.has(t.id)?this.#groups.get(t.id).visible:((0,r.warn)("Optional content group not found: "+t.id),!0);if("OCMD"===t.type){if(t.expression)return this.#evaluateVisibilityExpression(t.expression);if(!t.policy||"AnyOn"===t.policy){for(const e of t.ids){if(!this.#groups.has(e))return(0,r.warn)("Optional content group not found: "+e),!0;if(this.#groups.get(e).visible)return!0}return!1}if("AllOn"===t.policy)for(const i of t.ids){if(!this.#groups.has(i))return(0,r.warn)("Optional content group not found: "+i),!0;if(!this.#groups.get(i).visible)return!1}else{if("AnyOff"===t.policy){for(const s of t.ids){if(!this.#groups.has(s))return(0,r.warn)("Optional content group not found: "+s),!0;if(!this.#groups.get(s).visible)return!0}return!1}if("AllOff"===t.policy)for(const a of t.ids){if(!this.#groups.has(a))return(0,r.warn)("Optional content group not found: "+a),!0;if(this.#groups.get(a).visible)return!1}else(0,r.warn)(`Unknown optional content policy ${t.policy}.`)}}else(0,r.warn)(`Unknown group type ${t.type}.`)}else(0,r.warn)("Optional content group not defined.");return!0}setVisibility(t,e=!0){this.#groups.has(t)?(this.#groups.get(t)._setVisible(n,!!e),this.#cachedGetHash=null):(0,r.warn)("Optional content group not found: "+t)}get hasInitialVisibility(){return null===this.#initialHash||this.getHash()===this.#initialHash}getOrder(){return this.#groups.size?this.#order?this.#order.slice():[...this.#groups.keys()]:null}getGroups(){return 0<this.#groups.size?(0,r.objectFromMap)(this.#groups):null}getGroup(t){return this.#groups.get(t)||null}getHash(){if(null!==this.#cachedGetHash)return this.#cachedGetHash;var t,e,i=new s.MurmurHash3_64;for([t,e]of this.#groups)i.update(t+":"+e.visible);return this.#cachedGetHash=i.hexdigest()}}},739:(t,e,i)=>{i.d(e,{renderTextLayer:()=>function(t){t=new s(t);return t._render(),t},updateTextLayer:()=>function({container:t,viewport:e,textDivs:i,textDivProperties:s,isOffscreenCanvasSupported:a,mustRotate:r=!0,mustRescale:n=!0}){r&&(0,h.setLayerDimensions)(t,{rotation:e.rotation});if(n){var r=v(0,a),o={prevFontSize:null,prevFontFamily:null,div:null,scale:e.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:r};for(const l of i)o.properties=s.get(l),o.div=l,d(o)}}});var p=i(266),h=i(473);const g=30,m=.8,f=new Map;function v(t,e){let i;return i=(e&&p.FeatureTest.isOffscreenCanvasSupported?new OffscreenCanvas(t,t):((e=document.createElement("canvas")).width=e.height=t,e)).getContext("2d",{alpha:!1})}function a(t,e,i){var s=document.createElement("span"),a={angle:0,canvasWidth:0,hasText:""!==e.str,hasEOL:e.hasEOL,fontSize:0},r=(t._textDivs.push(s),p.Util.transform(t._transform,e.transform));let n=Math.atan2(r[1],r[0]);var i=i[e.fontName],o=(i.vertical&&(n+=Math.PI/2),t._fontInspectorEnabled&&i.fontSubstitution||i.fontFamily),l=Math.hypot(r[2],r[3]),h=l*function(t,e){var i;if(i=f.get(t))return i;(i=v(g,e)).font=g+"px "+t;let s=(e=i.measureText("")).fontBoundingBoxAscent,a=Math.abs(e.fontBoundingBoxDescent);if(s)return e=s/(s+a),f.set(t,e),i.canvas.width=i.canvas.height=0,e;i.strokeStyle="red",i.clearRect(0,0,g,g),i.strokeText("g",0,0);let r=i.getImageData(0,0,g,g).data;a=0;for(let t=r.length-1-3;0<=t;t-=4)if(0<r[t]){a=Math.ceil(t/4/g);break}i.clearRect(0,0,g,g),i.strokeText("A",0,g),r=i.getImageData(0,0,g,g).data;for(let t=s=0,e=r.length;t<e;t+=4)if(0<r[t]){s=g-Math.floor(t/4/g);break}return i.canvas.width=i.canvas.height=0,s?(e=s/(s+a),f.set(t,e),e):(f.set(t,m),m)}(o,t._isOffscreenCanvasSupported);let d,c;c=0===n?(d=r[4],r[5]-h):(d=r[4]+h*Math.sin(n),r[5]-h*Math.cos(n));var r="calc(var(--scale-factor)*",h=s.style;t._container===t._rootContainer?(h.left=(100*d/t._pageWidth).toFixed(2)+"%",h.top=(100*c/t._pageHeight).toFixed(2)+"%"):(h.left=r+d.toFixed(2)+"px)",h.top=r+c.toFixed(2)+"px)"),h.fontSize=r+l.toFixed(2)+"px)",h.fontFamily=o,a.fontSize=l,s.setAttribute("role","presentation"),s.textContent=e.str,s.dir=e.dir,t._fontInspectorEnabled&&(s.dataset.fontName=i.fontSubstitutionLoadedName||e.fontName),0!==n&&(a.angle=n*(180/Math.PI));let u=!1;(u=1<e.str.length||" "!==e.str&&e.transform[0]!==e.transform[3]&&(r=Math.abs(e.transform[0]))!==(h=Math.abs(e.transform[3]))&&1.5<Math.max(r,h)/Math.min(r,h)?!0:u)&&(a.canvasWidth=i.vertical?e.height:e.width),t._textDivProperties.set(s,a),t._isReadableStream&&t._layoutText(s)}function d(t){var e,i,s,{div:a,scale:r,properties:n,ctx:o,prevFontSize:l,prevFontFamily:h}=t,d=a["style"];let c="";0!==n.canvasWidth&&n.hasText&&(e=d["fontFamily"],{canvasWidth:i,fontSize:s}=n,l=(l===s&&h===e||(o.font=s*r+"px "+e,t.prevFontSize=s,t.prevFontFamily=e),o.measureText(a.textContent))["width"],0<l)&&(c=`scaleX(${i*r/l})`),0<(c=0!==n.angle?`rotate(${n.angle}deg) `+c:c).length&&(d.transform=c)}function r(t){if(!t._canceled){var e=t._textDivs,i=t._capability,s=e.length;if(!(1e5<s||t._isReadableStream))for(const a of e)t._layoutText(a);i.resolve()}}class s{constructor({textContentSource:t,container:e,viewport:i,textDivs:s,textDivProperties:a,textContentItemsStr:r,isOffscreenCanvasSupported:n}){this._textContentSource=t,this._isReadableStream=t instanceof ReadableStream,this._container=this._rootContainer=e,this._textDivs=s||[],this._textContentItemsStr=r||[],this._isOffscreenCanvasSupported=n,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=a||new WeakMap,this._canceled=!1,this._capability=new p.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:i.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:v(0,n)};var{pageWidth:t,pageHeight:s,pageX:r,pageY:a}=i.rawDims;this._transform=[1,0,0,-1,-r,a+s],this._pageWidth=t,this._pageHeight=s,(0,h.setLayerDimensions)(e,i),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new p.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new p.AbortException("TextLayer task cancelled."))}_processItems(t,e){for(const s of t){var i;void 0===s.str?"beginMarkedContentProps"===s.type||"beginMarkedContent"===s.type?(i=this._container,this._container=document.createElement("span"),this._container.classList.add("markedContent"),null!==s.id&&this._container.setAttribute("id",""+s.id),i.append(this._container)):"endMarkedContent"===s.type&&(this._container=this._container.parentNode):(this._textContentItemsStr.push(s.str),a(this,s,e))}}_layoutText(t){var e=this._layoutTextParams.properties=this._textDivProperties.get(t);this._layoutTextParams.div=t,d(this._layoutTextParams),e.hasText&&this._container.append(t),e.hasEOL&&((t=document.createElement("br")).setAttribute("role","presentation"),this._container.append(t))}_render(){const i=new p.PromiseCapability;let s=Object.create(null);if(this._isReadableStream){const a=()=>{this._reader.read().then(({value:t,done:e})=>{e?i.resolve():(Object.assign(s,t.styles),this._processItems(t.items,s),a())},i.reject)};this._reader=this._textContentSource.getReader(),a()}else{if(!this._textContentSource)throw new Error('No "textContentSource" parameter specified.');var{items:t,styles:e}=this._textContentSource;this._processItems(t,e),i.resolve()}i.promise.then(()=>{s=null,r(this)},this._capability.reject)}}},92:(t,e,i)=>{i.d(e,{PDFDataTransportStream:()=>s});var o=i(266),r=i(473);class s{constructor({length:t,initialData:e,progressiveDone:i=!1,contentDispositionFilename:s=null,disableRange:a=!1,disableStream:r=!1},n){(0,o.assert)(n,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=i,this._contentDispositionFilename=s,0<e?.length&&(i=(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e:new Uint8Array(e)).buffer,this._queuedChunks.push(i)),this._pdfDataRangeTransport=n,this._isStreamingSupported=!r,this._isRangeSupported=!a,this._contentLength=t,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((t,e)=>{this._onReceiveData({begin:t,chunk:e})}),this._pdfDataRangeTransport.addProgressListener((t,e)=>{this._onProgress({loaded:t,total:e})}),this._pdfDataRangeTransport.addProgressiveReadListener(t=>{this._onReceiveData({chunk:t})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:e,chunk:t}){const i=(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t:new Uint8Array(t)).buffer;void 0===e?this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i):(t=this._rangeReaders.some(function(t){return t._begin===e&&(t._enqueue(i),!0)}),(0,o.assert)(t,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found."))}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){void 0===t.total?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){t=this._rangeReaders.indexOf(t);0<=t&&this._rangeReaders.splice(t,1)}getFullReader(){(0,o.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");var t=this._queuedChunks;return this._queuedChunks=null,new a(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){var i;return e<=this._progressiveDataLength?null:(i=new n(this,t,e),this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i)}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class a{constructor(t,e,i=!1,s=null){this._stream=t,this._done=i||!1,this._filename=(0,r.isPdfFile)(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(const a of this._queuedChunks)this._loaded+=a.byteLength;this._requests=[],this._headersReady=Promise.resolve(),(t._fullRequestReader=this).onProgress=null}_enqueue(t){this._done||(0<this._requests.length?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){var t;return 0<this._queuedChunks.length?{value:this._queuedChunks.shift(),done:!1}:this._done?{value:void 0,done:!0}:(t=new o.PromiseCapability,this._requests.push(t),t.promise)}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class n{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(0===this._requests.length)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){var t;return this._queuedChunk?(t=this._queuedChunk,this._queuedChunk=null,{value:t,done:!1}):this._done?{value:void 0,done:!0}:(t=new o.PromiseCapability,this._requests.push(t),t.promise)}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},368:(t,e,i)=>{i.d(e,{GlobalWorkerOptions:()=>s});const s=Object.create(null);s.workerPort=null,s.workerSrc=""},160:(t,e,i)=>{i.d(e,{XfaLayer:()=>s});var m=i(521);class s{static setupStorage(t,e,i,s,a){var r=s.getValue(e,{value:null});switch(i.name){case"textarea":null!==r.value&&(t.textContent=r.value),"print"!==a&&t.addEventListener("input",t=>{s.setValue(e,{value:t.target.value})});break;case"input":if("radio"===i.attributes.type||"checkbox"===i.attributes.type){if(r.value===i.attributes.xfaOn?t.setAttribute("checked",!0):r.value===i.attributes.xfaOff&&t.removeAttribute("checked"),"print"===a)break;t.addEventListener("change",t=>{s.setValue(e,{value:t.target.checked?t.target.getAttribute("xfaOn"):t.target.getAttribute("xfaOff")})})}else{if(null!==r.value&&t.setAttribute("value",r.value),"print"===a)break;t.addEventListener("input",t=>{s.setValue(e,{value:t.target.value})})}break;case"select":if(null!==r.value){t.setAttribute("value",r.value);for(const n of i.children)n.attributes.value===r.value?n.attributes.selected=!0:n.attributes.hasOwnProperty("selected")&&delete n.attributes.selected}t.addEventListener("input",t=>{t=t.target.options,t=-1===t.selectedIndex?"":t[t.selectedIndex].value;s.setValue(e,{value:t})})}}static setAttributes({html:t,element:e,storage:i=null,intent:s,linkService:a}){var r,n,o=e["attributes"],l=t instanceof HTMLAnchorElement;"radio"===o.type&&(o.name=o.name+"-"+s);for([r,n]of Object.entries(o))if(null!==n&&void 0!==n)switch(r){case"class":n.length&&t.setAttribute(r,n.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",n);break;case"style":Object.assign(t.style,n);break;case"textContent":t.textContent=n;break;default:l&&("href"===r||"newWindow"===r)||t.setAttribute(r,n)}l&&a.addLinkAttributes(t,o.href,o.newWindow),i&&o.dataId&&this.setupStorage(t,o.dataId,e,i)}static render(t){var e=t.annotationStorage,i=t.linkService,s=t.xfaHtml,a=t.intent||"display",r=document.createElement(s.name),n=(s.attributes&&this.setAttributes({html:r,element:s,intent:a,linkService:i}),"richText"!==a),o=t.div,l=(o.append(r),t.viewport&&(t=`matrix(${t.viewport.transform.join(",")})`,o.style.transform=t),n&&o.setAttribute("class","xfaLayer xfaFont"),[]);if(0===s.children.length)s.value&&(t=document.createTextNode(s.value),r.append(t),n)&&m.XfaText.shouldBuildText(s.name)&&l.push(t);else{for(var h=[[s,-1,r]];0<h.length;){var d,[c,u,p]=h.at(-1);u+1===c.children.length?h.pop():null!==(u=c.children[++h.at(-1)[1]])&&(c=u["name"],"#text"===c?(d=document.createTextNode(u.value),l.push(d),p.append(d)):(d=u?.attributes?.xmlns?document.createElementNS(u.attributes.xmlns,c):document.createElement(c),p.append(d),u.attributes&&this.setAttributes({html:d,element:u,storage:e,intent:a,linkService:i}),0<u.children?.length?h.push([u,-1,d]):u.value&&(p=document.createTextNode(u.value),n&&m.XfaText.shouldBuildText(c)&&l.push(p),d.append(p))))}for(const g of o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0)}return{textDivs:l}}static update(t){var e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}},521:(t,e,i)=>{i.d(e,{XfaText:()=>n});class n{static textContent(t){const r=[];var e={items:r,styles:Object.create(null)};return function e(i){if(i){let t=null;var s=i.name;if("#text"===s)t=i.value;else{if(!n.shouldBuildText(s))return;i?.attributes?.textContent?t=i.attributes.textContent:i.value&&(t=i.value)}if(null!==t&&r.push({str:t}),i.children)for(const a of i.children)e(a)}}(t),e}static shouldBuildText(t){return!("textarea"===t||"input"===t||"option"===t||"select"===t)}}},907:(t,m,f)=>{f.a(t,async(t,e)=>{try{f.d(m,{AbortException:()=>i.AbortException,AnnotationEditorLayer:()=>n.AnnotationEditorLayer,AnnotationEditorParamsType:()=>i.AnnotationEditorParamsType,AnnotationEditorType:()=>i.AnnotationEditorType,AnnotationEditorUIManager:()=>o.AnnotationEditorUIManager,AnnotationLayer:()=>l.AnnotationLayer,AnnotationMode:()=>i.AnnotationMode,CMapCompressionType:()=>i.CMapCompressionType,ColorPicker:()=>h.ColorPicker,DOMSVGFactory:()=>a.DOMSVGFactory,DrawLayer:()=>d.DrawLayer,FeatureTest:()=>i.FeatureTest,GlobalWorkerOptions:()=>c.GlobalWorkerOptions,ImageKind:()=>i.ImageKind,InvalidPDFException:()=>i.InvalidPDFException,MissingPDFException:()=>i.MissingPDFException,OPS:()=>i.OPS,Outliner:()=>u.Outliner,PDFDataRangeTransport:()=>s.PDFDataRangeTransport,PDFDateString:()=>a.PDFDateString,PDFWorker:()=>s.PDFWorker,PasswordResponses:()=>i.PasswordResponses,PermissionFlag:()=>i.PermissionFlag,PixelsPerInch:()=>a.PixelsPerInch,PromiseCapability:()=>i.PromiseCapability,RenderingCancelledException:()=>a.RenderingCancelledException,UnexpectedResponseException:()=>i.UnexpectedResponseException,Util:()=>i.Util,VerbosityLevel:()=>i.VerbosityLevel,XfaLayer:()=>p.XfaLayer,build:()=>s.build,createValidAbsoluteUrl:()=>i.createValidAbsoluteUrl,fetchData:()=>a.fetchData,getDocument:()=>s.getDocument,getFilenameFromUrl:()=>a.getFilenameFromUrl,getPdfFilenameFromUrl:()=>a.getPdfFilenameFromUrl,getXfaPageViewport:()=>a.getXfaPageViewport,isDataScheme:()=>a.isDataScheme,isPdfFile:()=>a.isPdfFile,noContextMenu:()=>a.noContextMenu,normalizeUnicode:()=>i.normalizeUnicode,renderTextLayer:()=>r.renderTextLayer,setLayerDimensions:()=>a.setLayerDimensions,shadow:()=>i.shadow,updateTextLayer:()=>r.updateTextLayer,version:()=>s.version});var i=f(266),s=f(406),a=f(473),r=f(739),n=f(629),o=f(812),l=f(640),h=f(97),d=f(423),c=f(368),u=f(405),p=f(160),g=t([s]),s=(g.then?(await g)():g)[0];e()}catch(t){e(t)}})},694:(t,e,i)=>{i.d(e,{MessageHandler:()=>s});var h=i(266);const o={UNKNOWN:0,DATA:1,ERROR:2},d={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function c(t){switch(t instanceof Error||"object"==typeof t&&null!==t||(0,h.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),t.name){case"AbortException":return new h.AbortException(t.message);case"MissingPDFException":return new h.MissingPDFException(t.message);case"PasswordException":return new h.PasswordException(t.message,t.code);case"UnexpectedResponseException":return new h.UnexpectedResponseException(t.message,t.status);case"UnknownErrorException":return new h.UnknownErrorException(t.message,t.details);default:return new h.UnknownErrorException(t.message,t.toString())}}class s{constructor(t,e,n){this.sourceName=t,this.targetName=e,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=t=>{const e=t.data;if(e.targetName===this.sourceName)if(e.stream)this.#processStreamMessage(e);else if(e.callback){var t=e.callbackId,i=this.callbackCapabilities[t];if(!i)throw new Error("Cannot resolve callback "+t);if(delete this.callbackCapabilities[t],e.callback===o.DATA)i.resolve(e.data);else{if(e.callback!==o.ERROR)throw new Error("Unexpected callback case");i.reject(c(e.reason))}}else{const s=this.actionHandler[e.action];if(!s)throw new Error("Unknown action from worker: "+e.action);if(e.callbackId){const a=this.sourceName,r=e.sourceName;void new Promise(function(t){t(s(e.data))}).then(function(t){n.postMessage({sourceName:a,targetName:r,callback:o.DATA,callbackId:e.callbackId,data:t})},function(t){n.postMessage({sourceName:a,targetName:r,callback:o.ERROR,callbackId:e.callbackId,reason:c(t)})})}else e.streamId?this.#createStreamSink(e):s(e.data)}},n.addEventListener("message",this._onComObjOnMessage)}on(t,e){var i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){var s=this.callbackId++,a=new h.PromiseCapability;this.callbackCapabilities[s]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},i)}catch(t){a.reject(t)}return a.promise}sendWithStream(i,s,t,a){const r=this.streamId++,n=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:t=>{var e=new h.PromiseCapability;return this.streamControllers[r]={controller:t,startCall:e,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:n,targetName:o,action:i,streamId:r,data:s,desiredSize:t.desiredSize},a),e.promise},pull:t=>{var e=new h.PromiseCapability;return this.streamControllers[r].pullCall=e,l.postMessage({sourceName:n,targetName:o,stream:d.PULL,streamId:r,desiredSize:t.desiredSize}),e.promise},cancel:t=>{(0,h.assert)(t instanceof Error,"cancel must have a valid reason");var e=new h.PromiseCapability;return this.streamControllers[r].cancelCall=e,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:n,targetName:o,stream:d.CANCEL,streamId:r,reason:c(t)}),e.promise}},t)}#createStreamSink(e){const a=e.streamId,r=this.sourceName,n=e.sourceName,o=this.comObj,t=this,i=this.actionHandler[e.action],s={enqueue(t,e=1,i){var s;this.isCancelled||(s=this.desiredSize,this.desiredSize-=e,0<s&&this.desiredSize<=0&&(this.sinkCapability=new h.PromiseCapability,this.ready=this.sinkCapability.promise),o.postMessage({sourceName:r,targetName:n,stream:d.ENQUEUE,streamId:a,chunk:t},i))},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:r,targetName:n,stream:d.CLOSE,streamId:a}),delete t.streamSinks[a])},error(t){(0,h.assert)(t instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:r,targetName:n,stream:d.ERROR,streamId:a,reason:c(t)}))},sinkCapability:new h.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};s.sinkCapability.resolve(),s.ready=s.sinkCapability.promise,this.streamSinks[a]=s,new Promise(function(t){t(i(e.data,s))}).then(function(){o.postMessage({sourceName:r,targetName:n,stream:d.START_COMPLETE,streamId:a,success:!0})},function(t){o.postMessage({sourceName:r,targetName:n,stream:d.START_COMPLETE,streamId:a,reason:c(t)})})}#processStreamMessage(e){const i=e.streamId,s=this.sourceName,a=e.sourceName,r=this.comObj,t=this.streamControllers[i],n=this.streamSinks[i];switch(e.stream){case d.START_COMPLETE:e.success?t.startCall.resolve():t.startCall.reject(c(e.reason));break;case d.PULL_COMPLETE:e.success?t.pullCall.resolve():t.pullCall.reject(c(e.reason));break;case d.PULL:n?(n.desiredSize<=0&&0<e.desiredSize&&n.sinkCapability.resolve(),n.desiredSize=e.desiredSize,new Promise(function(t){t(n.onPull?.())}).then(function(){r.postMessage({sourceName:s,targetName:a,stream:d.PULL_COMPLETE,streamId:i,success:!0})},function(t){r.postMessage({sourceName:s,targetName:a,stream:d.PULL_COMPLETE,streamId:i,reason:c(t)})})):r.postMessage({sourceName:s,targetName:a,stream:d.PULL_COMPLETE,streamId:i,success:!0});break;case d.ENQUEUE:(0,h.assert)(t,"enqueue should have stream controller"),t.isClosed||t.controller.enqueue(e.chunk);break;case d.CLOSE:(0,h.assert)(t,"close should have stream controller"),t.isClosed||(t.isClosed=!0,t.controller.close(),this.#deleteStreamController(t,i));break;case d.ERROR:(0,h.assert)(t,"error should have stream controller"),t.controller.error(c(e.reason)),this.#deleteStreamController(t,i);break;case d.CANCEL_COMPLETE:e.success?t.cancelCall.resolve():t.cancelCall.reject(c(e.reason)),this.#deleteStreamController(t,i);break;case d.CANCEL:n&&(new Promise(function(t){t(n.onCancel?.(c(e.reason)))}).then(function(){r.postMessage({sourceName:s,targetName:a,stream:d.CANCEL_COMPLETE,streamId:i,success:!0})},function(t){r.postMessage({sourceName:s,targetName:a,stream:d.CANCEL_COMPLETE,streamId:i,reason:c(t)})}),n.sinkCapability.reject(c(e.reason)),n.isCancelled=!0,delete this.streamSinks[i]);break;default:throw new Error("Unexpected stream case")}}async#deleteStreamController(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},825:(t,e,i)=>{i.d(e,{MurmurHash3_64:()=>s});var p=i(266);const g=4294901760,m=65535;class s{constructor(t){this.h1=t?4294967295&t:3285377520,this.h2=t?4294967295&t:3285377520}update(i){let s,a;if("string"==typeof i){s=new Uint8Array(2*i.length);for(let t=a=0,e=i.length;t<e;t++){var r=i.charCodeAt(t);r<=255?s[a++]=r:(s[a++]=r>>>8,s[a++]=255&r)}}else{if(!(0,p.isArrayBuffer)(i))throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");s=i.slice(),a=s.byteLength}var e=a>>2,t=a-4*e,n=new Uint32Array(s.buffer,0,e);let o=0,l,h=this.h1,d=this.h2;var c=3432918353,u=461845907;for(let t=0;t<e;t++)1&t?(o=(o=(o=(o=n[t])*c&g|11601*o&m)<<15|o>>>17)*u&g|13715*o&m,h=5*(h=(h^=o)<<13|h>>>19)+3864292196):(l=(l=(l=(l=n[t])*c&g|11601*l&m)<<15|l>>>17)*u&g|13715*l&m,d=5*(d=(d^=l)<<13|d>>>19)+3864292196);switch(o=0,t){case 3:o^=s[4*e+2]<<16;case 2:o^=s[4*e+1]<<8;case 1:o=(o=(o=(o^=s[4*e])*c&g|11601*o&m)<<15|o>>>17)*u&g|13715*o&m,1&e?h^=o:d^=o}this.h1=h,this.h2=d}hexdigest(){var t=this.h1,e=this.h2,t=3981806797*(t^=e>>>1)&g|36045*t&m;return t=444984403*(t^=(e=4283543511*e&g|(2950163797*(e<<16|t>>>16)&g)>>>16)>>>1)&g|60499*t&m,((t^=(e=3301882366*e&g|(3120437893*(e<<16|t>>>16)&g)>>>16)>>>1)>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}},266:(O,t,e)=>{e.d(t,{AbortException:()=>B,AnnotationBorderStyleType:()=>f,AnnotationEditorParamsType:()=>c,AnnotationEditorPrefix:()=>h,AnnotationEditorType:()=>d,AnnotationMode:()=>l,AnnotationPrefix:()=>q,AnnotationType:()=>m,BaseException:()=>C,CMapCompressionType:()=>b,FONT_IDENTITY_MATRIX:()=>a,FeatureTest:()=>j,FormatError:()=>N,IDENTITY_MATRIX:()=>s,ImageKind:()=>g,InvalidPDFException:()=>M,LINE_FACTOR:()=>n,MAX_IMAGE_SIZE_TO_CACHE:()=>r,MissingPDFException:()=>P,OPS:()=>_,PasswordException:()=>T,PasswordResponses:()=>A,PermissionFlag:()=>u,PromiseCapability:()=>G,RenderingIntentFlag:()=>o,TextRenderingMode:()=>p,UnexpectedResponseException:()=>R,UnknownErrorException:()=>k,Util:()=>V,VerbosityLevel:()=>v,assert:()=>function(t,e){t||x(e)},bytesToString:()=>D,createValidAbsoluteUrl:()=>function(t,e=null,i=null){if(t)try{if(i&&"string"==typeof t)if(i.addDefaultProtocol&&t.startsWith("www.")&&2<=t.match(/\./g)?.length&&(t="http://"+t),i.tryConvertEncoding)try{t=function(t){return decodeURIComponent(escape(t))}(t)}catch{}var s=e?new URL(t,e):new URL(t);if(function(t){switch(t?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return 1;default:return}}(s))return s}catch{}return null},getUuid:()=>function(){if("undefined"!=typeof crypto&&"function"==typeof crypto?.randomUUID)return crypto.randomUUID();var e=new Uint8Array(32);if("undefined"!=typeof crypto&&"function"==typeof crypto?.getRandomValues)crypto.getRandomValues(e);else for(let t=0;t<32;t++)e[t]=Math.floor(255*Math.random());return D(e)},getVerbosityLevel:()=>function(){return y},info:()=>function(t){y>=v.INFOS&&console.log("Info: "+t)},isArrayBuffer:()=>function(t){return"object"==typeof t&&void 0!==t?.byteLength},isNodeJS:()=>i,normalizeUnicode:()=>function(t){F||(F=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,L=new Map([["","t"]]));return t.replaceAll(F,(t,e,i)=>e?e.normalize("NFKC"):L.get(i))},objectFromMap:()=>function(t){var e=Object.create(null);for(var[i,s]of t)e[i]=s;return e},setVerbosityLevel:()=>function(t){Number.isInteger(t)&&(y=t)},shadow:()=>E,string32:()=>function(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t)},stringToBytes:()=>U,unreachable:()=>x,warn:()=>w});const i=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),s=[1,0,0,1,0,0],a=[.001,0,0,.001,0,0],r=1e7,n=1.35;n;const o={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},l={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},h="pdfjs_internal_editor_",d={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},c={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32},u={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},p={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},g={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},m={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};const f={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};const v={ERRORS:0,WARNINGS:1,INFOS:5},b={NONE:0,BINARY:1},_={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},A={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let y=v.WARNINGS;function w(t){y>=v.WARNINGS&&console.log("Warning: "+t)}function x(t){throw new Error(t)}function E(t,e,i,s=!1){return Object.defineProperty(t,e,{value:i,enumerable:!s,configurable:!0,writable:!1}),i}S.prototype=new Error;const C=S.constructor=S;function S(t,e){this.constructor===S&&x("Cannot initialize BaseException."),this.message=t,this.name=e}class T extends C{constructor(t,e){super(t,"PasswordException"),this.code=e}}class k extends C{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class M extends C{constructor(t){super(t,"InvalidPDFException")}}class P extends C{constructor(t){super(t,"MissingPDFException")}}class R extends C{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}}class N extends C{constructor(t){super(t,"FormatError")}}class B extends C{constructor(t){super(t,"AbortException")}}function D(e){"object"==typeof e&&void 0!==e?.length||x("Invalid argument for bytesToString");var i=e.length;if(i<8192)return String.fromCharCode.apply(null,e);var s=[];for(let t=0;t<i;t+=8192){var a=Math.min(t+8192,i),a=e.subarray(t,a);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function U(e){"string"!=typeof e&&x("Invalid argument for stringToBytes");var i=e.length,s=new Uint8Array(i);for(let t=0;t<i;++t)s[t]=255&e.charCodeAt(t);return s}function z(){var t=new Uint8Array(4),t=(t[0]=1,new Uint32Array(t.buffer,0,1));return 1===t[0]}function H(){try{return new Function(""),!0}catch{return!1}}class j{static get isLittleEndian(){return E(this,"isLittleEndian",z())}static get isEvalSupported(){return E(this,"isEvalSupported",H())}static get isOffscreenCanvasSupported(){return E(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get platform(){return"undefined"!=typeof navigator&&"string"==typeof navigator?.platform?E(this,"platform",{isMac:navigator.platform.includes("Mac")}):E(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return E(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const I=[...Array(256).keys()].map(t=>t.toString(16).padStart(2,"0"));class V{static makeHexColor(t,e,i){return"#"+I[t]+I[e]+I[i]}static scaleMinMax(t,e){let i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[1],e[1]=i),e[0]*=t[0],e[1]*=t[0],t[3]<0&&(i=e[2],e[2]=e[3],e[3]=i),e[2]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[2],e[2]=i,i=e[1],e[1]=e[3],e[3]=i,t[1]<0&&(i=e[2],e[2]=e[3],e[3]=i),e[2]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[1],e[1]=i),e[0]*=t[2],e[1]*=t[2]),e[0]+=t[4],e[1]+=t[4],e[2]+=t[5],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}static applyInverseTransform(t,e){var i=e[0]*e[3]-e[1]*e[2];return[(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i]}static getAxialAlignedBoundingBox(t,e){var i=this.applyTransform(t,e),s=this.applyTransform(t.slice(2,4),e),a=this.applyTransform([t[0],t[3]],e),t=this.applyTransform([t[2],t[1]],e);return[Math.min(i[0],s[0],a[0],t[0]),Math.min(i[1],s[1],a[1],t[1]),Math.max(i[0],s[0],a[0],t[0]),Math.max(i[1],s[1],a[1],t[1])]}static inverseTransform(t){var e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){var e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],s=t[0]*e[1]+t[1]*e[3],a=t[2]*e[0]+t[3]*e[2],t=t[2]*e[1]+t[3]*e[3],e=(i+t)/2,i=Math.sqrt((i+t)**2-4*(i*t-a*s))/2,t=e-i||1;return[Math.sqrt(e+i||1),Math.sqrt(t)]}static normalizeRect(t){var e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){var i,s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),a=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));return a<s||(i=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),(t=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3])))<i)?null:[s,i,a,t]}static bezierBoundingBox(e,i,s,a,r,n,o,l){var h=[],t=[[],[]];let d,c,u,p,g,m,f,v;for(let t=0;t<2;++t)u=0===t?(c=6*e-12*s+6*r,d=-3*e+9*s-9*r+3*o,3*s-3*e):(c=6*i-12*a+6*n,d=-3*i+9*a-9*n+3*l,3*a-3*i),Math.abs(d)<1e-12?Math.abs(c)<1e-12||0<(p=-u/c)&&p<1&&h.push(p):(f=c*c-4*u*d,v=Math.sqrt(f),f<0||(0<(g=(-c+v)/(2*d))&&g<1&&h.push(g),0<(m=(-c-v)/(2*d))&&m<1&&h.push(m)));let b=h.length,_;for(var A=b;b--;)_=1-(p=h[b]),t[0][b]=_*_*_*e+3*_*_*p*s+3*_*p*p*r+p*p*p*o,t[1][b]=_*_*_*i+3*_*_*p*a+3*_*p*p*n+p*p*p*l;return t[0][A]=e,t[1][A]=i,t[0][A+1]=o,t[1][A+1]=l,t[0].length=t[1].length=A+2,[Math.min(...t[0]),Math.min(...t[1]),Math.max(...t[0]),Math.max(...t[1])]}}class G{#settled=!1;constructor(){this.promise=new Promise((e,i)=>{this.resolve=t=>{this.#settled=!0,e(t)},this.reject=t=>{this.#settled=!0,i(t)}})}get settled(){return this.#settled}}let F=null,L=null;const q="pdfjs_internal_id_"}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];return void 0!==e||(e=__webpack_module_cache__[t]={exports:{}},__webpack_modules__[t](e,e.exports,__webpack_require__)),e.exports}(()=>{var d="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",c="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",u="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",p=t=>{t&&t.d<1&&(t.d=1,t.forEach(t=>t.r--),t.forEach(t=>t.r--?t.r++:t()))};__webpack_require__.a=(t,e,i)=>{i&&((a=[]).d=-1);var a,r,s,n,o=new Set,l=t.exports,h=new Promise((t,e)=>{n=e,s=t});h[c]=l,h[d]=t=>(a&&t(a),o.forEach(t),h.catch(t=>{})),t.exports=h,e(t=>{r=t.map(t=>{if(null!==t&&"object"==typeof t){if(t[d])return t;var e,i;if(t.then)return(e=[]).d=0,t.then(t=>{i[c]=t,p(e)},t=>{i[u]=t,p(e)}),(i={})[d]=t=>t(e),i}var s={};return s[d]=t=>{},s[c]=t,s});var i,s=()=>r.map(t=>{if(t[u])throw t[u];return t[c]}),t=new Promise(t=>{(i=()=>t(s)).r=0;var e=t=>t!==a&&!o.has(t)&&(o.add(t),t)&&!t.d&&(i.r++,t.push(i));r.map(t=>t[d](e))});return i.r?t:s()},t=>(t?n(h[u]=t):s(l),p(a))),a&&a.d<0&&(a.d=0)}})(),__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var __webpack_exports__=__webpack_require__(907),__webpack_exports__AbortException=(__webpack_exports__=globalThis.pdfjsLib=await(globalThis.pdfjsLibPromise=__webpack_exports__)).AbortException,__webpack_exports__AnnotationEditorLayer=__webpack_exports__.AnnotationEditorLayer,__webpack_exports__AnnotationEditorParamsType=__webpack_exports__.AnnotationEditorParamsType,__webpack_exports__AnnotationEditorType=__webpack_exports__.AnnotationEditorType,__webpack_exports__AnnotationEditorUIManager=__webpack_exports__.AnnotationEditorUIManager,__webpack_exports__AnnotationLayer=__webpack_exports__.AnnotationLayer,__webpack_exports__AnnotationMode=__webpack_exports__.AnnotationMode,__webpack_exports__CMapCompressionType=__webpack_exports__.CMapCompressionType,__webpack_exports__ColorPicker=__webpack_exports__.ColorPicker,__webpack_exports__DOMSVGFactory=__webpack_exports__.DOMSVGFactory,__webpack_exports__DrawLayer=__webpack_exports__.DrawLayer,__webpack_exports__FeatureTest=__webpack_exports__.FeatureTest,__webpack_exports__GlobalWorkerOptions=__webpack_exports__.GlobalWorkerOptions,__webpack_exports__ImageKind=__webpack_exports__.ImageKind,__webpack_exports__InvalidPDFException=__webpack_exports__.InvalidPDFException,__webpack_exports__MissingPDFException=__webpack_exports__.MissingPDFException,__webpack_exports__OPS=__webpack_exports__.OPS,__webpack_exports__Outliner=__webpack_exports__.Outliner,__webpack_exports__PDFDataRangeTransport=__webpack_exports__.PDFDataRangeTransport,__webpack_exports__PDFDateString=__webpack_exports__.PDFDateString,__webpack_exports__PDFWorker=__webpack_exports__.PDFWorker,__webpack_exports__PasswordResponses=__webpack_exports__.PasswordResponses,__webpack_exports__PermissionFlag=__webpack_exports__.PermissionFlag,__webpack_exports__PixelsPerInch=__webpack_exports__.PixelsPerInch,__webpack_exports__PromiseCapability=__webpack_exports__.PromiseCapability,__webpack_exports__RenderingCancelledException=__webpack_exports__.RenderingCancelledException,__webpack_exports__UnexpectedResponseException=__webpack_exports__.UnexpectedResponseException,__webpack_exports__Util=__webpack_exports__.Util,__webpack_exports__VerbosityLevel=__webpack_exports__.VerbosityLevel,__webpack_exports__XfaLayer=__webpack_exports__.XfaLayer,__webpack_exports__build=__webpack_exports__.build,__webpack_exports__createValidAbsoluteUrl=__webpack_exports__.createValidAbsoluteUrl,__webpack_exports__fetchData=__webpack_exports__.fetchData,__webpack_exports__getDocument=__webpack_exports__.getDocument,__webpack_exports__getFilenameFromUrl=__webpack_exports__.getFilenameFromUrl,__webpack_exports__getPdfFilenameFromUrl=__webpack_exports__.getPdfFilenameFromUrl,__webpack_exports__getXfaPageViewport=__webpack_exports__.getXfaPageViewport,__webpack_exports__isDataScheme=__webpack_exports__.isDataScheme,__webpack_exports__isPdfFile=__webpack_exports__.isPdfFile,__webpack_exports__noContextMenu=__webpack_exports__.noContextMenu,__webpack_exports__normalizeUnicode=__webpack_exports__.normalizeUnicode,__webpack_exports__renderTextLayer=__webpack_exports__.renderTextLayer,__webpack_exports__setLayerDimensions=__webpack_exports__.setLayerDimensions,__webpack_exports__shadow=__webpack_exports__.shadow,__webpack_exports__updateTextLayer=__webpack_exports__.updateTextLayer,__webpack_exports__version=__webpack_exports__.version;export{__webpack_exports__AbortException as AbortException,__webpack_exports__AnnotationEditorLayer as AnnotationEditorLayer,__webpack_exports__AnnotationEditorParamsType as AnnotationEditorParamsType,__webpack_exports__AnnotationEditorType as AnnotationEditorType,__webpack_exports__AnnotationEditorUIManager as AnnotationEditorUIManager,__webpack_exports__AnnotationLayer as AnnotationLayer,__webpack_exports__AnnotationMode as AnnotationMode,__webpack_exports__CMapCompressionType as CMapCompressionType,__webpack_exports__ColorPicker as ColorPicker,__webpack_exports__DOMSVGFactory as DOMSVGFactory,__webpack_exports__DrawLayer as DrawLayer,__webpack_exports__FeatureTest as FeatureTest,__webpack_exports__GlobalWorkerOptions as GlobalWorkerOptions,__webpack_exports__ImageKind as ImageKind,__webpack_exports__InvalidPDFException as InvalidPDFException,__webpack_exports__MissingPDFException as MissingPDFException,__webpack_exports__OPS as OPS,__webpack_exports__Outliner as Outliner,__webpack_exports__PDFDataRangeTransport as PDFDataRangeTransport,__webpack_exports__PDFDateString as PDFDateString,__webpack_exports__PDFWorker as PDFWorker,__webpack_exports__PasswordResponses as PasswordResponses,__webpack_exports__PermissionFlag as PermissionFlag,__webpack_exports__PixelsPerInch as PixelsPerInch,__webpack_exports__PromiseCapability as PromiseCapability,__webpack_exports__RenderingCancelledException as RenderingCancelledException,__webpack_exports__UnexpectedResponseException as UnexpectedResponseException,__webpack_exports__Util as Util,__webpack_exports__VerbosityLevel as VerbosityLevel,__webpack_exports__XfaLayer as XfaLayer,__webpack_exports__build as build,__webpack_exports__createValidAbsoluteUrl as createValidAbsoluteUrl,__webpack_exports__fetchData as fetchData,__webpack_exports__getDocument as getDocument,__webpack_exports__getFilenameFromUrl as getFilenameFromUrl,__webpack_exports__getPdfFilenameFromUrl as getPdfFilenameFromUrl,__webpack_exports__getXfaPageViewport as getXfaPageViewport,__webpack_exports__isDataScheme as isDataScheme,__webpack_exports__isPdfFile as isPdfFile,__webpack_exports__noContextMenu as noContextMenu,__webpack_exports__normalizeUnicode as normalizeUnicode,__webpack_exports__renderTextLayer as renderTextLayer,__webpack_exports__setLayerDimensions as setLayerDimensions,__webpack_exports__shadow as shadow,__webpack_exports__updateTextLayer as updateTextLayer,__webpack_exports__version as version};